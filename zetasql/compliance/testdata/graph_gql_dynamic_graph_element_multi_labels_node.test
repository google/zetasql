# Testing dynamic multi label nodes in graph DDL. Achieves similar coverage
# as dynamic single label test cases in `graph_gql_dynamic_graph_element.test`
# with a focus on edge-case labels values like empty string, null, empty array,
# and their coupling with static labels.

[default reserve_graph_table]
[default required_features=SQL_GRAPH,SQL_GRAPH_ADVANCED_QUERY,SQL_GRAPH_DYNAMIC_ELEMENT_TYPE,SQL_GRAPH_DYNAMIC_LABEL_PROPERTIES_IN_DDL,SQL_GRAPH_DYNAMIC_MULTI_LABEL_NODES,JSON_TYPE]
[load_proto_files=zetasql/testdata/test_schema.proto]
[load_proto_names=zetasql_test__.KitchenSinkPB]

[prepare_database]
CREATE TABLE DynamicMultiLabelGraphNode AS
(SELECT 1 AS id, ["engineer", "person", "teacher"] AS nodeLabelCol, 1000 AS code, JSON '{"name": "Alice"}' AS nodePropCol) UNION ALL
(SELECT 2 AS id, ["admin", "person"] AS nodeLabelCol, 2000 AS code, JSON '{"name": "Bob"}' AS nodePropCol) UNION ALL
(SELECT 3 as id, ["researcher", "person"] AS nodeLabelCol, 3000 AS code, JSON '{"name": "Cindy"}' AS nodePropCol) UNION ALL
(SELECT 8 as id, ["person", "teacher"] AS nodeLabelCol, 8000 AS code, JSON '{"name": ["Dylan", "Dana"]}' AS nodePropCol) UNION ALL
(SELECT 4 AS id, ["account", "checking_account"] AS nodeLabelCol, 4000 AS code, JSON '{"name": "Checking"}' AS nodePropCol) UNION ALL
(SELECT 5 AS id, ["account", "saving_account"] AS nodeLabelCol, 5000 AS code, JSON '{"name": "Saving"}' AS nodePropCol) UNION ALL
(SELECT 6 as id, ["holiday_account", "account"] AS nodeLabelCol, 6000 AS code, JSON '{"name": "Saving"}' AS nodePropCol) UNION ALL
(SELECT 7 as id, [CAST(NULL AS STRING)] AS nodeLabelCol, NULL AS code, CAST(NULL AS JSON) AS nodePropCol) UNION ALL
(SELECT 9 as id, ["",""] AS nodeLabelCol, NULL AS code, JSON '{"name": "Saving"}' AS nodePropCol) UNION ALL
(SELECT 10 as id, CAST(NULL AS ARRAY<STRING>) AS nodeLabelCol, NULL AS code, JSON '{"name": "Saving"}' AS nodePropCol) UNION ALL
(SELECT 11 as id, [] AS nodeLabelCol, NULL AS code, JSON '{"name": "Saving"}' AS nodePropCol)
--
ARRAY<STRUCT<id INT64, nodeLabelCol ARRAY<>, code INT64, nodePropCol JSON>>[
  {
    1,
    ARRAY<STRING>["engineer", "person", "teacher"],
    1000,
    {"name":"Alice"}
  },
  {
    2,
    ARRAY<STRING>["admin", "person"],
    2000,
    {"name":"Bob"}
  },
  {
    3,
    ARRAY<STRING>["researcher", "person"],
    3000,
    {"name":"Cindy"}
  },
  {
    8,
    ARRAY<STRING>["person", "teacher"],
    8000,
    {"name":["Dylan","Dana"]}
  },
  {
    4,
    ARRAY<STRING>["account", "checking_account"],
    4000,
    {"name":"Checking"}
  },
  {
    5,
    ARRAY<STRING>["account", "saving_account"],
    5000,
    {"name":"Saving"}
  },
  {
    6,
    ARRAY<STRING>["holiday_account", "account"],
    6000,
    {"name":"Saving"}
  },
  {7, ARRAY<STRING>[NULL], NULL, NULL},
  {
    9,
    ARRAY<STRING>["", ""],
    NULL,
    {"name":"Saving"}
  },
  {10, ARRAY<STRING>(NULL), NULL, {"name":"Saving"}},
  {11, ARRAY<STRING>[], NULL, {"name":"Saving"}}
]
==
[prepare_database]
CREATE TABLE DynamicSingleLabelGraphEdge AS
(SELECT 100 AS id, 4 AS from_dynamic_node_id, 5 AS to_dynamic_node_id, "transfer" AS edgeLabelCol, "Interest" AS category, JSON '{"amount": 10.0, "location": "USA"}' AS edgePropCol, TIMESTAMP '2000-01-01 00:00:00' AS since) UNION ALL
(SELECT 200 AS id, 5 AS from_dynamic_node_id, 6 AS to_dynamic_node_id, "transfer" AS edgeLabelCol, "Payment" AS category, JSON '{"amount": 1000.0, "location": "China"}' AS edgePropCol, TIMESTAMP '2000-01-02 00:00:00' AS since) UNION ALL
(SELECT 300 AS id, 4 AS from_dynamic_node_id, 6 AS to_dynamic_node_id, "transfer" AS edgeLabelCol, "Payment" AS category, JSON '{"amount": 2000.0, "location": null}' AS edgePropCol, TIMESTAMP '2000-01-03 00:00:00' AS since) UNION ALL
(SELECT 400 AS id, 1 AS from_dynamic_node_id, 4 AS to_dynamic_node_id, "owns" AS edgeLabelCol, "Personal" AS category, JSON '{"amount": 2000.0, "location": "India"}' AS edgePropCol, TIMESTAMP '2000-01-03 00:00:00' AS since) UNION ALL
(SELECT 500 AS id, 2 AS from_dynamic_node_id, 5 AS to_dynamic_node_id, "owns" AS edgeLabelCol, "Business" AS category, JSON '{"amount": 2000.0, "location": "India"}' AS edgePropCol, TIMESTAMP '2000-01-03 00:00:00' AS since) UNION ALL
(SELECT 600 AS id, 3 AS from_dynamic_node_id, 6 AS to_dynamic_node_id, "owns" AS edgeLabelCol, "Personal" AS category, JSON '{"amount": 2000.0, "location": "India"}' AS edgePropCol, TIMESTAMP '2000-01-03 00:00:00' AS since) UNION ALL
(SELECT 700 AS id, 5 AS from_dynamic_node_id, 4 AS to_dynamic_node_id, CAST(NULL AS STRING) AS edgeLabelCol, NULL AS category, CAST(NULL AS JSON) AS edgePropCol, TIMESTAMP '2000-01-03 00:00:00' AS since) UNION ALL
(SELECT 800 AS id, 4 AS from_dynamic_node_id, 6 AS to_dynamic_node_id, "transfer" AS edgeLabelCol, "Payment" AS category, JSON '{"amount": 5000.0, "location": "USA"}' AS edgePropCol, TIMESTAMP '2000-01-03 00:00:00' AS since)
--
ARRAY<STRUCT<
        id INT64,
        from_dynamic_node_id INT64,
        to_dynamic_node_id INT64,
        edgeLabelCol STRING,
        category STRING,
        edgePropCol JSON,
        since TIMESTAMP
      >>
[{
   100,
   4,
   5,
   "transfer",
   "Interest",
   {"amount":10.0,"location":"USA"},
   2000-01-01 08:00:00+00
 },
 {
   200,
   5,
   6,
   "transfer",
   "Payment",
   {"amount":1000.0,"location":"China"},
   2000-01-02 08:00:00+00
 },
 {
   300,
   4,
   6,
   "transfer",
   "Payment",
   {"amount":2000.0,"location":null},
   2000-01-03 08:00:00+00
 },
 {
   400,
   1,
   4,
   "owns",
   "Personal",
   {"amount":2000.0,"location":"India"},
   2000-01-03 08:00:00+00
 },
 {
   500,
   2,
   5,
   "owns",
   "Business",
   {"amount":2000.0,"location":"India"},
   2000-01-03 08:00:00+00
 },
 {
   600,
   3,
   6,
   "owns",
   "Personal",
   {"amount":2000.0,"location":"India"},
   2000-01-03 08:00:00+00
 },
 {
   700,
   5,
   4,
   NULL,
   NULL,
   NULL,
   2000-01-03 08:00:00+00
 },
 {
   800,
   4,
   6,
   "transfer",
   "Payment",
   {"amount":5000.0,"location":"USA"},
   2000-01-03 08:00:00+00
 }]
==
[prepare_database]
CREATE PROPERTY GRAPH aml_dynamic_multi_label
  NODE TABLES (
    DynamicMultiLabelGraphNode AS DynamicGraphNode KEY (id)
              DEFAULT LABEL PROPERTIES (
                1000 + id AS account_id,
                code AS account_code)
              LABEL Entity PROPERTIES (code)
              DYNAMIC LABEL (nodeLabelCol)
              DYNAMIC PROPERTIES (nodePropCol)
  )
  EDGE TABLES (
    DynamicSingleLabelGraphEdge AS Relation KEY (id)
              SOURCE KEY (from_dynamic_node_id) REFERENCES DynamicGraphNode(id)
              DESTINATION KEY (to_dynamic_node_id) REFERENCES DynamicGraphNode(id)
              DEFAULT LABEL PROPERTIES ALL COLUMNS
              LABEL Connection PROPERTIES (category)
              DYNAMIC LABEL (edgeLabelCol)
              DYNAMIC PROPERTIES (edgePropCol)
  )
==

###############################################################################
# GQL dynamic multi label matching
###############################################################################

[name=is_labeled_dynamic_label_aml_dynamic_multi_label]
# Dynamic label in IS LABELED predicate in element table with:
# dynamic label + dynamic properties
select gt.* from
graph_table(aml_dynamic_multi_label
  match (n)
  return n.account_id AS id, n IS LABELED NodeLabel1 AS is_dynamic_label_1
) gt
ORDER BY 1
--
ARRAY<STRUCT<
        id INT64,
        is_dynamic_label_1 BOOL
      >>
[known order:{1001, false},
             {1002, false},
             {1003, false},
             {1004, false},
             {1005, false},
             {1006, false},
             {1007, false},
             {1008, false},
             {1009, false},
             {1010, false},
             {1011, false}]
==

[name=static_property_access_aml_dynamic_multi_label]
select gt.* from
graph_table(aml_dynamic_multi_label
  match (n WHERE n.account_code = 3000)
  return n.account_id AS id
) gt
ORDER BY 1
--
ARRAY<STRUCT<id INT64>>[{1003}]
==

[name=dynamic_property_access_aml_dynamic_multi_label]
select gt.* from
graph_table(aml_dynamic_multi_label
  match (n { account_code: 3000, name : "Cindy" })
  return n.account_id AS id, n.name AS name
) gt
ORDER BY 1
--
ARRAY<STRUCT<id INT64, name JSON>>[{1003, "Cindy"}]
==

[name=node_edge_labels_aml_dynamic_multi_label]
select gt.* from
graph_table(aml_dynamic_multi_label
  match (n) -[e]-> ()
  return
    e.from_dynamic_node_id AS from_node_id,
    e.to_dynamic_node_id AS to_node_id,
    LABELS(n) AS node_labels,
    LABELS(e) AS edge_labels
) gt
ORDER BY 1, 2
--
ARRAY<STRUCT<from_node_id INT64,
             to_node_id INT64,
             node_labels ARRAY<>,
             edge_labels ARRAY<>>>
[known order:
  {1,
   4,
   ARRAY<STRING>[known order:
     "DynamicGraphNode",
     "engineer",
     "Entity",
     "person",
     "teacher"
   ],
   ARRAY<STRING>[known order:"Connection", "owns", "Relation"]},
  {
    2,
    5,
    ARRAY<STRING>[known order:"admin", "DynamicGraphNode", "Entity", "person"],
    ARRAY<STRING>[known order:"Connection", "owns", "Relation"]
  },
  {3,
   6,
   ARRAY<STRING>[known order:
     "DynamicGraphNode",
     "Entity",
     "person",
     "researcher"
   ],
   ARRAY<STRING>[known order:"Connection", "owns", "Relation"]},
  {4,
   5,
   ARRAY<STRING>[known order:
     "account",
     "checking_account",
     "DynamicGraphNode",
     "Entity"
   ],
   ARRAY<STRING>[known order:"Connection", "Relation", "transfer"]},
  {4,
   6,
   ARRAY<STRING>[known order:
     "account",
     "checking_account",
     "DynamicGraphNode",
     "Entity"
   ],
   ARRAY<STRING>[known order:"Connection", "Relation", "transfer"]},
  {4,
   6,
   ARRAY<STRING>[known order:
     "account",
     "checking_account",
     "DynamicGraphNode",
     "Entity"
   ],
   ARRAY<STRING>[known order:"Connection", "Relation", "transfer"]},
  {5,
   4,
   ARRAY<STRING>[known order:
     "account",
     "DynamicGraphNode",
     "Entity",
     "saving_account"
   ],
   ARRAY<STRING>[known order:"Connection", "Relation"]},
  {5,
   6,
   ARRAY<STRING>[known order:
     "account",
     "DynamicGraphNode",
     "Entity",
     "saving_account"
   ],
   ARRAY<STRING>[known order:"Connection", "Relation", "transfer"]}
]
==

[name=node_edge_property_exists_aml_dynamic_multi_label]
select gt.* from
graph_table(aml_dynamic_multi_label
  match (n) -[e]-> ()
  return
    e.from_dynamic_node_id AS from_node_id,
    e.to_dynamic_node_id AS to_node_id,
    PROPERTY_EXISTS(n, name) AS node_has_property_name,
    PROPERTY_EXISTS(e, location) AS edge_has_property_location
) gt
ORDER BY 1, 2
--
ARRAY<STRUCT<
        from_node_id INT64,
        to_node_id INT64,
        node_has_property_name BOOL,
        edge_has_property_location BOOL
      >>
[known order:{1, 4, true, true},
             {2, 5, true, true},
             {3, 6, true, true},
             {4, 5, true, true},
             {4, 6, true, true},
             {4, 6, true, true},
             {5, 4, true, false},
             {5, 6, true, true}]
==


[name=node_edge_property_names_aml_dynamic_multi_label]
select gt.* from
graph_table(aml_dynamic_multi_label
  match (n) -[e]-> ()
  return
    e.from_dynamic_node_id AS from_node_id,
    e.to_dynamic_node_id AS to_node_id,
    PROPERTY_NAMES(n) AS node_property_names,
    PROPERTY_NAMES(e) AS edge_property_names
) gt
ORDER BY 1, 2
--
ARRAY<STRUCT<
        from_node_id INT64,
        to_node_id INT64,
        node_property_names ARRAY<>,
        edge_property_names ARRAY<>
      >>
[known order:
  {1,
   4,
   ARRAY<STRING>[known order:"account_code", "account_id", "code", "name"],
   ARRAY<STRING>[known order:
     "amount",
     "category",
     "edgeLabelCol",
     "edgePropCol",
     "from_dynamic_node_id",
     "id",
     "location",
     "since",
     "to_dynamic_node_id"
   ]},
  {2,
   5,
   ARRAY<STRING>[known order:"account_code", "account_id", "code", "name"],
   ARRAY<STRING>[known order:
     "amount",
     "category",
     "edgeLabelCol",
     "edgePropCol",
     "from_dynamic_node_id",
     "id",
     "location",
     "since",
     "to_dynamic_node_id"
   ]},
  {3,
   6,
   ARRAY<STRING>[known order:"account_code", "account_id", "code", "name"],
   ARRAY<STRING>[known order:
     "amount",
     "category",
     "edgeLabelCol",
     "edgePropCol",
     "from_dynamic_node_id",
     "id",
     "location",
     "since",
     "to_dynamic_node_id"
   ]},
  {4,
   5,
   ARRAY<STRING>[known order:"account_code", "account_id", "code", "name"],
   ARRAY<STRING>[known order:
     "amount",
     "category",
     "edgeLabelCol",
     "edgePropCol",
     "from_dynamic_node_id",
     "id",
     "location",
     "since",
     "to_dynamic_node_id"
   ]},
  {4,
   6,
   ARRAY<STRING>[known order:"account_code", "account_id", "code", "name"],
   ARRAY<STRING>[known order:
     "amount",
     "category",
     "edgeLabelCol",
     "edgePropCol",
     "from_dynamic_node_id",
     "id",
     "location",
     "since",
     "to_dynamic_node_id"
   ]},
  {4,
   6,
   ARRAY<STRING>[known order:"account_code", "account_id", "code", "name"],
   ARRAY<STRING>[known order:
     "amount",
     "category",
     "edgeLabelCol",
     "edgePropCol",
     "from_dynamic_node_id",
     "id",
     "location",
     "since",
     "to_dynamic_node_id"
   ]},
  {5,
   4,
   ARRAY<STRING>[known order:"account_code", "account_id", "code", "name"],
   ARRAY<STRING>[known order:
     "category",
     "edgeLabelCol",
     "edgePropCol",
     "from_dynamic_node_id",
     "id",
     "since",
     "to_dynamic_node_id"
   ]},
  {5,
   6,
   ARRAY<STRING>[known order:"account_code", "account_id", "code", "name"],
   ARRAY<STRING>[known order:
     "amount",
     "category",
     "edgeLabelCol",
     "edgePropCol",
     "from_dynamic_node_id",
     "id",
     "location",
     "since",
     "to_dynamic_node_id"
   ]}
]
==

[name=node_edge_to_json_aml_dynamic_multi_label]
[required_features=SQL_GRAPH,SQL_GRAPH_ADVANCED_QUERY,SQL_GRAPH_DYNAMIC_ELEMENT_TYPE,SQL_GRAPH_DYNAMIC_LABEL_PROPERTIES_IN_DDL,SQL_GRAPH_EXPOSE_GRAPH_ELEMENT,JSON_TYPE,JSON_MUTATOR_FUNCTIONS,SQL_GRAPH_DYNAMIC_MULTI_LABEL_NODES]
select gt.* from
graph_table(aml_dynamic_multi_label
  match (n) -[e]-> ()
  return
    e.from_dynamic_node_id AS from_node_id,
    e.to_dynamic_node_id AS to_node_id,
    JSON_REMOVE(TO_JSON(n), "$.identifier") AS node_json,
    JSON_REMOVE(TO_JSON(e), "$.identifier", "$.source_node_identifier", "$.destination_node_identifier") AS edge_json
) gt
ORDER BY 1, 2
--
ARRAY<STRUCT<from_node_id INT64, to_node_id INT64, node_json JSON, edge_json JSON>>[unknown order:
  {
    1,
    4,
    {"kind":"node","labels":["DynamicGraphNode","engineer","Entity","person","teacher"],"properties":{"account_code":1000,"account_id":1001,"code":1000,"name":"Alice"}},
    {"kind":"edge","labels":["Connection","owns","Relation"],"properties":{"amount":2000.0,"category":"Personal","edgeLabelCol":"owns","edgePropCol":{"amount":2000.0,"location":"India"},"from_dynamic_node_id":1,"id":400,"location":"India","since":"2000-01-03T08:00:00Z","to_dynamic_node_id":4}}
  },
  {
    2,
    5,
    {"kind":"node","labels":["admin","DynamicGraphNode","Entity","person"],"properties":{"account_code":2000,"account_id":1002,"code":2000,"name":"Bob"}},
    {"kind":"edge","labels":["Connection","owns","Relation"],"properties":{"amount":2000.0,"category":"Business","edgeLabelCol":"owns","edgePropCol":{"amount":2000.0,"location":"India"},"from_dynamic_node_id":2,"id":500,"location":"India","since":"2000-01-03T08:00:00Z","to_dynamic_node_id":5}}
  },
  {
    3,
    6,
    {"kind":"node","labels":["DynamicGraphNode","Entity","person","researcher"],"properties":{"account_code":3000,"account_id":1003,"code":3000,"name":"Cindy"}},
    {"kind":"edge","labels":["Connection","owns","Relation"],"properties":{"amount":2000.0,"category":"Personal","edgeLabelCol":"owns","edgePropCol":{"amount":2000.0,"location":"India"},"from_dynamic_node_id":3,"id":600,"location":"India","since":"2000-01-03T08:00:00Z","to_dynamic_node_id":6}}
  },
  {
    4,
    5,
    {"kind":"node","labels":["account","checking_account","DynamicGraphNode","Entity"],"properties":{"account_code":4000,"account_id":1004,"code":4000,"name":"Checking"}},
    {"kind":"edge","labels":["Connection","Relation","transfer"],"properties":{"amount":10.0,"category":"Interest","edgeLabelCol":"transfer","edgePropCol":{"amount":10.0,"location":"USA"},"from_dynamic_node_id":4,"id":100,"location":"USA","since":"2000-01-01T08:00:00Z","to_dynamic_node_id":5}}
  },
  {
    4,
    6,
    {"kind":"node","labels":["account","checking_account","DynamicGraphNode","Entity"],"properties":{"account_code":4000,"account_id":1004,"code":4000,"name":"Checking"}},
    {"kind":"edge","labels":["Connection","Relation","transfer"],"properties":{"amount":5000.0,"category":"Payment","edgeLabelCol":"transfer","edgePropCol":{"amount":5000.0,"location":"USA"},"from_dynamic_node_id":4,"id":800,"location":"USA","since":"2000-01-03T08:00:00Z","to_dynamic_node_id":6}}
  },
  {
    4,
    6,
    {"kind":"node","labels":["account","checking_account","DynamicGraphNode","Entity"],"properties":{"account_code":4000,"account_id":1004,"code":4000,"name":"Checking"}},
    {"kind":"edge","labels":["Connection","Relation","transfer"],"properties":{"amount":2000.0,"category":"Payment","edgeLabelCol":"transfer","edgePropCol":{"amount":2000.0,"location":null},"from_dynamic_node_id":4,"id":300,"location":null,"since":"2000-01-03T08:00:00Z","to_dynamic_node_id":6}}
  },
  {
    5,
    4,
    {"kind":"node","labels":["account","DynamicGraphNode","Entity","saving_account"],"properties":{"account_code":5000,"account_id":1005,"code":5000,"name":"Saving"}},
    {"kind":"edge","labels":["Connection","Relation"],"properties":{"category":null,"edgeLabelCol":null,"edgePropCol":null,"from_dynamic_node_id":5,"id":700,"since":"2000-01-03T08:00:00Z","to_dynamic_node_id":4}}
  },
  {
    5,
    6,
    {"kind":"node","labels":["account","DynamicGraphNode","Entity","saving_account"],"properties":{"account_code":5000,"account_id":1005,"code":5000,"name":"Saving"}},
    {"kind":"edge","labels":["Connection","Relation","transfer"],"properties":{"amount":1000.0,"category":"Payment","edgeLabelCol":"transfer","edgePropCol":{"amount":1000.0,"location":"China"},"from_dynamic_node_id":5,"id":200,"location":"China","since":"2000-01-02T08:00:00Z","to_dynamic_node_id":6}}
  }
]
==

[name=node_edge_typeof_aml_dynamic_multi_label]
[required_features=SQL_GRAPH,SQL_GRAPH_ADVANCED_QUERY,SQL_GRAPH_DYNAMIC_ELEMENT_TYPE,SQL_GRAPH_DYNAMIC_LABEL_PROPERTIES_IN_DDL,JSON_TYPE,TYPEOF_FUNCTION,SQL_GRAPH_DYNAMIC_MULTI_LABEL_NODES]
select gt.* from
graph_table(aml_dynamic_multi_label
  match (n) -[e]-> ()
  return
    e.from_dynamic_node_id AS from_node_id,
    e.to_dynamic_node_id AS to_node_id,
    TYPEOF(n) AS node_type,
    TYPEOF(e) AS edge_type
) gt
ORDER BY 1, 2
--
ARRAY<STRUCT<from_node_id INT64,
             to_node_id INT64,
             node_type STRING,
             edge_type STRING>>
[known order:
  {
    1,
    4,
    "GRAPH_NODE(aml_dynamic_multi_label)<account_code INT64, account_id INT64, code INT64, DYNAMIC>",
    "GRAPH_EDGE(aml_dynamic_multi_label)<category STRING, edgeLabelCol STRING, edgePropCol JSON, from_dynamic_node_id INT64, id INT64, since TIMESTAMP, to_dynamic_node_id INT64, DYNAMIC>"
  },
  {
    2,
    5,
    "GRAPH_NODE(aml_dynamic_multi_label)<account_code INT64, account_id INT64, code INT64, DYNAMIC>",
    "GRAPH_EDGE(aml_dynamic_multi_label)<category STRING, edgeLabelCol STRING, edgePropCol JSON, from_dynamic_node_id INT64, id INT64, since TIMESTAMP, to_dynamic_node_id INT64, DYNAMIC>"
  },
  {
    3,
    6,
    "GRAPH_NODE(aml_dynamic_multi_label)<account_code INT64, account_id INT64, code INT64, DYNAMIC>",
    "GRAPH_EDGE(aml_dynamic_multi_label)<category STRING, edgeLabelCol STRING, edgePropCol JSON, from_dynamic_node_id INT64, id INT64, since TIMESTAMP, to_dynamic_node_id INT64, DYNAMIC>"
  },
  {
    4,
    5,
    "GRAPH_NODE(aml_dynamic_multi_label)<account_code INT64, account_id INT64, code INT64, DYNAMIC>",
    "GRAPH_EDGE(aml_dynamic_multi_label)<category STRING, edgeLabelCol STRING, edgePropCol JSON, from_dynamic_node_id INT64, id INT64, since TIMESTAMP, to_dynamic_node_id INT64, DYNAMIC>"
  },
  {
    4,
    6,
    "GRAPH_NODE(aml_dynamic_multi_label)<account_code INT64, account_id INT64, code INT64, DYNAMIC>",
    "GRAPH_EDGE(aml_dynamic_multi_label)<category STRING, edgeLabelCol STRING, edgePropCol JSON, from_dynamic_node_id INT64, id INT64, since TIMESTAMP, to_dynamic_node_id INT64, DYNAMIC>"
  },
  {
    4,
    6,
    "GRAPH_NODE(aml_dynamic_multi_label)<account_code INT64, account_id INT64, code INT64, DYNAMIC>",
    "GRAPH_EDGE(aml_dynamic_multi_label)<category STRING, edgeLabelCol STRING, edgePropCol JSON, from_dynamic_node_id INT64, id INT64, since TIMESTAMP, to_dynamic_node_id INT64, DYNAMIC>"
  },
  {
    5,
    4,
    "GRAPH_NODE(aml_dynamic_multi_label)<account_code INT64, account_id INT64, code INT64, DYNAMIC>",
    "GRAPH_EDGE(aml_dynamic_multi_label)<category STRING, edgeLabelCol STRING, edgePropCol JSON, from_dynamic_node_id INT64, id INT64, since TIMESTAMP, to_dynamic_node_id INT64, DYNAMIC>"
  },
  {
    5,
    6,
    "GRAPH_NODE(aml_dynamic_multi_label)<account_code INT64, account_id INT64, code INT64, DYNAMIC>",
    "GRAPH_EDGE(aml_dynamic_multi_label)<category STRING, edgeLabelCol STRING, edgePropCol JSON, from_dynamic_node_id INT64, id INT64, since TIMESTAMP, to_dynamic_node_id INT64, DYNAMIC>"
  }
]
==

[name=node_dynamic_label_expr]
SELECT gt.* FROM GRAPH_TABLE(
  aml_dynamic_multi_label
  MATCH (n: Account)
  RETURN n.code AS code, labels(n) AS labels
) gt
ORDER BY 1
--
ARRAY<STRUCT<code INT64, labels ARRAY<>>>[known order:
  {4000,
   ARRAY<STRING>[known order:
     "account",
     "checking_account",
     "DynamicGraphNode",
     "Entity"
   ]},
  {5000,
   ARRAY<STRING>[known order:
     "account",
     "DynamicGraphNode",
     "Entity",
     "saving_account"
   ]},
  {6000,
   ARRAY<STRING>[known order:
     "account",
     "DynamicGraphNode",
     "Entity",
     "holiday_account"
   ]}
]
==

[name=node_dynamic_label_expr_entity]
SELECT gt.* FROM GRAPH_TABLE(
  aml_dynamic_multi_label
  MATCH (n: Entity)
  RETURN n.code AS code, labels(n) AS labels
) gt
ORDER BY 1
--
ARRAY<STRUCT<code INT64, labels ARRAY<>>>[known order:
  {
    NULL,
    ARRAY<STRING>[known order:"DynamicGraphNode", "Entity"]
  },
  {
    NULL,
    ARRAY<STRING>[known order:"DynamicGraphNode", "Entity"]
  },
  {
    NULL,
    ARRAY<STRING>[known order:"DynamicGraphNode", "Entity"]
  },
  {
    NULL,
    ARRAY<STRING>[known order:"DynamicGraphNode", "Entity"]
  },
  {1000,
   ARRAY<STRING>[known order:
     "DynamicGraphNode",
     "engineer",
     "Entity",
     "person",
     "teacher"
   ]},
  {
    2000,
    ARRAY<STRING>[known order:"admin", "DynamicGraphNode", "Entity", "person"]
  },
  {3000,
   ARRAY<STRING>[known order:
     "DynamicGraphNode",
     "Entity",
     "person",
     "researcher"
   ]},
  {4000,
   ARRAY<STRING>[known order:
     "account",
     "checking_account",
     "DynamicGraphNode",
     "Entity"
   ]},
  {5000,
   ARRAY<STRING>[known order:
     "account",
     "DynamicGraphNode",
     "Entity",
     "saving_account"
   ]},
  {6000,
   ARRAY<STRING>[known order:
     "account",
     "DynamicGraphNode",
     "Entity",
     "holiday_account"
   ]},
  {
    8000,
    ARRAY<STRING>[known order:"DynamicGraphNode", "Entity", "person", "teacher"]
  }
]
==

[name=node_dynamic_label_expr_and]
SELECT gt.* FROM GRAPH_TABLE(
  aml_dynamic_multi_label
  MATCH (n: Account & Entity)
  RETURN n.code AS code, labels(n) AS labels
) gt
ORDER BY 1
--
ARRAY<STRUCT<code INT64, labels ARRAY<>>>[known order:
  {4000,
   ARRAY<STRING>[known order:
     "account",
     "checking_account",
     "DynamicGraphNode",
     "Entity"
   ]},
  {5000,
   ARRAY<STRING>[known order:
     "account",
     "DynamicGraphNode",
     "Entity",
     "saving_account"
   ]},
  {6000,
   ARRAY<STRING>[known order:
     "account",
     "DynamicGraphNode",
     "Entity",
     "holiday_account"
   ]}
]
==

[name=node_dynamic_label_expr_or]
SELECT gt.* FROM GRAPH_TABLE(
  aml_dynamic_multi_label
  MATCH (n: Account | Entity)
  RETURN n.code AS code, labels(n) AS labels
) gt
ORDER BY 1
--
ARRAY<STRUCT<code INT64, labels ARRAY<>>>[known order:
  {
    NULL,
    ARRAY<STRING>[known order:"DynamicGraphNode", "Entity"]
  },
  {
    NULL,
    ARRAY<STRING>[known order:"DynamicGraphNode", "Entity"]
  },
  {
    NULL,
    ARRAY<STRING>[known order:"DynamicGraphNode", "Entity"]
  },
  {
    NULL,
    ARRAY<STRING>[known order:"DynamicGraphNode", "Entity"]
  },
  {1000,
   ARRAY<STRING>[known order:
     "DynamicGraphNode",
     "engineer",
     "Entity",
     "person",
     "teacher"
   ]},
  {
    2000,
    ARRAY<STRING>[known order:"admin", "DynamicGraphNode", "Entity", "person"]
  },
  {3000,
   ARRAY<STRING>[known order:
     "DynamicGraphNode",
     "Entity",
     "person",
     "researcher"
   ]},
  {4000,
   ARRAY<STRING>[known order:
     "account",
     "checking_account",
     "DynamicGraphNode",
     "Entity"
   ]},
  {5000,
   ARRAY<STRING>[known order:
     "account",
     "DynamicGraphNode",
     "Entity",
     "saving_account"
   ]},
  {6000,
   ARRAY<STRING>[known order:
     "account",
     "DynamicGraphNode",
     "Entity",
     "holiday_account"
   ]},
  {
    8000,
    ARRAY<STRING>[known order:"DynamicGraphNode", "Entity", "person", "teacher"]
  }
]
==

[name=node_dynamic_label_expr_negate]
SELECT gt.* FROM GRAPH_TABLE(
  aml_dynamic_multi_label
  MATCH (n: !Account)
  RETURN n.code AS code, labels(n) AS labels
) gt
ORDER BY 1
--
ARRAY<STRUCT<code INT64, labels ARRAY<>>>[known order:
  {
    NULL,
    ARRAY<STRING>[known order:"DynamicGraphNode", "Entity"]
  },
  {
    NULL,
    ARRAY<STRING>[known order:"DynamicGraphNode", "Entity"]
  },
  {
    NULL,
    ARRAY<STRING>[known order:"DynamicGraphNode", "Entity"]
  },
  {
    NULL,
    ARRAY<STRING>[known order:"DynamicGraphNode", "Entity"]
  },
  {1000,
   ARRAY<STRING>[known order:
     "DynamicGraphNode",
     "engineer",
     "Entity",
     "person",
     "teacher"
   ]},
  {
    2000,
    ARRAY<STRING>[known order:"admin", "DynamicGraphNode", "Entity", "person"]
  },
  {3000,
   ARRAY<STRING>[known order:
     "DynamicGraphNode",
     "Entity",
     "person",
     "researcher"
   ]},
  {
    8000,
    ARRAY<STRING>[known order:"DynamicGraphNode", "Entity", "person", "teacher"]
  }
]
==

[required_features=SQL_GRAPH,SQL_GRAPH_ADVANCED_QUERY,SQL_GRAPH_DYNAMIC_ELEMENT_TYPE,SQL_GRAPH_DYNAMIC_LABEL_PROPERTIES_IN_DDL,SQL_GRAPH_DYNAMIC_MULTI_LABEL_NODES]
[name=node_dynamic_label_expr_negate_entity]
SELECT gt.* FROM GRAPH_TABLE(
  aml_dynamic_multi_label
  MATCH (n: !Entity)
  RETURN labels(n) AS labels
) gt
--
ARRAY<STRUCT<labels ARRAY<STRING>>>[]
==

[required_features=SQL_GRAPH,SQL_GRAPH_ADVANCED_QUERY,SQL_GRAPH_DYNAMIC_ELEMENT_TYPE,SQL_GRAPH_DYNAMIC_LABEL_PROPERTIES_IN_DDL,SQL_GRAPH_DYNAMIC_MULTI_LABEL_NODES]
[name=node_dynamic_label_expr_negate_and]
SELECT gt.* FROM GRAPH_TABLE(
  aml_dynamic_multi_label
  MATCH (n: !Account & !Entity)
  RETURN labels(n) AS labels
) gt
--
ARRAY<STRUCT<labels ARRAY<STRING>>>[]
==

[name=node_dynamic_label_expr_negate_and_both_dynamic]
SELECT gt.* FROM GRAPH_TABLE(
  aml_dynamic_multi_label
  MATCH (n: !Account & !Teacher)
  RETURN n.account_id, labels(n) AS labels
) gt
ORDER BY 1
--
ARRAY<STRUCT<account_id INT64, labels ARRAY<>>>[known order:
  {
    1002,
    ARRAY<STRING>[known order:"admin", "DynamicGraphNode", "Entity", "person"]
  },
  {1003,
   ARRAY<STRING>[known order:
     "DynamicGraphNode",
     "Entity",
     "person",
     "researcher"
   ]},
  {
    1007,
    ARRAY<STRING>[known order:"DynamicGraphNode", "Entity"]
  },
  {
    1009,
    ARRAY<STRING>[known order:"DynamicGraphNode", "Entity"]
  },
  {
    1010,
    ARRAY<STRING>[known order:"DynamicGraphNode", "Entity"]
  },
  {
    1011,
    ARRAY<STRING>[known order:"DynamicGraphNode", "Entity"]
  }
]
==

[name=edge_dynamic_label_expr]
SELECT gt.* FROM GRAPH_TABLE(aml_dynamic_multi_label
  MATCH -[e: Transfer&Connection]->
  RETURN e.Id, e.Amount, e.location
) gt
ORDER BY 1
--
ARRAY<STRUCT<Id INT64, Amount JSON, location JSON>>[known order:
  {100, 10.0, "USA"},
  {200, 1000.0, "China"},
  {300, 2000.0, null},
  {800, 5000.0, "USA"}
]
