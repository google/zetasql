[default reserve_graph_table]
[load_proto_files=zetasql/testdata/test_schema.proto]
[load_proto_names=zetasql_test__.KitchenSinkPB]

[prepare_database]
CREATE TABLE person AS
(SELECT 1 AS id, "name1" AS name) UNION ALL
(SELECT 2 AS id, "name2" AS name) UNION ALL
(SELECT 3 as id, "name3" AS name) UNION ALL
(SELECT 4 as id, "name4" AS name)
--
ARRAY<STRUCT<id INT64, name STRING>>[
  {1, "name1"},
  {2, "name2"},
  {3, "name3"},
  {4, "name4"}
]
==

[prepare_database]
CREATE TABLE person_knows_person AS
(SELECT 100 AS id, 2 AS from_person_id, 1 AS to_person_id, TIMESTAMP '2000-01-01 00:00:00' AS since) UNION ALL
(SELECT 200 AS id, 1 AS from_person_id, 2 AS to_person_id, TIMESTAMP '2000-01-02 00:00:00' AS since) UNION ALL
(SELECT 300 AS id, 2 AS from_person_id, 3 AS to_person_id, TIMESTAMP '2000-01-03 00:00:00' AS since) UNION ALL
(SELECT 400 AS id, 3 AS from_person_id, 1 AS to_person_id, TIMESTAMP '2000-01-04 00:00:00' AS since) UNION ALL
(SELECT 500 AS id, 3 AS from_person_id, 4 AS to_person_id, TIMESTAMP '2000-01-05 00:00:00' AS since)
--
ARRAY<STRUCT<id INT64, from_person_id INT64, to_person_id INT64, since TIMESTAMP>>[
  {
    100,
    2,
    1,
    2000-01-01 08:00:00+00
  },
  {
    200,
    1,
    2,
    2000-01-02 08:00:00+00
  },
  {
    300,
    2,
    3,
    2000-01-03 08:00:00+00
  },
  {
    400,
    3,
    1,
    2000-01-04 08:00:00+00
  },
  {
    500,
    3,
    4,
    2000-01-05 08:00:00+00
  }
]
==

[prepare_database]
CREATE PROPERTY GRAPH aml_cyclic
  NODE TABLES (
    Person KEY(id)
    LABEL Human PROPERTIES(
      id,
      name)
    LABEL HasId PROPERTIES (id as key_id))
  EDGE TABLES (
    person_knows_person AS Knows KEY(id)
              SOURCE KEY(from_person_id) REFERENCES Person(id)
              DESTINATION KEY(to_person_id) REFERENCES Person(id)
              DEFAULT LABEL PROPERTIES(id, since),

  )
==

[name=walk_mode_quantified_two_hop_and_one_hop_nodes]
[required_features=SQL_GRAPH,SQL_GRAPH_ADVANCED_QUERY,SQL_GRAPH_BOUNDED_PATH_QUANTIFICATION]
GRAPH aml_cyclic
MATCH ((a)->{2}())->(b)
return a.id AS src_id, b.id AS dest_id
ORDER BY src_id, dest_id
--
ARRAY<STRUCT<src_id INT64, dest_id INT64>>[unknown order:
  {1, 1},
  {1, 2},
  {1, 4},
  {2, 1},
  {2, 2},
  {2, 3},
  {3, 1},
  {3, 3}
]
==

[name=walk_mode_quantified_three_hop_nodes_edges]
[required_features=SQL_GRAPH,SQL_GRAPH_ADVANCED_QUERY,SQL_GRAPH_BOUNDED_PATH_QUANTIFICATION]
GRAPH aml_cyclic
MATCH ((a)-[e]->{3})(b)
return a.id AS src_id, b.id AS dest_id, e[OFFSET(0)].id AS eid1, e[OFFSET(1)].id AS eid2, e[OFFSET(2)].id AS eid3
ORDER BY src_id, dest_id, eid1, eid2, eid3
--
ARRAY<STRUCT<src_id INT64, dest_id INT64, eid1 INT64, eid2 INT64, eid3 INT64>>[unknown order:
  {1, 1, 200, 300, 400},
  {1, 2, 200, 100, 200},
  {1, 4, 200, 300, 500},
  {2, 1, 100, 200, 100},
  {2, 2, 300, 400, 200},
  {2, 3, 100, 200, 300},
  {3, 1, 400, 200, 100},
  {3, 3, 400, 200, 300}
]
==

[name=walk_mode_quantified_three_hop_edges_count_paths]
[required_features=SQL_GRAPH,SQL_GRAPH_ADVANCED_QUERY,SQL_GRAPH_BOUNDED_PATH_QUANTIFICATION]
GRAPH aml_cyclic
MATCH (-[e]->{3})()
RETURN COUNT(1) AS num_paths
--
ARRAY<STRUCT<num_paths INT64>>[{8}]
==

[name=trail_mode_quantified_two_hop_and_one_hop_nodes]
[required_features=SQL_GRAPH,SQL_GRAPH_ADVANCED_QUERY,SQL_GRAPH_BOUNDED_PATH_QUANTIFICATION,SQL_GRAPH_PATH_MODE]
GRAPH aml_cyclic
MATCH TRAIL ((a)->{2}())->(b)
return a.id AS src_id, b.id AS dest_id
ORDER BY src_id, dest_id
--
ARRAY<STRUCT<src_id INT64, dest_id INT64>>[unknown order:
  {1, 1},
  {1, 4},
  {2, 2},
  {2, 3},
  {3, 1},
  {3, 3}
]
==

[name=trail_mode_quantified_three_hop_nodes_edges]
[required_features=SQL_GRAPH,SQL_GRAPH_ADVANCED_QUERY,SQL_GRAPH_BOUNDED_PATH_QUANTIFICATION,SQL_GRAPH_PATH_MODE]
GRAPH aml_cyclic
MATCH TRAIL ((a)-[e]->{3})(b)
return a.id AS src_id, b.id AS dest_id, e[OFFSET(0)].id AS eid1, e[OFFSET(1)].id AS eid2, e[OFFSET(2)].id AS eid3
ORDER BY src_id, dest_id, eid1, eid2, eid3
--
ARRAY<STRUCT<src_id INT64, dest_id INT64, eid1 INT64, eid2 INT64, eid3 INT64>>[unknown order:
  {1, 1, 200, 300, 400},
  {1, 4, 200, 300, 500},
  {2, 2, 300, 400, 200},
  {2, 3, 100, 200, 300},
  {3, 1, 400, 200, 100},
  {3, 3, 400, 200, 300}
]
==

[name=trail_mode_quantified_three_hop_edges_count_paths]
[required_features=SQL_GRAPH,SQL_GRAPH_ADVANCED_QUERY,SQL_GRAPH_BOUNDED_PATH_QUANTIFICATION,SQL_GRAPH_PATH_MODE]
GRAPH aml_cyclic
MATCH TRAIL (-[e]->{3})()
RETURN COUNT(1) AS num_paths
--
ARRAY<STRUCT<num_paths INT64>>[{6}]
==

[name=acyclic_mode_quantified_two_hop_and_one_hop_nodes]
[required_features=SQL_GRAPH,SQL_GRAPH_ADVANCED_QUERY,SQL_GRAPH_BOUNDED_PATH_QUANTIFICATION,SQL_GRAPH_PATH_MODE]
GRAPH aml_cyclic
MATCH ACYCLIC ((a)->{2}())->(b)
return a.id AS src_id, b.id AS dest_id
ORDER BY src_id, dest_id
--
ARRAY<STRUCT<src_id INT64, dest_id INT64>>[{1, 4}]
==

[name=acyclic_mode_quantified_three_hop_nodes_edges]
[required_features=SQL_GRAPH,SQL_GRAPH_ADVANCED_QUERY,SQL_GRAPH_BOUNDED_PATH_QUANTIFICATION,SQL_GRAPH_PATH_MODE]
GRAPH aml_cyclic
MATCH ACYCLIC ((a)-[e]->{3})(b)
return a.id AS src_id, b.id AS dest_id, e[OFFSET(0)].id AS eid1, e[OFFSET(1)].id AS eid2, e[OFFSET(2)].id AS eid3
ORDER BY src_id, dest_id, eid1, eid2, eid3
--
ARRAY<STRUCT<src_id INT64, dest_id INT64, eid1 INT64, eid2 INT64, eid3 INT64>>[
  {1, 4, 200, 300, 500}
]
==

[name=acyclic_mode_quantified_three_hop_edges_count_paths]
[required_features=SQL_GRAPH,SQL_GRAPH_ADVANCED_QUERY,SQL_GRAPH_BOUNDED_PATH_QUANTIFICATION,SQL_GRAPH_PATH_MODE]
GRAPH aml_cyclic
MATCH ACYCLIC (-[e]->{3})()
RETURN COUNT(1) AS num_paths
--
ARRAY<STRUCT<num_paths INT64>>[{1}]
==

[name=simple_mode_quantified_two_hop_and_one_hop_nodes]
[required_features=SQL_GRAPH,SQL_GRAPH_ADVANCED_QUERY,SQL_GRAPH_BOUNDED_PATH_QUANTIFICATION,SQL_GRAPH_PATH_MODE]
GRAPH aml_cyclic
MATCH SIMPLE ((a)->{2}())->(b)
return a.id AS src_id, b.id AS dest_id
ORDER BY src_id, dest_id
--
ARRAY<STRUCT<src_id INT64, dest_id INT64>>[unknown order:
  {1, 1},
  {1, 4},
  {2, 2},
  {3, 3}
]
==

[name=simple_mode_quantified_three_hop_nodes_edges]
[required_features=SQL_GRAPH,SQL_GRAPH_ADVANCED_QUERY,SQL_GRAPH_BOUNDED_PATH_QUANTIFICATION,SQL_GRAPH_PATH_MODE]
GRAPH aml_cyclic
MATCH SIMPLE ((a)-[e]->{3})(b)
return a.id AS src_id, b.id AS dest_id, e[OFFSET(0)].id AS eid1, e[OFFSET(1)].id AS eid2, e[OFFSET(2)].id AS eid3
ORDER BY src_id, dest_id, eid1, eid2, eid3
--
ARRAY<STRUCT<src_id INT64, dest_id INT64, eid1 INT64, eid2 INT64, eid3 INT64>>[unknown order:
  {1, 1, 200, 300, 400},
  {1, 4, 200, 300, 500},
  {2, 2, 300, 400, 200},
  {3, 3, 400, 200, 300}
]
==

[name=simple_mode_quantified_three_hop_edges_count_paths]
[required_features=SQL_GRAPH,SQL_GRAPH_ADVANCED_QUERY,SQL_GRAPH_BOUNDED_PATH_QUANTIFICATION,SQL_GRAPH_PATH_MODE]
GRAPH aml_cyclic
MATCH SIMPLE (-[e]->{3})()
RETURN COUNT(1) AS num_paths
--
ARRAY<STRUCT<num_paths INT64>>[{4}]
==

