[load_proto_files=zetasql/testdata/test_schema.proto]
[load_proto_names=zetasql_test__.KitchenSinkPB, zetasql_test__.TestExtraPB, zetasql_test__.KitchenSinkPB.Nested, zetasql_test__.RepeatedHolderPB, zetasql_test__.EmptyMessage]
[load_enum_names=zetasql_test__.TestEnum]

[prepare_database]
CREATE TABLE AllArraysTable AS
  SELECT
    1 as key,
    ARRAY<BOOL>[true, false, true] bool_arrcol,
    ARRAY<INT32>[1, 0, -1] int32_arrcol,
    ARRAY<UINT32>[2, 1, 0] uint32_arrcol,
    ARRAY<INT64>[8589934592, 0, -8589934592] int64_arrcol,
    ARRAY<UINT64>[8589934592, 1, 0] uint64_arrcol,
    ARRAY<FLOAT>[1.1, 0.0, -1.1] float_arrcol,
    ARRAY<DOUBLE>[1.1, 0.0, -1.1] double_arrcol,
    ARRAY<STRING>['σ', 'π', '⨝'] string_arrcol,
    ARRAY<BYTES>[b"a", b"b", b"c"] bytes_arrcol,
    ARRAY<DATE>["1984-08-02", "2000-01-01", "2014-09-11"] date_arrcol,
    ARRAY<TIMESTAMP>["1984-08-02 01:01:01.001001 UTC",
                     "2000-01-01 01:01:01.001001 UTC",
                     "2014-09-11 01:01:01.001001 UTC"] micros_arrcol,
    ARRAY<zetasql_test__.TestEnum>[
      "TESTENUM0", "TESTENUM1", "TESTENUM2"] enum_arrcol,
    ARRAY<zetasql_test__.KitchenSinkPB>[
      '''
        int64_key_1: 11
        int64_key_2: 12
      ''',
      '''
        int64_key_1: 21
        int64_key_2: 22
      ''',
      '''
        int64_key_1: 31
        int64_key_2: 32
      '''] proto_arrcol,
    ARRAY<STRUCT<int64, int64>>[(11, 12), (21, 22), (31, 32)] struct_arrcol
UNION ALL
  SELECT
    2 as key,
    ARRAY<BOOL>[true, NULL, true],
    ARRAY<INT32>[1, NULL, -1],
    ARRAY<UINT32>[2, NULL, 0],
    ARRAY<INT64>[8589934592, NULL, -8589934592],
    ARRAY<UINT64>[8589934592, NULL, 0],
    ARRAY<FLOAT>[1.1, NULL, -1.1],
    ARRAY<DOUBLE>[1.1, NULL, -1.1],
    ARRAY<STRING>['σ', NULL, '⨝'],
    ARRAY<BYTES>[b"a", NULL, b"c"],
    ARRAY<DATE>["1984-08-02", NULL, "2014-09-11"],
    ARRAY<TIMESTAMP>["1984-08-02 01:01:01.001001 UTC", NULL,
                     "2014-09-11 01:01:01.001001 UTC"],
    ARRAY<zetasql_test__.TestEnum>["TESTENUM0", NULL, "TESTENUM2"],
    ARRAY<zetasql_test__.KitchenSinkPB>[
      '''
        int64_key_1: 11
        int64_key_2: 12
      ''',
      NULL,
      '''
        int64_key_1: 31
        int64_key_2: 32
      '''],
    ARRAY<STRUCT<int64, int64>>[(11, 12), NULL, (31, 32)]
UNION ALL
  SELECT
    3 as key,
    ARRAY<BOOL>[NULL, true],
    ARRAY<INT32>[NULL, -1],
    ARRAY<UINT32>[NULL, 0],
    ARRAY<INT64>[NULL, -8589934592],
    ARRAY<UINT64>[NULL, 0],
    ARRAY<FLOAT>[NULL, -1.1],
    ARRAY<DOUBLE>[NULL, -1.1],
    ARRAY<STRING>[NULL, '⨝'],
    ARRAY<BYTES>[NULL, b"c"],
    ARRAY<DATE>[NULL, "2014-09-11"],
    ARRAY<TIMESTAMP>[NULL, "2014-09-11 01:01:01.001001 UTC"],
    ARRAY<zetasql_test__.TestEnum>[NULL, "TESTENUM2"],
    ARRAY<zetasql_test__.KitchenSinkPB>[
      NULL,
      '''
        int64_key_1: 31
        int64_key_2: 32
      '''],
    ARRAY<STRUCT<int64, int64>>[NULL, (31, 32)]
UNION ALL
  SELECT
    4 as key,
    ARRAY<BOOL>[true, NULL],
    ARRAY<INT32>[1, NULL],
    ARRAY<UINT32>[2, NULL],
    ARRAY<INT64>[8589934592, NULL],
    ARRAY<UINT64>[8589934592, NULL],
    ARRAY<FLOAT>[1.1, NULL],
    ARRAY<DOUBLE>[1.1, NULL],
    ARRAY<STRING>['σ', NULL],
    ARRAY<BYTES>[b"a", NULL],
    ARRAY<DATE>["1984-08-02", NULL],
    ARRAY<TIMESTAMP>["1984-08-02 01:01:01.001001 UTC", NULL],
    ARRAY<zetasql_test__.TestEnum>["TESTENUM0", NULL],
    ARRAY<zetasql_test__.KitchenSinkPB>[
      '''
        int64_key_1: 11
        int64_key_2: 12
      ''', NULL],
    ARRAY<STRUCT<int64, int64>>[(11, 12), NULL]
UNION ALL
  SELECT
    5 as key,
    ARRAY<BOOL>[NULL, NULL],
    ARRAY<INT32>[NULL, NULL],
    ARRAY<UINT32>[NULL, NULL],
    ARRAY<INT64>[NULL, NULL],
    ARRAY<UINT64>[NULL, NULL],
    ARRAY<FLOAT>[NULL, NULL],
    ARRAY<DOUBLE>[NULL, NULL],
    ARRAY<STRING>[NULL, NULL],
    ARRAY<BYTES>[NULL, NULL],
    ARRAY<DATE>[NULL, NULL],
    ARRAY<TIMESTAMP>[NULL, NULL],
    ARRAY<zetasql_test__.TestEnum>[NULL, NULL],
    ARRAY<zetasql_test__.KitchenSinkPB>[NULL, NULL],
    ARRAY<STRUCT<int64, int64>>[NULL, NULL]
UNION ALL
  SELECT
    6 as key,
    ARRAY<BOOL>[NULL],
    ARRAY<INT32>[NULL],
    ARRAY<UINT32>[NULL],
    ARRAY<INT64>[NULL],
    ARRAY<UINT64>[NULL],
    ARRAY<FLOAT>[NULL],
    ARRAY<DOUBLE>[NULL],
    ARRAY<STRING>[NULL],
    ARRAY<BYTES>[NULL],
    ARRAY<DATE>[NULL],
    ARRAY<TIMESTAMP>[NULL],
    ARRAY<zetasql_test__.TestEnum>[NULL],
    ARRAY<zetasql_test__.KitchenSinkPB>[NULL],
    ARRAY<STRUCT<int64, int64>>[NULL]
UNION ALL
  SELECT
    7 as key,
    ARRAY<BOOL>[true],
    ARRAY<INT32>[1],
    ARRAY<UINT32>[2],
    ARRAY<INT64>[8589934592],
    ARRAY<UINT64>[8589934592],
    ARRAY<FLOAT>[1.1],
    ARRAY<DOUBLE>[1.1],
    ARRAY<STRING>['σ'],
    ARRAY<BYTES>[b"a"],
    ARRAY<DATE>["1984-08-02"],
    ARRAY<TIMESTAMP>["1984-08-02 01:01:01.001001 UTC"],
    ARRAY<zetasql_test__.TestEnum>["TESTENUM0"],
    ARRAY<zetasql_test__.KitchenSinkPB>[
      '''
        int64_key_1: 11
        int64_key_2: 12
      '''],
    ARRAY<STRUCT<int64, int64>>[(11, 12)]
UNION ALL
  SELECT
    8 as key,
    ARRAY<BOOL>[],
    ARRAY<INT32>[],
    ARRAY<UINT32>[],
    ARRAY<INT64>[],
    ARRAY<UINT64>[],
    ARRAY<FLOAT>[],
    ARRAY<DOUBLE>[],
    ARRAY<STRING>[],
    ARRAY<BYTES>[],
    ARRAY<DATE>[],
    ARRAY<TIMESTAMP>[],
    ARRAY<zetasql_test__.TestEnum>[],
    ARRAY<zetasql_test__.KitchenSinkPB>[],
    ARRAY<STRUCT<int64, int64>>[]
UNION ALL
  SELECT
    9 as key,
    IF(FALSE, ARRAY<BOOL>[], NULL),
    IF(FALSE, ARRAY<INT32>[], NULL),
    IF(FALSE, ARRAY<UINT32>[], NULL),
    IF(FALSE, ARRAY<INT64>[], NULL),
    IF(FALSE, ARRAY<UINT64>[], NULL),
    IF(FALSE, ARRAY<FLOAT>[], NULL),
    IF(FALSE, ARRAY<DOUBLE>[], NULL),
    IF(FALSE, ARRAY<STRING>[], NULL),
    IF(FALSE, ARRAY<BYTES>[], NULL),
    IF(FALSE, ARRAY<DATE>[], NULL),
    IF(FALSE, ARRAY<TIMESTAMP>[], NULL),
    IF(FALSE, ARRAY<zetasql_test__.TestEnum>[], NULL),
    IF(FALSE, ARRAY<zetasql_test__.KitchenSinkPB>[], NULL),
    IF(FALSE, ARRAY<STRUCT<int64, int64>>[], NULL)
--
ARRAY<STRUCT<
        key INT64,
        bool_arrcol ARRAY<>,
        int32_arrcol ARRAY<>,
        uint32_arrcol ARRAY<>,
        int64_arrcol ARRAY<>,
        uint64_arrcol ARRAY<>,
        float_arrcol ARRAY<>,
        double_arrcol ARRAY<>,
        string_arrcol ARRAY<>,
        bytes_arrcol ARRAY<>,
        date_arrcol ARRAY<>,
        micros_arrcol ARRAY<>,
        enum_arrcol ARRAY<>,
        proto_arrcol ARRAY<>,
        struct_arrcol ARRAY<>
      >>
[{1,
  ARRAY<BOOL>[true, false, true],
  ARRAY<INT32>[1, 0, -1],
  ARRAY<UINT32>[2, 1, 0],
  ARRAY<INT64>[8589934592, 0, -8589934592],
  ARRAY<UINT64>[8589934592, 1, 0],
  ARRAY<FLOAT>[1.1, 0, -1.1],
  ARRAY<DOUBLE>[1.1, 0, -1.1],
  ARRAY<STRING>["σ", "π", "⨝"],
  ARRAY<BYTES>[b"a", b"b", b"c"],
  ARRAY<DATE>[1984-08-02, 2000-01-01, 2014-09-11],
  ARRAY<TIMESTAMP>[
    1984-08-02 01:01:01.001001+00,
    2000-01-01 01:01:01.001001+00,
    2014-09-11 01:01:01.001001+00
  ],
  ARRAY<ENUM<zetasql_test__.TestEnum>>[TESTENUM0, TESTENUM1, TESTENUM2],
  ARRAY<PROTO<zetasql_test__.KitchenSinkPB>>[
    {
      int64_key_1: 11
      int64_key_2: 12
    },
    {
      int64_key_1: 21
      int64_key_2: 22
    },
    {
      int64_key_1: 31
      int64_key_2: 32
    }
  ],
  ARRAY<STRUCT<INT64, INT64>>[{11, 12}, {21, 22}, {31, 32}]},
 {2,
  ARRAY<BOOL>[true, NULL, true],
  ARRAY<INT32>[1, NULL, -1],
  ARRAY<UINT32>[2, NULL, 0],
  ARRAY<INT64>[8589934592, NULL, -8589934592],
  ARRAY<UINT64>[8589934592, NULL, 0],
  ARRAY<FLOAT>[1.1, NULL, -1.1],
  ARRAY<DOUBLE>[1.1, NULL, -1.1],
  ARRAY<STRING>["σ", NULL, "⨝"],
  ARRAY<BYTES>[b"a", NULL, b"c"],
  ARRAY<DATE>[1984-08-02, NULL, 2014-09-11],
  ARRAY<TIMESTAMP>[
    1984-08-02 01:01:01.001001+00,
    NULL,
    2014-09-11 01:01:01.001001+00
  ],
  ARRAY<ENUM<zetasql_test__.TestEnum>>[TESTENUM0, NULL, TESTENUM2],
  ARRAY<PROTO<zetasql_test__.KitchenSinkPB>>[
    {
      int64_key_1: 11
      int64_key_2: 12
    },
    NULL,
    {
      int64_key_1: 31
      int64_key_2: 32
    }
  ],
  ARRAY<STRUCT<INT64, INT64>>[{11, 12}, NULL, {31, 32}]},
 {3,
  ARRAY<BOOL>[NULL, true],
  ARRAY<INT32>[NULL, -1],
  ARRAY<UINT32>[NULL, 0],
  ARRAY<INT64>[NULL, -8589934592],
  ARRAY<UINT64>[NULL, 0],
  ARRAY<FLOAT>[NULL, -1.1],
  ARRAY<DOUBLE>[NULL, -1.1],
  ARRAY<STRING>[NULL, "⨝"],
  ARRAY<BYTES>[NULL, b"c"],
  ARRAY<DATE>[NULL, 2014-09-11],
  ARRAY<TIMESTAMP>[
    NULL,
    2014-09-11 01:01:01.001001+00
  ],
  ARRAY<ENUM<zetasql_test__.TestEnum>>[NULL, TESTENUM2],
  ARRAY<PROTO<zetasql_test__.KitchenSinkPB>>[
    NULL,
    {
      int64_key_1: 31
      int64_key_2: 32
    }
  ],
  ARRAY<STRUCT<INT64, INT64>>[NULL, {31, 32}]},
 {4,
  ARRAY<BOOL>[true, NULL],
  ARRAY<INT32>[1, NULL],
  ARRAY<UINT32>[2, NULL],
  ARRAY<INT64>[8589934592, NULL],
  ARRAY<UINT64>[8589934592, NULL],
  ARRAY<FLOAT>[1.1, NULL],
  ARRAY<DOUBLE>[1.1, NULL],
  ARRAY<STRING>["σ", NULL],
  ARRAY<BYTES>[b"a", NULL],
  ARRAY<DATE>[1984-08-02, NULL],
  ARRAY<TIMESTAMP>[
    1984-08-02 01:01:01.001001+00,
    NULL
  ],
  ARRAY<ENUM<zetasql_test__.TestEnum>>[TESTENUM0, NULL],
  ARRAY<PROTO<zetasql_test__.KitchenSinkPB>>[
    {
      int64_key_1: 11
      int64_key_2: 12
    },
    NULL
  ],
  ARRAY<STRUCT<INT64, INT64>>[{11, 12}, NULL]},
 {
   5,
   ARRAY<BOOL>[NULL, NULL],
   ARRAY<INT32>[NULL, NULL],
   ARRAY<UINT32>[NULL, NULL],
   ARRAY<INT64>[NULL, NULL],
   ARRAY<UINT64>[NULL, NULL],
   ARRAY<FLOAT>[NULL, NULL],
   ARRAY<DOUBLE>[NULL, NULL],
   ARRAY<STRING>[NULL, NULL],
   ARRAY<BYTES>[NULL, NULL],
   ARRAY<DATE>[NULL, NULL],
   ARRAY<TIMESTAMP>[NULL, NULL],
   ARRAY<ENUM<zetasql_test__.TestEnum>>[NULL, NULL],
   ARRAY<PROTO<zetasql_test__.KitchenSinkPB>>[NULL, NULL],
   ARRAY<STRUCT<INT64, INT64>>[NULL, NULL]
 },
 {
   6,
   ARRAY<BOOL>[NULL],
   ARRAY<INT32>[NULL],
   ARRAY<UINT32>[NULL],
   ARRAY<INT64>[NULL],
   ARRAY<UINT64>[NULL],
   ARRAY<FLOAT>[NULL],
   ARRAY<DOUBLE>[NULL],
   ARRAY<STRING>[NULL],
   ARRAY<BYTES>[NULL],
   ARRAY<DATE>[NULL],
   ARRAY<TIMESTAMP>[NULL],
   ARRAY<ENUM<zetasql_test__.TestEnum>>[NULL],
   ARRAY<PROTO<zetasql_test__.KitchenSinkPB>>[NULL],
   ARRAY<STRUCT<INT64, INT64>>[NULL]
 },
 {7,
  ARRAY<BOOL>[true],
  ARRAY<INT32>[1],
  ARRAY<UINT32>[2],
  ARRAY<INT64>[8589934592],
  ARRAY<UINT64>[8589934592],
  ARRAY<FLOAT>[1.1],
  ARRAY<DOUBLE>[1.1],
  ARRAY<STRING>["σ"],
  ARRAY<BYTES>[b"a"],
  ARRAY<DATE>[1984-08-02],
  ARRAY<TIMESTAMP>[1984-08-02 01:01:01.001001+00],
  ARRAY<ENUM<zetasql_test__.TestEnum>>[TESTENUM0],
  ARRAY<PROTO<zetasql_test__.KitchenSinkPB>>[
    {
      int64_key_1: 11
      int64_key_2: 12
    }
  ],
  ARRAY<STRUCT<INT64, INT64>>[{11, 12}]},
 {
   8,
   ARRAY<BOOL>[],
   ARRAY<INT32>[],
   ARRAY<UINT32>[],
   ARRAY<INT64>[],
   ARRAY<UINT64>[],
   ARRAY<FLOAT>[],
   ARRAY<DOUBLE>[],
   ARRAY<STRING>[],
   ARRAY<BYTES>[],
   ARRAY<DATE>[],
   ARRAY<TIMESTAMP>[],
   ARRAY<ENUM<zetasql_test__.TestEnum>>[],
   ARRAY<PROTO<zetasql_test__.KitchenSinkPB>>[],
   ARRAY<STRUCT<INT64, INT64>>[]
 },
 {
   9,
   ARRAY<BOOL>(NULL),
   ARRAY<INT32>(NULL),
   ARRAY<UINT32>(NULL),
   ARRAY<INT64>(NULL),
   ARRAY<UINT64>(NULL),
   ARRAY<FLOAT>(NULL),
   ARRAY<DOUBLE>(NULL),
   ARRAY<STRING>(NULL),
   ARRAY<BYTES>(NULL),
   ARRAY<DATE>(NULL),
   ARRAY<TIMESTAMP>(NULL),
   ARRAY<ENUM<zetasql_test__.TestEnum>>(NULL),
   ARRAY<PROTO<zetasql_test__.KitchenSinkPB>>(NULL),
   ARRAY<STRUCT<INT64, INT64>>(NULL)
 }]
==
[name=select_bool_arrays]
SELECT bool_arrcol FROM AllArraysTable
--
ARRAY<STRUCT<bool_arrcol ARRAY<>>>[unknown order:
  {ARRAY<BOOL>[known order:true, false, true]},
  {ARRAY<BOOL>[known order:true, NULL, true]},
  {ARRAY<BOOL>[known order:NULL, true]},
  {ARRAY<BOOL>[known order:true, NULL]},
  {ARRAY<BOOL>[known order:NULL, NULL]},
  {ARRAY<BOOL>[NULL]},
  {ARRAY<BOOL>[true]},
  {ARRAY<BOOL>[]},
  {ARRAY<BOOL>(NULL)}
]
==
[name=select_bool_array_unnest]
SELECT elem FROM AllArraysTable t, t.bool_arrcol elem
--
ARRAY<STRUCT<elem BOOL>>[unknown order:
  {NULL},
  {true},
  {true},
  {NULL},
  {true},
  {NULL},
  {false},
  {true},
  {true},
  {true},
  {NULL},
  {NULL},
  {NULL},
  {true}
]
==

[required_features=SINGLE_TABLE_NAME_ARRAY_PATH]
[name=select_bool_array_unnest_from_table_name_array_path]
SELECT elem FROM AllArraysTable.bool_arrcol elem
--
ARRAY<STRUCT<elem BOOL>>[unknown order:
  {NULL},
  {true},
  {true},
  {NULL},
  {true},
  {NULL},
  {false},
  {true},
  {true},
  {true},
  {NULL},
  {NULL},
  {NULL},
  {true}
]
==

[name=select_int32_arrays]
SELECT int32_arrcol FROM AllArraysTable
--
ARRAY<STRUCT<int32_arrcol ARRAY<>>>[unknown order:
  {ARRAY<INT32>[known order:1, 0, -1]},
  {ARRAY<INT32>[known order:1, NULL, -1]},
  {ARRAY<INT32>[known order:NULL, -1]},
  {ARRAY<INT32>[known order:1, NULL]},
  {ARRAY<INT32>[known order:NULL, NULL]},
  {ARRAY<INT32>[NULL]},
  {ARRAY<INT32>[1]},
  {ARRAY<INT32>[]},
  {ARRAY<INT32>(NULL)}
]
==
[name=select_int32_array_unnest]
SELECT elem FROM AllArraysTable t, t.int32_arrcol elem
--
ARRAY<STRUCT<elem INT32>>[unknown order:
  {NULL},
  {1},
  {-1},
  {NULL},
  {1},
  {NULL},
  {0},
  {1},
  {-1},
  {-1},
  {NULL},
  {NULL},
  {NULL},
  {1}
]
==

[required_features=SINGLE_TABLE_NAME_ARRAY_PATH]
[name=select_int32_array_unnest_from_table_name_array_path]
SELECT elem FROM AllArraysTable.int32_arrcol elem
--
ARRAY<STRUCT<elem INT32>>[unknown order:
  {NULL},
  {1},
  {-1},
  {NULL},
  {1},
  {NULL},
  {0},
  {1},
  {-1},
  {-1},
  {NULL},
  {NULL},
  {NULL},
  {1}
]
==

[name=select_uint32_arrays]
SELECT uint32_arrcol FROM AllArraysTable
--
ARRAY<STRUCT<uint32_arrcol ARRAY<>>>[unknown order:
  {ARRAY<UINT32>[known order:2, 1, 0]},
  {ARRAY<UINT32>[known order:2, NULL, 0]},
  {ARRAY<UINT32>[known order:NULL, 0]},
  {ARRAY<UINT32>[known order:2, NULL]},
  {ARRAY<UINT32>[known order:NULL, NULL]},
  {ARRAY<UINT32>[NULL]},
  {ARRAY<UINT32>[2]},
  {ARRAY<UINT32>[]},
  {ARRAY<UINT32>(NULL)}
]
==
[name=select_uint32_array_unnest]
SELECT elem FROM AllArraysTable t, t.uint32_arrcol elem
--
ARRAY<STRUCT<elem UINT32>>[unknown order:
  {NULL},
  {2},
  {0},
  {NULL},
  {2},
  {NULL},
  {1},
  {2},
  {0},
  {0},
  {NULL},
  {NULL},
  {NULL},
  {2}
]
==

[required_features=SINGLE_TABLE_NAME_ARRAY_PATH]
[name=select_uint32_array_unnest_from_table_name_array_path]
SELECT elem FROM AllArraysTable.uint32_arrcol elem
--
ARRAY<STRUCT<elem UINT32>>[unknown order:
  {NULL},
  {2},
  {0},
  {NULL},
  {2},
  {NULL},
  {1},
  {2},
  {0},
  {0},
  {NULL},
  {NULL},
  {NULL},
  {2}
]
==

[name=select_int64_arrays]
SELECT int64_arrcol FROM AllArraysTable
--
ARRAY<STRUCT<int64_arrcol ARRAY<>>>[unknown order:
  {ARRAY<INT64>[known order:8589934592, 0, -8589934592]},
  {ARRAY<INT64>[known order:8589934592, NULL, -8589934592]},
  {ARRAY<INT64>[known order:NULL, -8589934592]},
  {ARRAY<INT64>[known order:8589934592, NULL]},
  {ARRAY<INT64>[known order:NULL, NULL]},
  {ARRAY<INT64>[NULL]},
  {ARRAY<INT64>[8589934592]},
  {ARRAY<INT64>[]},
  {ARRAY<INT64>(NULL)}
]
==

[name=select_int64_array_unnest]
SELECT elem FROM AllArraysTable t, t.int64_arrcol elem
--
ARRAY<STRUCT<elem INT64>>[unknown order:
  {NULL},
  {8589934592},
  {-8589934592},
  {NULL},
  {8589934592},
  {NULL},
  {0},
  {8589934592},
  {-8589934592},
  {-8589934592},
  {NULL},
  {NULL},
  {NULL},
  {8589934592}
]
==

[required_features=SINGLE_TABLE_NAME_ARRAY_PATH]
[name=select_int64_array_unnest_from_table_name_array_path]
SELECT elem FROM AllArraysTable.int64_arrcol elem
--
ARRAY<STRUCT<elem INT64>>[unknown order:
  {NULL},
  {8589934592},
  {-8589934592},
  {NULL},
  {8589934592},
  {NULL},
  {0},
  {8589934592},
  {-8589934592},
  {-8589934592},
  {NULL},
  {NULL},
  {NULL},
  {8589934592}
]
==

[name=select_uint64_arrays]
SELECT uint64_arrcol FROM AllArraysTable
--
ARRAY<STRUCT<uint64_arrcol ARRAY<>>>[unknown order:
  {ARRAY<UINT64>[known order:8589934592, 1, 0]},
  {ARRAY<UINT64>[known order:8589934592, NULL, 0]},
  {ARRAY<UINT64>[known order:NULL, 0]},
  {ARRAY<UINT64>[known order:8589934592, NULL]},
  {ARRAY<UINT64>[known order:NULL, NULL]},
  {ARRAY<UINT64>[NULL]},
  {ARRAY<UINT64>[8589934592]},
  {ARRAY<UINT64>[]},
  {ARRAY<UINT64>(NULL)}
]
==
[name=select_uint64_array_unnest]
SELECT elem FROM AllArraysTable t, t.uint64_arrcol elem
--
ARRAY<STRUCT<elem UINT64>>[unknown order:
  {NULL},
  {8589934592},
  {0},
  {NULL},
  {8589934592},
  {NULL},
  {1},
  {8589934592},
  {0},
  {0},
  {NULL},
  {NULL},
  {NULL},
  {8589934592}
]
==
[name=select_float_arrays]
SELECT float_arrcol FROM AllArraysTable
--
ARRAY<STRUCT<float_arrcol ARRAY<>>>[unknown order:
  {ARRAY<FLOAT>[known order:1.1, 0, -1.1]},
  {ARRAY<FLOAT>[known order:1.1, NULL, -1.1]},
  {ARRAY<FLOAT>[known order:NULL, -1.1]},
  {ARRAY<FLOAT>[known order:1.1, NULL]},
  {ARRAY<FLOAT>[known order:NULL, NULL]},
  {ARRAY<FLOAT>[NULL]},
  {ARRAY<FLOAT>[1.1]},
  {ARRAY<FLOAT>[]},
  {ARRAY<FLOAT>(NULL)}
]
==
[name=select_float_array_unnest]
SELECT elem FROM AllArraysTable t, t.float_arrcol elem
--
ARRAY<STRUCT<elem FLOAT>>[unknown order:
  {NULL},
  {1.1},
  {-1.1},
  {NULL},
  {1.1},
  {NULL},
  {0},
  {1.1},
  {-1.1},
  {-1.1},
  {NULL},
  {NULL},
  {NULL},
  {1.1}
]
==
[name=select_double_arrays]
SELECT double_arrcol FROM AllArraysTable
--
ARRAY<STRUCT<double_arrcol ARRAY<>>>[unknown order:
  {ARRAY<DOUBLE>[known order:1.1, 0, -1.1]},
  {ARRAY<DOUBLE>[known order:1.1, NULL, -1.1]},
  {ARRAY<DOUBLE>[known order:NULL, -1.1]},
  {ARRAY<DOUBLE>[known order:1.1, NULL]},
  {ARRAY<DOUBLE>[known order:NULL, NULL]},
  {ARRAY<DOUBLE>[NULL]},
  {ARRAY<DOUBLE>[1.1]},
  {ARRAY<DOUBLE>[]},
  {ARRAY<DOUBLE>(NULL)}
]
==
[name=select_double_array_unnest]
SELECT elem FROM AllArraysTable t, t.double_arrcol elem
--
ARRAY<STRUCT<elem DOUBLE>>[unknown order:
  {NULL},
  {1.1},
  {-1.1},
  {NULL},
  {1.1},
  {NULL},
  {0},
  {1.1},
  {-1.1},
  {-1.1},
  {NULL},
  {NULL},
  {NULL},
  {1.1}
]
==
[name=select_string_arrays]
SELECT string_arrcol FROM AllArraysTable
--
ARRAY<STRUCT<string_arrcol ARRAY<>>>[unknown order:
  {ARRAY<STRING>[known order:"σ", "π", "⨝"]},
  {ARRAY<STRING>[known order:"σ", NULL, "⨝"]},
  {ARRAY<STRING>[known order:NULL, "⨝"]},
  {ARRAY<STRING>[known order:"σ", NULL]},
  {ARRAY<STRING>[known order:NULL, NULL]},
  {ARRAY<STRING>[NULL]},
  {ARRAY<STRING>["σ"]},
  {ARRAY<STRING>[]},
  {ARRAY<STRING>(NULL)}
]
==
[name=select_string_array_unnest]
SELECT elem FROM AllArraysTable t, t.string_arrcol elem
--
ARRAY<STRUCT<elem STRING>>[unknown order:
  {NULL},
  {"σ"},
  {"⨝"},
  {NULL},
  {"σ"},
  {NULL},
  {"π"},
  {"σ"},
  {"⨝"},
  {"⨝"},
  {NULL},
  {NULL},
  {NULL},
  {"σ"}
]
==
[name=select_bytes_arrays]
SELECT bytes_arrcol FROM AllArraysTable
--
ARRAY<STRUCT<bytes_arrcol ARRAY<>>>[unknown order:
  {ARRAY<BYTES>[known order:b"a", b"b", b"c"]},
  {ARRAY<BYTES>[known order:b"a", NULL, b"c"]},
  {ARRAY<BYTES>[known order:NULL, b"c"]},
  {ARRAY<BYTES>[known order:b"a", NULL]},
  {ARRAY<BYTES>[known order:NULL, NULL]},
  {ARRAY<BYTES>[NULL]},
  {ARRAY<BYTES>[b"a"]},
  {ARRAY<BYTES>[]},
  {ARRAY<BYTES>(NULL)}
]
==
[name=select_bytes_array_unnest]
SELECT elem FROM AllArraysTable t, t.bytes_arrcol elem
--
ARRAY<STRUCT<elem BYTES>>[unknown order:
  {NULL},
  {b"a"},
  {b"c"},
  {NULL},
  {b"a"},
  {NULL},
  {b"b"},
  {b"a"},
  {b"c"},
  {b"c"},
  {NULL},
  {NULL},
  {NULL},
  {b"a"}
]
==
[name=select_date_arrays]
SELECT date_arrcol FROM AllArraysTable
--
ARRAY<STRUCT<date_arrcol ARRAY<>>>[unknown order:
  {ARRAY<DATE>[known order:1984-08-02, 2000-01-01, 2014-09-11]},
  {ARRAY<DATE>[known order:1984-08-02, NULL, 2014-09-11]},
  {ARRAY<DATE>[known order:NULL, 2014-09-11]},
  {ARRAY<DATE>[known order:1984-08-02, NULL]},
  {ARRAY<DATE>[known order:NULL, NULL]},
  {ARRAY<DATE>[NULL]},
  {ARRAY<DATE>[1984-08-02]},
  {ARRAY<DATE>[]},
  {ARRAY<DATE>(NULL)}
]
==
[name=select_date_array_unnest]
SELECT elem FROM AllArraysTable t, t.date_arrcol elem
--
ARRAY<STRUCT<elem DATE>>[unknown order:
  {NULL},
  {1984-08-02},
  {2014-09-11},
  {NULL},
  {1984-08-02},
  {NULL},
  {2000-01-01},
  {1984-08-02},
  {2014-09-11},
  {2014-09-11},
  {NULL},
  {NULL},
  {NULL},
  {1984-08-02}
]
==
[name=select_timestamp_arrays]
SELECT micros_arrcol FROM AllArraysTable
--
ARRAY<STRUCT<micros_arrcol ARRAY<>>>[unknown order:
  {ARRAY<TIMESTAMP>[known order:
     1984-08-02 01:01:01.001001+00,
     2000-01-01 01:01:01.001001+00,
     2014-09-11 01:01:01.001001+00
   ]},
  {ARRAY<TIMESTAMP>[known order:
     1984-08-02 01:01:01.001001+00,
     NULL,
     2014-09-11 01:01:01.001001+00
   ]},
  {ARRAY<TIMESTAMP>[known order:
     NULL,
     2014-09-11 01:01:01.001001+00
   ]},
  {ARRAY<TIMESTAMP>[known order:
     1984-08-02 01:01:01.001001+00,
     NULL
   ]},
  {ARRAY<TIMESTAMP>[known order:NULL, NULL]},
  {ARRAY<TIMESTAMP>[NULL]},
  {ARRAY<TIMESTAMP>[1984-08-02 01:01:01.001001+00]},
  {ARRAY<TIMESTAMP>[]},
  {ARRAY<TIMESTAMP>(NULL)}
]
==
[name=select_timestamp_array_unnest]
SELECT elem FROM AllArraysTable t, t.micros_arrcol elem
--
ARRAY<STRUCT<elem TIMESTAMP>>[unknown order:
  {NULL},
  {1984-08-02 01:01:01.001001+00},
  {2014-09-11 01:01:01.001001+00},
  {NULL},
  {1984-08-02 01:01:01.001001+00},
  {NULL},
  {2000-01-01 01:01:01.001001+00},
  {1984-08-02 01:01:01.001001+00},
  {2014-09-11 01:01:01.001001+00},
  {2014-09-11 01:01:01.001001+00},
  {NULL},
  {NULL},
  {NULL},
  {1984-08-02 01:01:01.001001+00}
]
==
[name=select_enum_arrays]
SELECT enum_arrcol FROM AllArraysTable
--
ARRAY<STRUCT<enum_arrcol ARRAY<>>>[unknown order:
  {ARRAY<ENUM<zetasql_test__.TestEnum>>[known order:
     TESTENUM0,
     TESTENUM1,
     TESTENUM2
   ]},
  {ARRAY<ENUM<zetasql_test__.TestEnum>>[known order:TESTENUM0, NULL, TESTENUM2]},
  {ARRAY<ENUM<zetasql_test__.TestEnum>>[known order:NULL, TESTENUM2]},
  {ARRAY<ENUM<zetasql_test__.TestEnum>>[known order:TESTENUM0, NULL]},
  {ARRAY<ENUM<zetasql_test__.TestEnum>>[known order:NULL, NULL]},
  {ARRAY<ENUM<zetasql_test__.TestEnum>>[NULL]},
  {ARRAY<ENUM<zetasql_test__.TestEnum>>[TESTENUM0]},
  {ARRAY<ENUM<zetasql_test__.TestEnum>>[]},
  {ARRAY<ENUM<zetasql_test__.TestEnum>>(NULL)}
]
==
[name=select_enum_array_unnest]
SELECT elem FROM AllArraysTable t, t.enum_arrcol elem
--
ARRAY<STRUCT<elem ENUM<zetasql_test__.TestEnum>>>[unknown order:
  {NULL},
  {TESTENUM0},
  {TESTENUM2},
  {NULL},
  {TESTENUM0},
  {NULL},
  {TESTENUM1},
  {TESTENUM0},
  {TESTENUM2},
  {TESTENUM2},
  {NULL},
  {NULL},
  {NULL},
  {TESTENUM0}
]
==
[name=select_proto_arrays]
SELECT proto_arrcol FROM AllArraysTable
--
ARRAY<STRUCT<proto_arrcol ARRAY<>>>[unknown order:
  {ARRAY<PROTO<zetasql_test__.KitchenSinkPB>>[known order:
     {
       int64_key_1: 11
       int64_key_2: 12
     },
     {
       int64_key_1: 21
       int64_key_2: 22
     },
     {
       int64_key_1: 31
       int64_key_2: 32
     }
   ]},
  {ARRAY<PROTO<zetasql_test__.KitchenSinkPB>>[known order:
     {
       int64_key_1: 11
       int64_key_2: 12
     },
     NULL,
     {
       int64_key_1: 31
       int64_key_2: 32
     }
   ]},
  {ARRAY<PROTO<zetasql_test__.KitchenSinkPB>>[known order:
     NULL,
     {
       int64_key_1: 31
       int64_key_2: 32
     }
   ]},
  {ARRAY<PROTO<zetasql_test__.KitchenSinkPB>>[known order:
     {
       int64_key_1: 11
       int64_key_2: 12
     },
     NULL
   ]},
  {ARRAY<PROTO<zetasql_test__.KitchenSinkPB>>[known order:NULL, NULL]},
  {ARRAY<PROTO<zetasql_test__.KitchenSinkPB>>[NULL]},
  {ARRAY<PROTO<zetasql_test__.KitchenSinkPB>>[
     {
       int64_key_1: 11
       int64_key_2: 12
     }
   ]},
  {ARRAY<PROTO<zetasql_test__.KitchenSinkPB>>[]},
  {ARRAY<PROTO<zetasql_test__.KitchenSinkPB>>(NULL)}
]
==
[name=select_proto_array_unnest]
SELECT elem FROM AllArraysTable t, t.proto_arrcol elem
--
ARRAY<STRUCT<elem PROTO<zetasql_test__.KitchenSinkPB>>>[unknown order:
  {NULL},
  {{
     int64_key_1: 11
     int64_key_2: 12
   }},
  {{
     int64_key_1: 31
     int64_key_2: 32
   }},
  {NULL},
  {{
     int64_key_1: 11
     int64_key_2: 12
   }},
  {NULL},
  {{
     int64_key_1: 21
     int64_key_2: 22
   }},
  {{
     int64_key_1: 11
     int64_key_2: 12
   }},
  {{
     int64_key_1: 31
     int64_key_2: 32
   }},
  {{
     int64_key_1: 31
     int64_key_2: 32
   }},
  {NULL},
  {NULL},
  {NULL},
  {{
     int64_key_1: 11
     int64_key_2: 12
   }}
]
==
[name=select_struct_arrays]
SELECT struct_arrcol FROM AllArraysTable
--
ARRAY<STRUCT<struct_arrcol ARRAY<>>>[unknown order:
  {ARRAY<STRUCT<INT64, INT64>>[known order:{11, 12}, {21, 22}, {31, 32}]},
  {ARRAY<STRUCT<INT64, INT64>>[known order:{11, 12}, NULL, {31, 32}]},
  {ARRAY<STRUCT<INT64, INT64>>[known order:NULL, {31, 32}]},
  {ARRAY<STRUCT<INT64, INT64>>[known order:{11, 12}, NULL]},
  {ARRAY<STRUCT<INT64, INT64>>[known order:NULL, NULL]},
  {ARRAY<STRUCT<INT64, INT64>>[NULL]},
  {ARRAY<STRUCT<INT64, INT64>>[{11, 12}]},
  {ARRAY<STRUCT<INT64, INT64>>[]},
  {ARRAY<STRUCT<INT64, INT64>>(NULL)}
]
==
[name=select_struct_array_unnest]
SELECT elem FROM AllArraysTable t, t.struct_arrcol elem
--
ARRAY<STRUCT<elem STRUCT<INT64, INT64>>>[unknown order:
  {NULL},
  {{11, 12}},
  {{31, 32}},
  {NULL},
  {{11, 12}},
  {NULL},
  {{21, 22}},
  {{11, 12}},
  {{31, 32}},
  {{31, 32}},
  {NULL},
  {NULL},
  {NULL},
  {{11, 12}}
]
==
##
## Queries that tests explicit unnest. This time we do not require a full
## matrix.
##
[name=select_string_array_unnest_explicit]
SELECT elem FROM AllArraysTable t, UNNEST(t.string_arrcol) AS elem
--
ARRAY<STRUCT<elem STRING>>[unknown order:
  {NULL},
  {"σ"},
  {"⨝"},
  {NULL},
  {"σ"},
  {NULL},
  {"π"},
  {"σ"},
  {"⨝"},
  {"⨝"},
  {NULL},
  {NULL},
  {NULL},
  {"σ"}
]
==
##
## From here, several queries to test offset/ordinality without joins.
##
[name=select_string_array_unnest_with_offset]
SELECT elem, offset FROM AllArraysTable t, t.string_arrcol elem WITH OFFSET
--
ARRAY<STRUCT<elem STRING, offset INT64>>[unknown order:
  {NULL, 1},
  {"σ", 0},
  {"⨝", 2},
  {NULL, 1},
  {"σ", 0},
  {NULL, 0},
  {"π", 1},
  {"σ", 0},
  {"⨝", 2},
  {"⨝", 1},
  {NULL, 0},
  {NULL, 1},
  {NULL, 0},
  {"σ", 0}
]
==
[name=select_string_array_unnest_with_offset_aliased]
SELECT elem, off FROM AllArraysTable t, t.string_arrcol elem WITH OFFSET off
--
ARRAY<STRUCT<elem STRING, off INT64>>[unknown order:
  {NULL, 1},
  {"σ", 0},
  {"⨝", 2},
  {NULL, 1},
  {"σ", 0},
  {NULL, 0},
  {"π", 1},
  {"σ", 0},
  {"⨝", 2},
  {"⨝", 1},
  {NULL, 0},
  {NULL, 1},
  {NULL, 0},
  {"σ", 0}
]
==
[name=select_string_array_unnest_with_offset_sorted]
SELECT elem, offset
FROM AllArraysTable t, t.string_arrcol elem WITH OFFSET
ORDER BY offset
--
ARRAY<STRUCT<elem STRING, offset INT64>>[unknown order:
  {"σ", 0},
  {NULL, 0},
  {"σ", 0},
  {"σ", 0},
  {"σ", 0},
  {NULL, 0},
  {NULL, 0},
  {NULL, 1},
  {"⨝", 1},
  {NULL, 1},
  {NULL, 1},
  {"π", 1},
  {"⨝", 2},
  {"⨝", 2}
]
==
[name=select_string_array_unnest_with_offset_aliased_sorted]
SELECT elem, off
FROM AllArraysTable t, t.string_arrcol elem WITH OFFSET off
ORDER BY off
--
ARRAY<STRUCT<elem STRING, off INT64>>[unknown order:
  {"σ", 0},
  {NULL, 0},
  {"σ", 0},
  {"σ", 0},
  {"σ", 0},
  {NULL, 0},
  {NULL, 0},
  {NULL, 1},
  {"⨝", 1},
  {NULL, 1},
  {NULL, 1},
  {"π", 1},
  {"⨝", 2},
  {"⨝", 2}
]
==
[name=select_string_array_correlated_unnest_with_offset_aliased]
SELECT ARRAY(SELECT AS STRUCT elem, off FROM t.string_arrcol elem WITH OFFSET off)
FROM AllArraysTable t
--
ARRAY<STRUCT<ARRAY<>>>[unknown order:
  {ARRAY<STRUCT<elem STRING, off INT64>>[unknown order:
     {NULL, 1},
     {"σ", 0},
     {"⨝", 2}
   ]},
  {ARRAY<STRUCT<elem STRING, off INT64>>[unknown order:{NULL, 1}, {"σ", 0}]},
  {ARRAY<STRUCT<elem STRING, off INT64>>[{NULL, 0}]},
  {ARRAY<STRUCT<elem STRING, off INT64>>[]},
  {ARRAY<STRUCT<elem STRING, off INT64>>[unknown order:
     {"π", 1},
     {"σ", 0},
     {"⨝", 2}
   ]},
  {ARRAY<STRUCT<elem STRING, off INT64>>[unknown order:{"⨝", 1}, {NULL, 0}]},
  {ARRAY<STRUCT<elem STRING, off INT64>>[unknown order:{NULL, 1}, {NULL, 0}]},
  {ARRAY<STRUCT<elem STRING, off INT64>>[{"σ", 0}]},
  {ARRAY<STRUCT<elem STRING, off INT64>>[]}
]
==
# TODO: Introduce these queries to test WITH ORDINALITY
# [name=select_string_array_unnest_with_ordinality]
# SELECT arr
# FROM AllArraysTable t, UNNEST(t.string_arrcol) WITH ORDINALITY arr
# --
# false
# ==
# [name=select_string_array_unnest_with_ordinality_aliased]
# SELECT arr.elem, arr.ord, elem, ord
# FROM AllArraysTable t, UNNEST(t.string_arrcol) WITH ORDINALITY arr(elem, ord)
# --
# false
# ==
# [name=select_string_array_unnest_with_ordinality_sorted]
# SELECT arr
# FROM AllArraysTable t, UNNEST(t.string_arrcol) WITH ORDINALITY arr(elem, ord)
# ORDER BY arr.ord
# --
# false
# ==
# [name=select_string_array_correlated_unnest_with_ordinality_aliased]
# SELECT ARRAY(SELECT arr FROM UNNEST(t.string_arrcol) WITH ORDINALITY arr)
# FROM AllArraysTable t
# --
# false
# ==

[required_features=ARRAY_EQUALITY]
[name=select_array_equality_literals]
SELECT [] = [],
       [1,2,3] = [1,2,3],
       [1,2] = [1,2,3],
       [1,NULL] = [1,2,3],
       [1,NULL,3] = [1,2,3],
       [1,NULL,2] = [1,2,3],
       [1,NULL,2] = [1,NULL,2]
--
ARRAY<STRUCT<BOOL, BOOL, BOOL, BOOL, BOOL, BOOL, BOOL>>[
  {true, true, false, false, NULL, false, NULL}
]
==

[required_features=ARRAY_EQUALITY]
[name=select_array_equality_empty_array_null]
SELECT [] = cast(NULL AS ARRAY<INT64>)
--
ARRAY<STRUCT<BOOL>>[{NULL}]
==

[required_features=ARRAY_EQUALITY]
[name=select_array_equality_join_on_array_types]
SELECT *
FROM AllArraysTable a JOIN AllArraysTable b
ON a.bool_arrcol = b.bool_arrcol AND
   a.int32_arrcol = b.int32_arrcol AND
   a.uint32_arrcol = b.uint32_arrcol AND
   a.int64_arrcol = b.int64_arrcol AND
   a.uint64_arrcol = b.uint64_arrcol AND
   a.string_arrcol = b.string_arrcol AND
   a.bytes_arrcol = b.bytes_arrcol AND
   a.date_arrcol = b.date_arrcol AND
   a.micros_arrcol = b.micros_arrcol AND
   a.enum_arrcol = b.enum_arrcol AND
   a.struct_arrcol = b.struct_arrcol;
--
ARRAY<STRUCT<
        key INT64,
        bool_arrcol ARRAY<>,
        int32_arrcol ARRAY<>,
        uint32_arrcol ARRAY<>,
        int64_arrcol ARRAY<>,
        uint64_arrcol ARRAY<>,
        float_arrcol ARRAY<>,
        double_arrcol ARRAY<>,
        string_arrcol ARRAY<>,
        bytes_arrcol ARRAY<>,
        date_arrcol ARRAY<>,
        micros_arrcol ARRAY<>,
        enum_arrcol ARRAY<>,
        proto_arrcol ARRAY<>,
        struct_arrcol ARRAY<>,
        key INT64,
        bool_arrcol ARRAY<>,
        int32_arrcol ARRAY<>,
        uint32_arrcol ARRAY<>,
        int64_arrcol ARRAY<>,
        uint64_arrcol ARRAY<>,
        float_arrcol ARRAY<>,
        double_arrcol ARRAY<>,
        string_arrcol ARRAY<>,
        bytes_arrcol ARRAY<>,
        date_arrcol ARRAY<>,
        micros_arrcol ARRAY<>,
        enum_arrcol ARRAY<>,
        proto_arrcol ARRAY<>,
        struct_arrcol ARRAY<>
      >>
[unknown order:
  {
    8,
    ARRAY<BOOL>[],
    ARRAY<INT32>[],
    ARRAY<UINT32>[],
    ARRAY<INT64>[],
    ARRAY<UINT64>[],
    ARRAY<FLOAT>[],
    ARRAY<DOUBLE>[],
    ARRAY<STRING>[],
    ARRAY<BYTES>[],
    ARRAY<DATE>[],
    ARRAY<TIMESTAMP>[],
    ARRAY<ENUM<zetasql_test__.TestEnum>>[],
    ARRAY<PROTO<zetasql_test__.KitchenSinkPB>>[],
    ARRAY<STRUCT<INT64, INT64>>[],
    8,
    ARRAY<BOOL>[],
    ARRAY<INT32>[],
    ARRAY<UINT32>[],
    ARRAY<INT64>[],
    ARRAY<UINT64>[],
    ARRAY<FLOAT>[],
    ARRAY<DOUBLE>[],
    ARRAY<STRING>[],
    ARRAY<BYTES>[],
    ARRAY<DATE>[],
    ARRAY<TIMESTAMP>[],
    ARRAY<ENUM<zetasql_test__.TestEnum>>[],
    ARRAY<PROTO<zetasql_test__.KitchenSinkPB>>[],
    ARRAY<STRUCT<INT64, INT64>>[]
  },
  {1,
   ARRAY<BOOL>[known order:true, false, true],
   ARRAY<INT32>[known order:1, 0, -1],
   ARRAY<UINT32>[known order:2, 1, 0],
   ARRAY<INT64>[known order:8589934592, 0, -8589934592],
   ARRAY<UINT64>[known order:8589934592, 1, 0],
   ARRAY<FLOAT>[known order:1.1, 0, -1.1],
   ARRAY<DOUBLE>[known order:1.1, 0, -1.1],
   ARRAY<STRING>[known order:"σ", "π", "⨝"],
   ARRAY<BYTES>[known order:b"a", b"b", b"c"],
   ARRAY<DATE>[known order:1984-08-02, 2000-01-01, 2014-09-11],
   ARRAY<TIMESTAMP>[known order:
     1984-08-02 01:01:01.001001+00,
     2000-01-01 01:01:01.001001+00,
     2014-09-11 01:01:01.001001+00
   ],
   ARRAY<ENUM<zetasql_test__.TestEnum>>[known order:
     TESTENUM0,
     TESTENUM1,
     TESTENUM2
   ],
   ARRAY<PROTO<zetasql_test__.KitchenSinkPB>>[known order:
     {
       int64_key_1: 11
       int64_key_2: 12
     },
     {
       int64_key_1: 21
       int64_key_2: 22
     },
     {
       int64_key_1: 31
       int64_key_2: 32
     }
   ],
   ARRAY<STRUCT<INT64, INT64>>[known order:{11, 12}, {21, 22}, {31, 32}],
   1,
   ARRAY<BOOL>[known order:true, false, true],
   ARRAY<INT32>[known order:1, 0, -1],
   ARRAY<UINT32>[known order:2, 1, 0],
   ARRAY<INT64>[known order:8589934592, 0, -8589934592],
   ARRAY<UINT64>[known order:8589934592, 1, 0],
   ARRAY<FLOAT>[known order:1.1, 0, -1.1],
   ARRAY<DOUBLE>[known order:1.1, 0, -1.1],
   ARRAY<STRING>[known order:"σ", "π", "⨝"],
   ARRAY<BYTES>[known order:b"a", b"b", b"c"],
   ARRAY<DATE>[known order:1984-08-02, 2000-01-01, 2014-09-11],
   ARRAY<TIMESTAMP>[known order:
     1984-08-02 01:01:01.001001+00,
     2000-01-01 01:01:01.001001+00,
     2014-09-11 01:01:01.001001+00
   ],
   ARRAY<ENUM<zetasql_test__.TestEnum>>[known order:
     TESTENUM0,
     TESTENUM1,
     TESTENUM2
   ],
   ARRAY<PROTO<zetasql_test__.KitchenSinkPB>>[known order:
     {
       int64_key_1: 11
       int64_key_2: 12
     },
     {
       int64_key_1: 21
       int64_key_2: 22
     },
     {
       int64_key_1: 31
       int64_key_2: 32
     }
   ],
   ARRAY<STRUCT<INT64, INT64>>[known order:{11, 12}, {21, 22}, {31, 32}]},
  {7,
   ARRAY<BOOL>[true],
   ARRAY<INT32>[1],
   ARRAY<UINT32>[2],
   ARRAY<INT64>[8589934592],
   ARRAY<UINT64>[8589934592],
   ARRAY<FLOAT>[1.1],
   ARRAY<DOUBLE>[1.1],
   ARRAY<STRING>["σ"],
   ARRAY<BYTES>[b"a"],
   ARRAY<DATE>[1984-08-02],
   ARRAY<TIMESTAMP>[1984-08-02 01:01:01.001001+00],
   ARRAY<ENUM<zetasql_test__.TestEnum>>[TESTENUM0],
   ARRAY<PROTO<zetasql_test__.KitchenSinkPB>>[
     {
       int64_key_1: 11
       int64_key_2: 12
     }
   ],
   ARRAY<STRUCT<INT64, INT64>>[{11, 12}],
   7,
   ARRAY<BOOL>[true],
   ARRAY<INT32>[1],
   ARRAY<UINT32>[2],
   ARRAY<INT64>[8589934592],
   ARRAY<UINT64>[8589934592],
   ARRAY<FLOAT>[1.1],
   ARRAY<DOUBLE>[1.1],
   ARRAY<STRING>["σ"],
   ARRAY<BYTES>[b"a"],
   ARRAY<DATE>[1984-08-02],
   ARRAY<TIMESTAMP>[1984-08-02 01:01:01.001001+00],
   ARRAY<ENUM<zetasql_test__.TestEnum>>[TESTENUM0],
   ARRAY<PROTO<zetasql_test__.KitchenSinkPB>>[
     {
       int64_key_1: 11
       int64_key_2: 12
     }
   ],
   ARRAY<STRUCT<INT64, INT64>>[{11, 12}]}
]
==

[required_features=ARRAY_EQUALITY]
[name=select_array_equality_all_array_types]
SELECT bool_arrcol = bool_arrcol,
       int32_arrcol = int32_arrcol,
       uint32_arrcol = uint32_arrcol,
       int64_arrcol = int64_arrcol,
       uint64_arrcol = uint64_arrcol,
       float_arrcol = float_arrcol,
       double_arrcol = double_arrcol,
       string_arrcol = string_arrcol,
       bytes_arrcol = bytes_arrcol,
       date_arrcol = date_arrcol,
       enum_arrcol = enum_arrcol,
       struct_arrcol = struct_arrcol
FROM AllArraysTable;
--
ARRAY<STRUCT<BOOL, BOOL, BOOL, BOOL, BOOL, BOOL, BOOL, BOOL, BOOL, BOOL, BOOL, BOOL>>[unknown order:
  {NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL},
  {NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL},
  {NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL},
  {true, true, true, true, true, true, true, true, true, true, true, true},
  {true, true, true, true, true, true, true, true, true, true, true, true},
  {NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL},
  {NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL},
  {true, true, true, true, true, true, true, true, true, true, true, true},
  {NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL}
]

==

# In this test, the arrays have no guaranteed order, so the result of equality
# is not knowable. This query should be marked as non-deterministic.
[required_features=ARRAY_EQUALITY]
[name=array_equality_on_incidentally_different_ordered_arrays]
SELECT a, b, a = b
FROM (
  SELECT ARRAY(SELECT e FROM UNNEST([1, 2, 3]) as e) as a,
         ARRAY(SELECT e FROM UNNEST([3, 2, 1]) as e) as b,
)
--
ARRAY<STRUCT<a ARRAY<>, b ARRAY<>, BOOL>>[
  {
    ARRAY<INT64>[unknown order:1, 2, 3],
    ARRAY<INT64>[unknown order:3, 2, 1],
    false
  }
]

NOTE: Reference implementation reports non-determinism.
==

# In this test, the arrays have no guaranteed order, so the result of equality
# is not knowable. This query should be marked as non-deterministic.
[required_features=IS_DISTINCT,GROUP_BY_ARRAY]
[name=array_distinct_from_on_incidentally_different_ordered_arrays]
SELECT a, b, a IS NOT DISTINCT FROM b
FROM (
  SELECT ARRAY(SELECT e FROM UNNEST([1, 2, 3]) as e) as a,
         ARRAY(SELECT e FROM UNNEST([3, 2, 1]) as e) as b,
)
--
ARRAY<STRUCT<a ARRAY<>, b ARRAY<>, BOOL>>[
  {
    ARRAY<INT64>[unknown order:1, 2, 3],
    ARRAY<INT64>[unknown order:3, 2, 1],
    false
  }
]

NOTE: Reference implementation reports non-determinism.
==

# In this test, the arrays have no guaranteed order, and the element values
# are the same 'set', but the array lengths are different. This is
# deterministic, so the reference implementation should not signal that this
# result is non-deterministic.
[required_features=ARRAY_EQUALITY]
[name=array_equality_on_incidentally_different_ordered_arrays_of_different_lenths]
SELECT a, b, a = b
FROM (
  SELECT ARRAY(SELECT e FROM UNNEST([1, 2, 3, 1]) as e) as a,
         ARRAY(SELECT e FROM UNNEST([3, 2, 1]) as e) as b,
)
--
ARRAY<STRUCT<a ARRAY<>, b ARRAY<>, BOOL>>[
  {
    ARRAY<INT64>[unknown order:1, 2, 3, 1],
    ARRAY<INT64>[unknown order:3, 2, 1],
    false
  }
]
==

# In this test, the arrays have no guaranteed order, and the arrays have the
# same length, but the sets of values are different. This is
# deterministic, but its more expensive to compute than we probably want in
# the equality operator, so we let this be a false positive for now.
[required_features=ARRAY_EQUALITY]
[name=array_equality_on_incidentally_different_ordered_arrays_of_different_value_sets]
SELECT a, b, a = b
FROM (
  SELECT ARRAY(SELECT e FROM UNNEST([1, 2, 4]) as e) as a,
         ARRAY(SELECT e FROM UNNEST([3, 2, 1]) as e) as b,
)
--
ARRAY<STRUCT<a ARRAY<>, b ARRAY<>, BOOL>>[
  {
    ARRAY<INT64>[unknown order:1, 2, 4],
    ARRAY<INT64>[unknown order:3, 2, 1],
    false
  }
]

NOTE: Reference implementation reports non-determinism.
==

# In this test, the arrays have no guaranteed order, so the result of equality
# is not knowable. This query should be marked as non-deterministic.
[required_features=ARRAY_EQUALITY]
[name=array_equality_on_incidentally_different_ordered_arrays_nested_in_structs]
SELECT a, b, a = b
FROM (
  SELECT STRUCT(1, ARRAY(SELECT e FROM UNNEST([1, 2, 3]) as e) AS f) as a,
         STRUCT(2, ARRAY(SELECT e FROM UNNEST([3, 2, 1]) as e) AS f) as b,
)
--
ARRAY<STRUCT<
        a STRUCT<INT64, f ARRAY<>>,
        b STRUCT<INT64, f ARRAY<>>,
        BOOL
      >>
[{{
    1,
    ARRAY<INT64>[unknown order:1, 2, 3]
  },
  {
    2,
    ARRAY<INT64>[unknown order:3, 2, 1]
  },
  false}]

NOTE: Reference implementation reports non-determinism.
==

# In this test, the arrays have no guaranteed order, so the result of equality
# is not knowable. This query should be marked as non-deterministic.
[required_features=ARRAY_EQUALITY]
[name=array_equality_on_incidentally_different_ordered_arrays_embeed_in_ordered_arrays]
SELECT a, b, a = b
FROM (
  SELECT [NULL, STRUCT(1, ARRAY(SELECT e FROM UNNEST([1, 2, 3]) as e) AS f)] as a,
         [NULL, STRUCT(2, ARRAY(SELECT e FROM UNNEST([3, 2, 1]) as e) AS f)] as b,
)
--
ARRAY<STRUCT<a ARRAY<>, b ARRAY<>, BOOL>>[
  {ARRAY<STRUCT<INT64, f ARRAY<>>>[known order:
     NULL,
     {
       1,
       ARRAY<INT64>[unknown order:1, 2, 3]
     }
   ],
   ARRAY<STRUCT<INT64, f ARRAY<>>>[known order:
     NULL,
     {
       2,
       ARRAY<INT64>[unknown order:3, 2, 1]
     }
   ],
   false}
]

NOTE: Reference implementation reports non-determinism.
==

# In this test, the arrays have no guaranteed order, so the result of inequality
# is not knowable. This query should be marked as non-deterministic.
[required_features=ARRAY_ORDERING]
[name=array_inequality_on_incidentally_different_ordered_arrays]
SELECT a, b, a < b
FROM (
  SELECT ARRAY(SELECT e FROM UNNEST([1, 2, 3]) as e) as a,
         ARRAY(SELECT e FROM UNNEST([3, 2, 1]) as e) as b,
)
--
ARRAY<STRUCT<a ARRAY<>, b ARRAY<>, BOOL>>[
  {
    ARRAY<INT64>[unknown order:1, 2, 3],
    ARRAY<INT64>[unknown order:3, 2, 1],
    true
  }
]

NOTE: Reference implementation reports non-determinism.
==

# In this test, the arrays have no guaranteed order and which elements are the
# prefix of the array is unknowable. The result of inequality is likewise
# unknowable. This query should be marked as non-deterministic.
[required_features=ARRAY_ORDERING]
[name=array_inequality_on_incidentally_different_ordered_arrays_of_different_lenths]
SELECT a, b, a < b
FROM (
  SELECT ARRAY(SELECT e FROM UNNEST([1, 2, 3, 1]) as e) as a,
         ARRAY(SELECT e FROM UNNEST([3, 2, 1]) as e) as b,
)
--
ARRAY<STRUCT<a ARRAY<>, b ARRAY<>, BOOL>>[
  {
    ARRAY<INT64>[unknown order:1, 2, 3, 1],
    ARRAY<INT64>[unknown order:3, 2, 1],
    true
  }
]

NOTE: Reference implementation reports non-determinism.
==

# In this test, the arrays have no guaranteed order and which elements are the
# prefix of the array is unknowable. The result of inequality is likewise
# unknowable. This query should be marked as non-deterministic.
[required_features=ARRAY_ORDERING]
[name=array_lessequal_on_incidentally_different_ordered_arrays_of_different_lenths]
SELECT a, b, a <= b
FROM (
  SELECT ARRAY(SELECT e FROM UNNEST([1, 2, 3, 1]) as e) as a,
         ARRAY(SELECT e FROM UNNEST([3, 2, 1]) as e) as b,
)
--
ARRAY<STRUCT<a ARRAY<>, b ARRAY<>, BOOL>>[
  {
    ARRAY<INT64>[unknown order:1, 2, 3, 1],
    ARRAY<INT64>[unknown order:3, 2, 1],
    true
  }
]

NOTE: Reference implementation reports non-determinism.
==

# In this test, the arrays have no guaranteed internal order. It happens that
# every element in the second array is larger than any element of the first
# array. In this case, it is possible to know that a < b. So ideally, the
# reference implementation does not report this as non-deterministic. This is
# deterministic, but its more expensive to compute than we probably want in
# the equality operator, so we let this be a false positive for now.
[required_features=ARRAY_ORDERING]
[name=array_inequality_on_incidentally_different_ordered_arrays_of_disjoint_value_ranges]
SELECT a, b, a < b
FROM (
  SELECT ARRAY(SELECT e FROM UNNEST([1, 2, 3]) as e) as a,
         ARRAY(SELECT e FROM UNNEST([4, 5, 6]) as e) as b,
)
--
ARRAY<STRUCT<a ARRAY<>, b ARRAY<>, BOOL>>[
  {
    ARRAY<INT64>[unknown order:1, 2, 3],
    ARRAY<INT64>[unknown order:4, 5, 6],
    true
  }
]

NOTE: Reference implementation reports non-determinism.
==

# In this test, the arrays have no guaranteed internal order, so the order
# between the output rows is unknowable. The result rows in this query should
# have unknown order.
[required_features=ARRAY_ORDERING]
[name=array_order_by_on_incidentally_different_ordered_arrays]
SELECT a
FROM (
  SELECT ARRAY(SELECT e FROM UNNEST([1, 2, 3]) as e) as a
  UNION ALL
  SELECT ARRAY(SELECT e FROM UNNEST([3, 2, 1]) as e) as a
)
ORDER BY a
--
ARRAY<STRUCT<a ARRAY<>>>[unknown order:
  {ARRAY<INT64>[unknown order:1, 2, 3]},
  {ARRAY<INT64>[unknown order:3, 2, 1]}
]
==

# In this test, the arrays have no guaranteed internal order, but the leading
# column in the order by key does. The row order of the final output is known.
[required_features=ARRAY_ORDERING]
[name=array_order_by_on_incidentally_different_ordered_arrays_with_ordered_prefix]
SELECT a
FROM (
  SELECT ARRAY(SELECT e FROM UNNEST([1, 2, 3]) as e) as a, 1 AS b
  UNION ALL
  SELECT ARRAY(SELECT e FROM UNNEST([3, 2, 1]) as e) as a, 2 AS b
)
ORDER BY b, a
--
ARRAY<STRUCT<a ARRAY<>>>[known order:
  {ARRAY<INT64>[unknown order:1, 2, 3]},
  {ARRAY<INT64>[unknown order:3, 2, 1]}
]
==

# In this test, the arrays have no guaranteed internal order, though the
# trailing column in the order by key does. The result rows in this query
# should have unknown order.
[required_features=ARRAY_ORDERING]
[name=array_order_by_on_incidentally_different_ordered_arrays_with_ordered_suffix]
SELECT a
FROM (
  SELECT ARRAY(SELECT e FROM UNNEST([1, 2, 3]) as e) as a, 1 AS b
  UNION ALL
  SELECT ARRAY(SELECT e FROM UNNEST([3, 2, 1]) as e) as a, 2 AS b
)
ORDER BY a, b
--
ARRAY<STRUCT<a ARRAY<>>>[unknown order:
  {ARRAY<INT64>[unknown order:1, 2, 3]},
  {ARRAY<INT64>[unknown order:3, 2, 1]}
]
==

# In this test, the arrays have no guaranteed internal order and the leading
# column in the order by provides no useful information. The result rows in
# this query should have unknown order.
[required_features=ARRAY_ORDERING]
[name=array_order_by_on_incidentally_different_ordered_arrays_with_unordered_prefix]
SELECT a
FROM (
  SELECT ARRAY(SELECT e FROM UNNEST([1, 2, 3]) as e) as a, 1 AS b
  UNION ALL
  SELECT ARRAY(SELECT e FROM UNNEST([3, 2, 1]) as e) as a, 1 AS b
)
ORDER BY b, a
--
ARRAY<STRUCT<a ARRAY<>>>[unknown order:
  {ARRAY<INT64>[unknown order:1, 2, 3]},
  {ARRAY<INT64>[unknown order:3, 2, 1]}
]
==

# In this test, the arrays have no guarenteed internal order, so whether the two
# rows group  is not knowable.
[required_features=GROUP_BY_ARRAY]
[name=array_group_by_on_incidentally_different_ordered_arrays_nested_in_structs]
SELECT a
FROM (
  SELECT ARRAY(SELECT e FROM UNNEST([1, 2, 3]) as e) as a
  UNION ALL
  SELECT ARRAY(SELECT e FROM UNNEST([3, 2, 1]) as e) as a
)
GROUP BY a
--
ARRAY<STRUCT<a ARRAY<>>>[unknown order:
  {ARRAY<INT64>[unknown order:1, 2, 3]},
  {ARRAY<INT64>[unknown order:3, 2, 1]}
]

NOTE: Reference implementation reports non-determinism.
==

# In this test, the arrays have no guarenteed internal order, so whether the two
# rows group  is not knowable.
[required_features=GROUP_BY_ARRAY,GROUP_BY_STRUCT]
[name=array_group_by_on_incidentally_different_ordered_arrays_embedded_in_ordered_arrays]
SELECT a
FROM (
  SELECT STRUCT(1, ARRAY(SELECT e FROM UNNEST([1, 2, 3]) as e) AS f) as a
  UNION ALL
  SELECT STRUCT(2, ARRAY(SELECT e FROM UNNEST([3, 2, 1]) as e) AS f) as a
)
GROUP BY a
--
ARRAY<STRUCT<a STRUCT<INT64, f ARRAY<>>>>[unknown order:
  {{
     1,
     ARRAY<INT64>[unknown order:1, 2, 3]
   }},
  {{
     2,
     ARRAY<INT64>[unknown order:3, 2, 1]
   }}
]

NOTE: Reference implementation reports non-determinism.
==

# In this test, the arrays have no guarenteed internal order, so whether the two
# rows group  is not knowable.
[required_features=GROUP_BY_ARRAY,GROUP_BY_STRUCT]
[name=array_group_by_on_incidentally_different_ordered_arrays]
SELECT a
FROM (
  SELECT [NULL, STRUCT(1, ARRAY(SELECT e FROM UNNEST([1, 2, 3]) as e) AS f)] as a
  UNION ALL
  SELECT [NULL, STRUCT(2, ARRAY(SELECT e FROM UNNEST([3, 2, 1]) as e) AS f)] as a
)
GROUP BY a
--
ARRAY<STRUCT<a ARRAY<>>>[unknown order:
  {ARRAY<STRUCT<INT64, f ARRAY<>>>[known order:
     NULL,
     {
       1,
       ARRAY<INT64>[unknown order:1, 2, 3]
     }
   ]},
  {ARRAY<STRUCT<INT64, f ARRAY<>>>[known order:
     NULL,
     {
       2,
       ARRAY<INT64>[unknown order:3, 2, 1]
     }
   ]}
]

NOTE: Reference implementation reports non-determinism.
