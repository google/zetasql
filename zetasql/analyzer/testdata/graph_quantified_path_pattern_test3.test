[default language_features=V_1_4_SQL_GRAPH,V_1_4_SQL_GRAPH_BOUNDED_PATH_QUANTIFICATION]
[default no_test_extract_table_names]
[default no_run_unparser]

# Longer quantified term. The length inside should be 3.
SELECT one FROM GRAPH_TABLE(
  aml
  MATCH((a)->->->(c)){1, 3}
  COLUMNS(1 AS one)
  )
--

QueryStmt
+-output_column_list=
| +-$graph_table.one#17 AS one [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.one#17]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.one#17]
        +-property_graph=sample_catalog.aml
        +-input_scan=
        | +-GraphScan
        |   +-column_list=$path_scan.[$head#15, $tail#16]
        |   +-input_scan_list=
        |     +-GraphPathScan
        |       +-column_list=$path_scan.[$head#15, $tail#16]
        |       +-input_scan_list=
        |       | +-GraphNodeScan
        |       | | +-column_list=[$element_table.a#1]
        |       | | +-label_expr=
        |       | | | +-GraphLabelNaryExpr
        |       | | |   +-op=OR
        |       | | |   +-operand_list=
        |       | | |     +-GraphWildCardLabel
        |       | | |     +-GraphLabelNaryExpr
        |       | | |       +-op=NOT
        |       | | |       +-operand_list=
        |       | | |         +-GraphWildCardLabel
        |       | | +-target_element_table_list=[sample_catalog.aml.Account,sample_catalog.aml.Person,sample_catalog.aml.Syndicate]
        |       | +-GraphEdgeScan
        |       | | +-column_list=[$element_table.$element1#2]
        |       | | +-label_expr=
        |       | | | +-GraphLabelNaryExpr
        |       | | |   +-op=OR
        |       | | |   +-operand_list=
        |       | | |     +-GraphWildCardLabel
        |       | | |     +-GraphLabelNaryExpr
        |       | | |       +-op=NOT
        |       | | |       +-operand_list=
        |       | | |         +-GraphWildCardLabel
        |       | | +-target_element_table_list=[sample_catalog.aml.PersonOwnAccount,sample_catalog.aml.Transfer]
        |       | | +-orientation=RIGHT
        |       | +-GraphNodeScan
        |       | | +-column_list=[$element_table.$element2#3]
        |       | | +-label_expr=
        |       | | | +-GraphLabelNaryExpr
        |       | | |   +-op=OR
        |       | | |   +-operand_list=
        |       | | |     +-GraphWildCardLabel
        |       | | |     +-GraphLabelNaryExpr
        |       | | |       +-op=NOT
        |       | | |       +-operand_list=
        |       | | |         +-GraphWildCardLabel
        |       | | +-target_element_table_list=[sample_catalog.aml.Account,sample_catalog.aml.Person,sample_catalog.aml.Syndicate]
        |       | +-GraphEdgeScan
        |       | | +-column_list=[$element_table.$element3#4]
        |       | | +-label_expr=
        |       | | | +-GraphLabelNaryExpr
        |       | | |   +-op=OR
        |       | | |   +-operand_list=
        |       | | |     +-GraphWildCardLabel
        |       | | |     +-GraphLabelNaryExpr
        |       | | |       +-op=NOT
        |       | | |       +-operand_list=
        |       | | |         +-GraphWildCardLabel
        |       | | +-target_element_table_list=[sample_catalog.aml.PersonOwnAccount,sample_catalog.aml.Transfer]
        |       | | +-orientation=RIGHT
        |       | +-GraphNodeScan
        |       | | +-column_list=[$element_table.$element4#5]
        |       | | +-label_expr=
        |       | | | +-GraphLabelNaryExpr
        |       | | |   +-op=OR
        |       | | |   +-operand_list=
        |       | | |     +-GraphWildCardLabel
        |       | | |     +-GraphLabelNaryExpr
        |       | | |       +-op=NOT
        |       | | |       +-operand_list=
        |       | | |         +-GraphWildCardLabel
        |       | | +-target_element_table_list=[sample_catalog.aml.Account,sample_catalog.aml.Person,sample_catalog.aml.Syndicate]
        |       | +-GraphEdgeScan
        |       | | +-column_list=[$element_table.$element5#6]
        |       | | +-label_expr=
        |       | | | +-GraphLabelNaryExpr
        |       | | |   +-op=OR
        |       | | |   +-operand_list=
        |       | | |     +-GraphWildCardLabel
        |       | | |     +-GraphLabelNaryExpr
        |       | | |       +-op=NOT
        |       | | |       +-operand_list=
        |       | | |         +-GraphWildCardLabel
        |       | | +-target_element_table_list=[sample_catalog.aml.PersonOwnAccount,sample_catalog.aml.Transfer]
        |       | | +-orientation=RIGHT
        |       | +-GraphNodeScan
        |       |   +-column_list=[$element_table.c#7]
        |       |   +-label_expr=
        |       |   | +-GraphLabelNaryExpr
        |       |   |   +-op=OR
        |       |   |   +-operand_list=
        |       |   |     +-GraphWildCardLabel
        |       |   |     +-GraphLabelNaryExpr
        |       |   |       +-op=NOT
        |       |   |       +-operand_list=
        |       |   |         +-GraphWildCardLabel
        |       |   +-target_element_table_list=[sample_catalog.aml.Account,sample_catalog.aml.Person,sample_catalog.aml.Syndicate]
        |       +-head=$path_scan.$head#15
        |       +-tail=$path_scan.$tail#16
        |       +-quantifier=
        |       | +-GraphPathPatternQuantifier
        |       |   +-lower_bound=
        |       |   | +-Literal(type=INT64, value=1)
        |       |   +-upper_bound=
        |       |     +-Literal(type=INT64, value=3)
        |       +-group_variable_list=
        |         +-GraphMakeArrayVariable(element=$element_table.a#1, array=$element_table.a#8)
        |         +-GraphMakeArrayVariable(element=$element_table.$element1#2, array=$element_table.$element1#9)
        |         +-GraphMakeArrayVariable(element=$element_table.$element2#3, array=$element_table.$element2#10)
        |         +-GraphMakeArrayVariable(element=$element_table.$element3#4, array=$element_table.$element3#11)
        |         +-GraphMakeArrayVariable(element=$element_table.$element4#5, array=$element_table.$element4#12)
        |         +-GraphMakeArrayVariable(element=$element_table.$element5#6, array=$element_table.$element5#13)
        |         +-GraphMakeArrayVariable(element=$element_table.c#7, array=$element_table.c#14)
        +-shape_expr_list=
          +-one#17 := Literal(type=INT64, value=1)
==

# Deeper quantified term. The length inside should be 4.
SELECT one FROM GRAPH_TABLE(
  aml
  MATCH((a)(->(->->))->(c)){1, 3}
  COLUMNS(1 AS one)
  )
--

QueryStmt
+-output_column_list=
| +-$graph_table.one#23 AS one [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.one#23]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.one#23]
        +-property_graph=sample_catalog.aml
        +-input_scan=
        | +-GraphScan
        |   +-column_list=$path_scan.[$head#21, $tail#22]
        |   +-input_scan_list=
        |     +-GraphPathScan
        |       +-column_list=$path_scan.[$head#21, $tail#22]
        |       +-input_scan_list=
        |       | +-GraphNodeScan
        |       | | +-column_list=[$element_table.a#1]
        |       | | +-label_expr=
        |       | | | +-GraphLabelNaryExpr
        |       | | |   +-op=OR
        |       | | |   +-operand_list=
        |       | | |     +-GraphWildCardLabel
        |       | | |     +-GraphLabelNaryExpr
        |       | | |       +-op=NOT
        |       | | |       +-operand_list=
        |       | | |         +-GraphWildCardLabel
        |       | | +-target_element_table_list=[sample_catalog.aml.Account,sample_catalog.aml.Person,sample_catalog.aml.Syndicate]
        |       | +-GraphPathScan
        |       | | +-column_list=$element_table.[$element1#2, $element2#3, $element3#4, $element4#5, $element5#6, $element6#7, $element7#8]
        |       | | +-input_scan_list=
        |       | | | +-GraphNodeScan
        |       | | | | +-column_list=[$element_table.$element1#2]
        |       | | | | +-label_expr=
        |       | | | | | +-GraphLabelNaryExpr
        |       | | | | |   +-op=OR
        |       | | | | |   +-operand_list=
        |       | | | | |     +-GraphWildCardLabel
        |       | | | | |     +-GraphLabelNaryExpr
        |       | | | | |       +-op=NOT
        |       | | | | |       +-operand_list=
        |       | | | | |         +-GraphWildCardLabel
        |       | | | | +-target_element_table_list=[sample_catalog.aml.Account,sample_catalog.aml.Person,sample_catalog.aml.Syndicate]
        |       | | | +-GraphEdgeScan
        |       | | | | +-column_list=[$element_table.$element2#3]
        |       | | | | +-label_expr=
        |       | | | | | +-GraphLabelNaryExpr
        |       | | | | |   +-op=OR
        |       | | | | |   +-operand_list=
        |       | | | | |     +-GraphWildCardLabel
        |       | | | | |     +-GraphLabelNaryExpr
        |       | | | | |       +-op=NOT
        |       | | | | |       +-operand_list=
        |       | | | | |         +-GraphWildCardLabel
        |       | | | | +-target_element_table_list=[sample_catalog.aml.PersonOwnAccount,sample_catalog.aml.Transfer]
        |       | | | | +-orientation=RIGHT
        |       | | | +-GraphPathScan
        |       | | |   +-column_list=$element_table.[$element3#4, $element4#5, $element5#6, $element6#7, $element7#8]
        |       | | |   +-input_scan_list=
        |       | | |   | +-GraphNodeScan
        |       | | |   | | +-column_list=[$element_table.$element3#4]
        |       | | |   | | +-label_expr=
        |       | | |   | | | +-GraphLabelNaryExpr
        |       | | |   | | |   +-op=OR
        |       | | |   | | |   +-operand_list=
        |       | | |   | | |     +-GraphWildCardLabel
        |       | | |   | | |     +-GraphLabelNaryExpr
        |       | | |   | | |       +-op=NOT
        |       | | |   | | |       +-operand_list=
        |       | | |   | | |         +-GraphWildCardLabel
        |       | | |   | | +-target_element_table_list=[sample_catalog.aml.Account,sample_catalog.aml.Person,sample_catalog.aml.Syndicate]
        |       | | |   | +-GraphEdgeScan
        |       | | |   | | +-column_list=[$element_table.$element4#5]
        |       | | |   | | +-label_expr=
        |       | | |   | | | +-GraphLabelNaryExpr
        |       | | |   | | |   +-op=OR
        |       | | |   | | |   +-operand_list=
        |       | | |   | | |     +-GraphWildCardLabel
        |       | | |   | | |     +-GraphLabelNaryExpr
        |       | | |   | | |       +-op=NOT
        |       | | |   | | |       +-operand_list=
        |       | | |   | | |         +-GraphWildCardLabel
        |       | | |   | | +-target_element_table_list=[sample_catalog.aml.PersonOwnAccount,sample_catalog.aml.Transfer]
        |       | | |   | | +-orientation=RIGHT
        |       | | |   | +-GraphNodeScan
        |       | | |   | | +-column_list=[$element_table.$element5#6]
        |       | | |   | | +-label_expr=
        |       | | |   | | | +-GraphLabelNaryExpr
        |       | | |   | | |   +-op=OR
        |       | | |   | | |   +-operand_list=
        |       | | |   | | |     +-GraphWildCardLabel
        |       | | |   | | |     +-GraphLabelNaryExpr
        |       | | |   | | |       +-op=NOT
        |       | | |   | | |       +-operand_list=
        |       | | |   | | |         +-GraphWildCardLabel
        |       | | |   | | +-target_element_table_list=[sample_catalog.aml.Account,sample_catalog.aml.Person,sample_catalog.aml.Syndicate]
        |       | | |   | +-GraphEdgeScan
        |       | | |   | | +-column_list=[$element_table.$element6#7]
        |       | | |   | | +-label_expr=
        |       | | |   | | | +-GraphLabelNaryExpr
        |       | | |   | | |   +-op=OR
        |       | | |   | | |   +-operand_list=
        |       | | |   | | |     +-GraphWildCardLabel
        |       | | |   | | |     +-GraphLabelNaryExpr
        |       | | |   | | |       +-op=NOT
        |       | | |   | | |       +-operand_list=
        |       | | |   | | |         +-GraphWildCardLabel
        |       | | |   | | +-target_element_table_list=[sample_catalog.aml.PersonOwnAccount,sample_catalog.aml.Transfer]
        |       | | |   | | +-orientation=RIGHT
        |       | | |   | +-GraphNodeScan
        |       | | |   |   +-column_list=[$element_table.$element7#8]
        |       | | |   |   +-label_expr=
        |       | | |   |   | +-GraphLabelNaryExpr
        |       | | |   |   |   +-op=OR
        |       | | |   |   |   +-operand_list=
        |       | | |   |   |     +-GraphWildCardLabel
        |       | | |   |   |     +-GraphLabelNaryExpr
        |       | | |   |   |       +-op=NOT
        |       | | |   |   |       +-operand_list=
        |       | | |   |   |         +-GraphWildCardLabel
        |       | | |   |   +-target_element_table_list=[sample_catalog.aml.Account,sample_catalog.aml.Person,sample_catalog.aml.Syndicate]
        |       | | |   +-head=$element_table.$element3#4
        |       | | |   +-tail=$element_table.$element7#8
        |       | | +-head=$element_table.$element1#2
        |       | | +-tail=$element_table.$element7#8
        |       | +-GraphEdgeScan
        |       | | +-column_list=[$element_table.$element8#9]
        |       | | +-label_expr=
        |       | | | +-GraphLabelNaryExpr
        |       | | |   +-op=OR
        |       | | |   +-operand_list=
        |       | | |     +-GraphWildCardLabel
        |       | | |     +-GraphLabelNaryExpr
        |       | | |       +-op=NOT
        |       | | |       +-operand_list=
        |       | | |         +-GraphWildCardLabel
        |       | | +-target_element_table_list=[sample_catalog.aml.PersonOwnAccount,sample_catalog.aml.Transfer]
        |       | | +-orientation=RIGHT
        |       | +-GraphNodeScan
        |       |   +-column_list=[$element_table.c#10]
        |       |   +-label_expr=
        |       |   | +-GraphLabelNaryExpr
        |       |   |   +-op=OR
        |       |   |   +-operand_list=
        |       |   |     +-GraphWildCardLabel
        |       |   |     +-GraphLabelNaryExpr
        |       |   |       +-op=NOT
        |       |   |       +-operand_list=
        |       |   |         +-GraphWildCardLabel
        |       |   +-target_element_table_list=[sample_catalog.aml.Account,sample_catalog.aml.Person,sample_catalog.aml.Syndicate]
        |       +-head=$path_scan.$head#21
        |       +-tail=$path_scan.$tail#22
        |       +-quantifier=
        |       | +-GraphPathPatternQuantifier
        |       |   +-lower_bound=
        |       |   | +-Literal(type=INT64, value=1)
        |       |   +-upper_bound=
        |       |     +-Literal(type=INT64, value=3)
        |       +-group_variable_list=
        |         +-GraphMakeArrayVariable(element=$element_table.a#1, array=$element_table.a#11)
        |         +-GraphMakeArrayVariable(element=$element_table.$element1#2, array=$element_table.$element1#12)
        |         +-GraphMakeArrayVariable(element=$element_table.$element2#3, array=$element_table.$element2#13)
        |         +-GraphMakeArrayVariable(element=$element_table.$element3#4, array=$element_table.$element3#14)
        |         +-GraphMakeArrayVariable(element=$element_table.$element4#5, array=$element_table.$element4#15)
        |         +-GraphMakeArrayVariable(element=$element_table.$element5#6, array=$element_table.$element5#16)
        |         +-GraphMakeArrayVariable(element=$element_table.$element6#7, array=$element_table.$element6#17)
        |         +-GraphMakeArrayVariable(element=$element_table.$element7#8, array=$element_table.$element7#18)
        |         +-GraphMakeArrayVariable(element=$element_table.$element8#9, array=$element_table.$element8#19)
        |         +-GraphMakeArrayVariable(element=$element_table.c#10, array=$element_table.c#20)
        +-shape_expr_list=
          +-one#23 := Literal(type=INT64, value=1)
==

# Multiple deep quantified term, the quantified cost column should be preserved at the top. Also edges from subqueries shouldn't be counted.
SELECT one FROM GRAPH_TABLE(
  aml
  MATCH (
         (a)
         (
          ->
          (->-> WHERE EXISTS( SELECT x FROM GRAPH_TABLE(aml MATCH -> COLUMNS(1 AS x))))
         )
         ->(c)
        ){1, 3}  -- The length should be 4.
        (
          (
            (
              (-> WHERE EXISTS( SELECT y FROM GRAPH_TABLE(aml MATCH -> COLUMNS(1 AS y))))
              ->
            ){4, 5}  -- The length should be 2.
            ->
          )
        )
  COLUMNS(1 AS one)
  )
--
QueryStmt
+-output_column_list=
| +-$graph_table.one#45 AS one [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.one#45]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.one#45]
        +-property_graph=sample_catalog.aml
        +-input_scan=
        | +-GraphScan
        |   +-column_list=[$path_scan.$head#25, $path_scan.$tail#26, $path_scan.$head#41, $path_scan.$tail#42, $element_table.$element14#43, $element_table.$element15#44]
        |   +-input_scan_list=
        |     +-GraphPathScan
        |       +-column_list=[$path_scan.$head#25, $path_scan.$tail#26, $path_scan.$head#41, $path_scan.$tail#42, $element_table.$element14#43, $element_table.$element15#44]
        |       +-input_scan_list=
        |       | +-GraphPathScan
        |       | | +-column_list=$path_scan.[$head#25, $tail#26]
        |       | | +-input_scan_list=
        |       | | | +-GraphNodeScan
        |       | | | | +-column_list=[$element_table.a#1]
        |       | | | | +-label_expr=
        |       | | | | | +-GraphLabelNaryExpr
        |       | | | | |   +-op=OR
        |       | | | | |   +-operand_list=
        |       | | | | |     +-GraphWildCardLabel
        |       | | | | |     +-GraphLabelNaryExpr
        |       | | | | |       +-op=NOT
        |       | | | | |       +-operand_list=
        |       | | | | |         +-GraphWildCardLabel
        |       | | | | +-target_element_table_list=[sample_catalog.aml.Account,sample_catalog.aml.Person,sample_catalog.aml.Syndicate]
        |       | | | +-GraphPathScan
        |       | | | | +-column_list=$element_table.[$element1#2, $element2#3, $element3#4, $element4#5, $element5#6, $element6#7, $element7#8]
        |       | | | | +-input_scan_list=
        |       | | | | | +-GraphNodeScan
        |       | | | | | | +-column_list=[$element_table.$element1#2]
        |       | | | | | | +-label_expr=
        |       | | | | | | | +-GraphLabelNaryExpr
        |       | | | | | | |   +-op=OR
        |       | | | | | | |   +-operand_list=
        |       | | | | | | |     +-GraphWildCardLabel
        |       | | | | | | |     +-GraphLabelNaryExpr
        |       | | | | | | |       +-op=NOT
        |       | | | | | | |       +-operand_list=
        |       | | | | | | |         +-GraphWildCardLabel
        |       | | | | | | +-target_element_table_list=[sample_catalog.aml.Account,sample_catalog.aml.Person,sample_catalog.aml.Syndicate]
        |       | | | | | +-GraphEdgeScan
        |       | | | | | | +-column_list=[$element_table.$element2#3]
        |       | | | | | | +-label_expr=
        |       | | | | | | | +-GraphLabelNaryExpr
        |       | | | | | | |   +-op=OR
        |       | | | | | | |   +-operand_list=
        |       | | | | | | |     +-GraphWildCardLabel
        |       | | | | | | |     +-GraphLabelNaryExpr
        |       | | | | | | |       +-op=NOT
        |       | | | | | | |       +-operand_list=
        |       | | | | | | |         +-GraphWildCardLabel
        |       | | | | | | +-target_element_table_list=[sample_catalog.aml.PersonOwnAccount,sample_catalog.aml.Transfer]
        |       | | | | | | +-orientation=RIGHT
        |       | | | | | +-GraphPathScan
        |       | | | | |   +-column_list=$element_table.[$element3#4, $element4#5, $element5#6, $element6#7, $element7#8]
        |       | | | | |   +-input_scan_list=
        |       | | | | |   | +-GraphNodeScan
        |       | | | | |   | | +-column_list=[$element_table.$element3#4]
        |       | | | | |   | | +-label_expr=
        |       | | | | |   | | | +-GraphLabelNaryExpr
        |       | | | | |   | | |   +-op=OR
        |       | | | | |   | | |   +-operand_list=
        |       | | | | |   | | |     +-GraphWildCardLabel
        |       | | | | |   | | |     +-GraphLabelNaryExpr
        |       | | | | |   | | |       +-op=NOT
        |       | | | | |   | | |       +-operand_list=
        |       | | | | |   | | |         +-GraphWildCardLabel
        |       | | | | |   | | +-target_element_table_list=[sample_catalog.aml.Account,sample_catalog.aml.Person,sample_catalog.aml.Syndicate]
        |       | | | | |   | +-GraphEdgeScan
        |       | | | | |   | | +-column_list=[$element_table.$element4#5]
        |       | | | | |   | | +-label_expr=
        |       | | | | |   | | | +-GraphLabelNaryExpr
        |       | | | | |   | | |   +-op=OR
        |       | | | | |   | | |   +-operand_list=
        |       | | | | |   | | |     +-GraphWildCardLabel
        |       | | | | |   | | |     +-GraphLabelNaryExpr
        |       | | | | |   | | |       +-op=NOT
        |       | | | | |   | | |       +-operand_list=
        |       | | | | |   | | |         +-GraphWildCardLabel
        |       | | | | |   | | +-target_element_table_list=[sample_catalog.aml.PersonOwnAccount,sample_catalog.aml.Transfer]
        |       | | | | |   | | +-orientation=RIGHT
        |       | | | | |   | +-GraphNodeScan
        |       | | | | |   | | +-column_list=[$element_table.$element5#6]
        |       | | | | |   | | +-label_expr=
        |       | | | | |   | | | +-GraphLabelNaryExpr
        |       | | | | |   | | |   +-op=OR
        |       | | | | |   | | |   +-operand_list=
        |       | | | | |   | | |     +-GraphWildCardLabel
        |       | | | | |   | | |     +-GraphLabelNaryExpr
        |       | | | | |   | | |       +-op=NOT
        |       | | | | |   | | |       +-operand_list=
        |       | | | | |   | | |         +-GraphWildCardLabel
        |       | | | | |   | | +-target_element_table_list=[sample_catalog.aml.Account,sample_catalog.aml.Person,sample_catalog.aml.Syndicate]
        |       | | | | |   | +-GraphEdgeScan
        |       | | | | |   | | +-column_list=[$element_table.$element6#7]
        |       | | | | |   | | +-label_expr=
        |       | | | | |   | | | +-GraphLabelNaryExpr
        |       | | | | |   | | |   +-op=OR
        |       | | | | |   | | |   +-operand_list=
        |       | | | | |   | | |     +-GraphWildCardLabel
        |       | | | | |   | | |     +-GraphLabelNaryExpr
        |       | | | | |   | | |       +-op=NOT
        |       | | | | |   | | |       +-operand_list=
        |       | | | | |   | | |         +-GraphWildCardLabel
        |       | | | | |   | | +-target_element_table_list=[sample_catalog.aml.PersonOwnAccount,sample_catalog.aml.Transfer]
        |       | | | | |   | | +-orientation=RIGHT
        |       | | | | |   | +-GraphNodeScan
        |       | | | | |   |   +-column_list=[$element_table.$element7#8]
        |       | | | | |   |   +-label_expr=
        |       | | | | |   |   | +-GraphLabelNaryExpr
        |       | | | | |   |   |   +-op=OR
        |       | | | | |   |   |   +-operand_list=
        |       | | | | |   |   |     +-GraphWildCardLabel
        |       | | | | |   |   |     +-GraphLabelNaryExpr
        |       | | | | |   |   |       +-op=NOT
        |       | | | | |   |   |       +-operand_list=
        |       | | | | |   |   |         +-GraphWildCardLabel
        |       | | | | |   |   +-target_element_table_list=[sample_catalog.aml.Account,sample_catalog.aml.Person,sample_catalog.aml.Syndicate]
        |       | | | | |   +-filter_expr=
        |       | | | | |   | +-SubqueryExpr
        |       | | | | |   |   +-type=BOOL
        |       | | | | |   |   +-subquery_type=EXISTS
        |       | | | | |   |   +-subquery=
        |       | | | | |   |     +-ProjectScan
        |       | | | | |   |       +-column_list=[$graph_table.x#12]
        |       | | | | |   |       +-input_scan=
        |       | | | | |   |         +-GraphTableScan
        |       | | | | |   |           +-column_list=[$graph_table.x#12]
        |       | | | | |   |           +-property_graph=sample_catalog.aml
        |       | | | | |   |           +-input_scan=
        |       | | | | |   |           | +-GraphScan
        |       | | | | |   |           |   +-column_list=$element_table.[$element1#9, $element2#10, $element3#11]
        |       | | | | |   |           |   +-input_scan_list=
        |       | | | | |   |           |     +-GraphPathScan
        |       | | | | |   |           |       +-column_list=$element_table.[$element1#9, $element2#10, $element3#11]
        |       | | | | |   |           |       +-input_scan_list=
        |       | | | | |   |           |       | +-GraphNodeScan
        |       | | | | |   |           |       | | +-column_list=[$element_table.$element1#9]
        |       | | | | |   |           |       | | +-label_expr=
        |       | | | | |   |           |       | | | +-GraphLabelNaryExpr
        |       | | | | |   |           |       | | |   +-op=OR
        |       | | | | |   |           |       | | |   +-operand_list=
        |       | | | | |   |           |       | | |     +-GraphWildCardLabel
        |       | | | | |   |           |       | | |     +-GraphLabelNaryExpr
        |       | | | | |   |           |       | | |       +-op=NOT
        |       | | | | |   |           |       | | |       +-operand_list=
        |       | | | | |   |           |       | | |         +-GraphWildCardLabel
        |       | | | | |   |           |       | | +-target_element_table_list=[sample_catalog.aml.Account,sample_catalog.aml.Person,sample_catalog.aml.Syndicate]
        |       | | | | |   |           |       | +-GraphEdgeScan
        |       | | | | |   |           |       | | +-column_list=[$element_table.$element2#10]
        |       | | | | |   |           |       | | +-label_expr=
        |       | | | | |   |           |       | | | +-GraphLabelNaryExpr
        |       | | | | |   |           |       | | |   +-op=OR
        |       | | | | |   |           |       | | |   +-operand_list=
        |       | | | | |   |           |       | | |     +-GraphWildCardLabel
        |       | | | | |   |           |       | | |     +-GraphLabelNaryExpr
        |       | | | | |   |           |       | | |       +-op=NOT
        |       | | | | |   |           |       | | |       +-operand_list=
        |       | | | | |   |           |       | | |         +-GraphWildCardLabel
        |       | | | | |   |           |       | | +-target_element_table_list=[sample_catalog.aml.PersonOwnAccount,sample_catalog.aml.Transfer]
        |       | | | | |   |           |       | | +-orientation=RIGHT
        |       | | | | |   |           |       | +-GraphNodeScan
        |       | | | | |   |           |       |   +-column_list=[$element_table.$element3#11]
        |       | | | | |   |           |       |   +-label_expr=
        |       | | | | |   |           |       |   | +-GraphLabelNaryExpr
        |       | | | | |   |           |       |   |   +-op=OR
        |       | | | | |   |           |       |   |   +-operand_list=
        |       | | | | |   |           |       |   |     +-GraphWildCardLabel
        |       | | | | |   |           |       |   |     +-GraphLabelNaryExpr
        |       | | | | |   |           |       |   |       +-op=NOT
        |       | | | | |   |           |       |   |       +-operand_list=
        |       | | | | |   |           |       |   |         +-GraphWildCardLabel
        |       | | | | |   |           |       |   +-target_element_table_list=[sample_catalog.aml.Account,sample_catalog.aml.Person,sample_catalog.aml.Syndicate]
        |       | | | | |   |           |       +-head=$element_table.$element1#9
        |       | | | | |   |           |       +-tail=$element_table.$element3#11
        |       | | | | |   |           +-shape_expr_list=
        |       | | | | |   |             +-x#12 := Literal(type=INT64, value=1)
        |       | | | | |   +-head=$element_table.$element3#4
        |       | | | | |   +-tail=$element_table.$element7#8
        |       | | | | +-head=$element_table.$element1#2
        |       | | | | +-tail=$element_table.$element7#8
        |       | | | +-GraphEdgeScan
        |       | | | | +-column_list=[$element_table.$element8#13]
        |       | | | | +-label_expr=
        |       | | | | | +-GraphLabelNaryExpr
        |       | | | | |   +-op=OR
        |       | | | | |   +-operand_list=
        |       | | | | |     +-GraphWildCardLabel
        |       | | | | |     +-GraphLabelNaryExpr
        |       | | | | |       +-op=NOT
        |       | | | | |       +-operand_list=
        |       | | | | |         +-GraphWildCardLabel
        |       | | | | +-target_element_table_list=[sample_catalog.aml.PersonOwnAccount,sample_catalog.aml.Transfer]
        |       | | | | +-orientation=RIGHT
        |       | | | +-GraphNodeScan
        |       | | |   +-column_list=[$element_table.c#14]
        |       | | |   +-label_expr=
        |       | | |   | +-GraphLabelNaryExpr
        |       | | |   |   +-op=OR
        |       | | |   |   +-operand_list=
        |       | | |   |     +-GraphWildCardLabel
        |       | | |   |     +-GraphLabelNaryExpr
        |       | | |   |       +-op=NOT
        |       | | |   |       +-operand_list=
        |       | | |   |         +-GraphWildCardLabel
        |       | | |   +-target_element_table_list=[sample_catalog.aml.Account,sample_catalog.aml.Person,sample_catalog.aml.Syndicate]
        |       | | +-head=$path_scan.$head#25
        |       | | +-tail=$path_scan.$tail#26
        |       | | +-quantifier=
        |       | | | +-GraphPathPatternQuantifier
        |       | | |   +-lower_bound=
        |       | | |   | +-Literal(type=INT64, value=1)
        |       | | |   +-upper_bound=
        |       | | |     +-Literal(type=INT64, value=3)
        |       | | +-group_variable_list=
        |       | |   +-GraphMakeArrayVariable(element=$element_table.a#1, array=$element_table.a#15)
        |       | |   +-GraphMakeArrayVariable(element=$element_table.$element1#2, array=$element_table.$element1#16)
        |       | |   +-GraphMakeArrayVariable(element=$element_table.$element2#3, array=$element_table.$element2#17)
        |       | |   +-GraphMakeArrayVariable(element=$element_table.$element3#4, array=$element_table.$element3#18)
        |       | |   +-GraphMakeArrayVariable(element=$element_table.$element4#5, array=$element_table.$element4#19)
        |       | |   +-GraphMakeArrayVariable(element=$element_table.$element5#6, array=$element_table.$element5#20)
        |       | |   +-GraphMakeArrayVariable(element=$element_table.$element6#7, array=$element_table.$element6#21)
        |       | |   +-GraphMakeArrayVariable(element=$element_table.$element7#8, array=$element_table.$element7#22)
        |       | |   +-GraphMakeArrayVariable(element=$element_table.$element8#13, array=$element_table.$element8#23)
        |       | |   +-GraphMakeArrayVariable(element=$element_table.c#14, array=$element_table.c#24)
        |       | +-GraphPathScan
        |       |   +-column_list=[$path_scan.$head#41, $path_scan.$tail#42, $element_table.$element14#43, $element_table.$element15#44]
        |       |   +-input_scan_list=
        |       |   | +-GraphPathScan
        |       |   | | +-column_list=$path_scan.[$head#41, $tail#42]
        |       |   | | +-input_scan_list=
        |       |   | | | +-GraphPathScan
        |       |   | | | | +-column_list=$element_table.[$element9#27, $element10#28, $element11#29]
        |       |   | | | | +-input_scan_list=
        |       |   | | | | | +-GraphNodeScan
        |       |   | | | | | | +-column_list=[$element_table.$element9#27]
        |       |   | | | | | | +-label_expr=
        |       |   | | | | | | | +-GraphLabelNaryExpr
        |       |   | | | | | | |   +-op=OR
        |       |   | | | | | | |   +-operand_list=
        |       |   | | | | | | |     +-GraphWildCardLabel
        |       |   | | | | | | |     +-GraphLabelNaryExpr
        |       |   | | | | | | |       +-op=NOT
        |       |   | | | | | | |       +-operand_list=
        |       |   | | | | | | |         +-GraphWildCardLabel
        |       |   | | | | | | +-target_element_table_list=[sample_catalog.aml.Account,sample_catalog.aml.Person,sample_catalog.aml.Syndicate]
        |       |   | | | | | +-GraphEdgeScan
        |       |   | | | | | | +-column_list=[$element_table.$element10#28]
        |       |   | | | | | | +-label_expr=
        |       |   | | | | | | | +-GraphLabelNaryExpr
        |       |   | | | | | | |   +-op=OR
        |       |   | | | | | | |   +-operand_list=
        |       |   | | | | | | |     +-GraphWildCardLabel
        |       |   | | | | | | |     +-GraphLabelNaryExpr
        |       |   | | | | | | |       +-op=NOT
        |       |   | | | | | | |       +-operand_list=
        |       |   | | | | | | |         +-GraphWildCardLabel
        |       |   | | | | | | +-target_element_table_list=[sample_catalog.aml.PersonOwnAccount,sample_catalog.aml.Transfer]
        |       |   | | | | | | +-orientation=RIGHT
        |       |   | | | | | +-GraphNodeScan
        |       |   | | | | |   +-column_list=[$element_table.$element11#29]
        |       |   | | | | |   +-label_expr=
        |       |   | | | | |   | +-GraphLabelNaryExpr
        |       |   | | | | |   |   +-op=OR
        |       |   | | | | |   |   +-operand_list=
        |       |   | | | | |   |     +-GraphWildCardLabel
        |       |   | | | | |   |     +-GraphLabelNaryExpr
        |       |   | | | | |   |       +-op=NOT
        |       |   | | | | |   |       +-operand_list=
        |       |   | | | | |   |         +-GraphWildCardLabel
        |       |   | | | | |   +-target_element_table_list=[sample_catalog.aml.Account,sample_catalog.aml.Person,sample_catalog.aml.Syndicate]
        |       |   | | | | +-filter_expr=
        |       |   | | | | | +-SubqueryExpr
        |       |   | | | | |   +-type=BOOL
        |       |   | | | | |   +-subquery_type=EXISTS
        |       |   | | | | |   +-subquery=
        |       |   | | | | |     +-ProjectScan
        |       |   | | | | |       +-column_list=[$graph_table.y#33]
        |       |   | | | | |       +-input_scan=
        |       |   | | | | |         +-GraphTableScan
        |       |   | | | | |           +-column_list=[$graph_table.y#33]
        |       |   | | | | |           +-property_graph=sample_catalog.aml
        |       |   | | | | |           +-input_scan=
        |       |   | | | | |           | +-GraphScan
        |       |   | | | | |           |   +-column_list=$element_table.[$element1#30, $element2#31, $element3#32]
        |       |   | | | | |           |   +-input_scan_list=
        |       |   | | | | |           |     +-GraphPathScan
        |       |   | | | | |           |       +-column_list=$element_table.[$element1#30, $element2#31, $element3#32]
        |       |   | | | | |           |       +-input_scan_list=
        |       |   | | | | |           |       | +-GraphNodeScan
        |       |   | | | | |           |       | | +-column_list=[$element_table.$element1#30]
        |       |   | | | | |           |       | | +-label_expr=
        |       |   | | | | |           |       | | | +-GraphLabelNaryExpr
        |       |   | | | | |           |       | | |   +-op=OR
        |       |   | | | | |           |       | | |   +-operand_list=
        |       |   | | | | |           |       | | |     +-GraphWildCardLabel
        |       |   | | | | |           |       | | |     +-GraphLabelNaryExpr
        |       |   | | | | |           |       | | |       +-op=NOT
        |       |   | | | | |           |       | | |       +-operand_list=
        |       |   | | | | |           |       | | |         +-GraphWildCardLabel
        |       |   | | | | |           |       | | +-target_element_table_list=[sample_catalog.aml.Account,sample_catalog.aml.Person,sample_catalog.aml.Syndicate]
        |       |   | | | | |           |       | +-GraphEdgeScan
        |       |   | | | | |           |       | | +-column_list=[$element_table.$element2#31]
        |       |   | | | | |           |       | | +-label_expr=
        |       |   | | | | |           |       | | | +-GraphLabelNaryExpr
        |       |   | | | | |           |       | | |   +-op=OR
        |       |   | | | | |           |       | | |   +-operand_list=
        |       |   | | | | |           |       | | |     +-GraphWildCardLabel
        |       |   | | | | |           |       | | |     +-GraphLabelNaryExpr
        |       |   | | | | |           |       | | |       +-op=NOT
        |       |   | | | | |           |       | | |       +-operand_list=
        |       |   | | | | |           |       | | |         +-GraphWildCardLabel
        |       |   | | | | |           |       | | +-target_element_table_list=[sample_catalog.aml.PersonOwnAccount,sample_catalog.aml.Transfer]
        |       |   | | | | |           |       | | +-orientation=RIGHT
        |       |   | | | | |           |       | +-GraphNodeScan
        |       |   | | | | |           |       |   +-column_list=[$element_table.$element3#32]
        |       |   | | | | |           |       |   +-label_expr=
        |       |   | | | | |           |       |   | +-GraphLabelNaryExpr
        |       |   | | | | |           |       |   |   +-op=OR
        |       |   | | | | |           |       |   |   +-operand_list=
        |       |   | | | | |           |       |   |     +-GraphWildCardLabel
        |       |   | | | | |           |       |   |     +-GraphLabelNaryExpr
        |       |   | | | | |           |       |   |       +-op=NOT
        |       |   | | | | |           |       |   |       +-operand_list=
        |       |   | | | | |           |       |   |         +-GraphWildCardLabel
        |       |   | | | | |           |       |   +-target_element_table_list=[sample_catalog.aml.Account,sample_catalog.aml.Person,sample_catalog.aml.Syndicate]
        |       |   | | | | |           |       +-head=$element_table.$element1#30
        |       |   | | | | |           |       +-tail=$element_table.$element3#32
        |       |   | | | | |           +-shape_expr_list=
        |       |   | | | | |             +-y#33 := Literal(type=INT64, value=1)
        |       |   | | | | +-head=$element_table.$element9#27
        |       |   | | | | +-tail=$element_table.$element11#29
        |       |   | | | +-GraphEdgeScan
        |       |   | | | | +-column_list=[$element_table.$element12#34]
        |       |   | | | | +-label_expr=
        |       |   | | | | | +-GraphLabelNaryExpr
        |       |   | | | | |   +-op=OR
        |       |   | | | | |   +-operand_list=
        |       |   | | | | |     +-GraphWildCardLabel
        |       |   | | | | |     +-GraphLabelNaryExpr
        |       |   | | | | |       +-op=NOT
        |       |   | | | | |       +-operand_list=
        |       |   | | | | |         +-GraphWildCardLabel
        |       |   | | | | +-target_element_table_list=[sample_catalog.aml.PersonOwnAccount,sample_catalog.aml.Transfer]
        |       |   | | | | +-orientation=RIGHT
        |       |   | | | +-GraphNodeScan
        |       |   | | |   +-column_list=[$element_table.$element13#35]
        |       |   | | |   +-label_expr=
        |       |   | | |   | +-GraphLabelNaryExpr
        |       |   | | |   |   +-op=OR
        |       |   | | |   |   +-operand_list=
        |       |   | | |   |     +-GraphWildCardLabel
        |       |   | | |   |     +-GraphLabelNaryExpr
        |       |   | | |   |       +-op=NOT
        |       |   | | |   |       +-operand_list=
        |       |   | | |   |         +-GraphWildCardLabel
        |       |   | | |   +-target_element_table_list=[sample_catalog.aml.Account,sample_catalog.aml.Person,sample_catalog.aml.Syndicate]
        |       |   | | +-head=$path_scan.$head#41
        |       |   | | +-tail=$path_scan.$tail#42
        |       |   | | +-quantifier=
        |       |   | | | +-GraphPathPatternQuantifier
        |       |   | | |   +-lower_bound=
        |       |   | | |   | +-Literal(type=INT64, value=4)
        |       |   | | |   +-upper_bound=
        |       |   | | |     +-Literal(type=INT64, value=5)
        |       |   | | +-group_variable_list=
        |       |   | |   +-GraphMakeArrayVariable(element=$element_table.$element9#27, array=$element_table.$element9#36)
        |       |   | |   +-GraphMakeArrayVariable(element=$element_table.$element10#28, array=$element_table.$element10#37)
        |       |   | |   +-GraphMakeArrayVariable(element=$element_table.$element11#29, array=$element_table.$element11#38)
        |       |   | |   +-GraphMakeArrayVariable(element=$element_table.$element12#34, array=$element_table.$element12#39)
        |       |   | |   +-GraphMakeArrayVariable(element=$element_table.$element13#35, array=$element_table.$element13#40)
        |       |   | +-GraphEdgeScan
        |       |   | | +-column_list=[$element_table.$element14#43]
        |       |   | | +-label_expr=
        |       |   | | | +-GraphLabelNaryExpr
        |       |   | | |   +-op=OR
        |       |   | | |   +-operand_list=
        |       |   | | |     +-GraphWildCardLabel
        |       |   | | |     +-GraphLabelNaryExpr
        |       |   | | |       +-op=NOT
        |       |   | | |       +-operand_list=
        |       |   | | |         +-GraphWildCardLabel
        |       |   | | +-target_element_table_list=[sample_catalog.aml.PersonOwnAccount,sample_catalog.aml.Transfer]
        |       |   | | +-orientation=RIGHT
        |       |   | +-GraphNodeScan
        |       |   |   +-column_list=[$element_table.$element15#44]
        |       |   |   +-label_expr=
        |       |   |   | +-GraphLabelNaryExpr
        |       |   |   |   +-op=OR
        |       |   |   |   +-operand_list=
        |       |   |   |     +-GraphWildCardLabel
        |       |   |   |     +-GraphLabelNaryExpr
        |       |   |   |       +-op=NOT
        |       |   |   |       +-operand_list=
        |       |   |   |         +-GraphWildCardLabel
        |       |   |   +-target_element_table_list=[sample_catalog.aml.Account,sample_catalog.aml.Person,sample_catalog.aml.Syndicate]
        |       |   +-head=$path_scan.$head#41
        |       |   +-tail=$element_table.$element15#44
        |       +-head=$path_scan.$head#25
        |       +-tail=$element_table.$element15#44
        +-shape_expr_list=
          +-one#45 := Literal(type=INT64, value=1)
==

# b/341088421: Undirected edge following a quantified path
select gt.* from graph_table(
  aml
  MATCH ((a)-[b]-(c)){1, 3}-[e]-(n)
  COLUMNS (1 AS One)
) gt
--
QueryStmt
+-output_column_list=
| +-$graph_table.One#11 AS One [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.One#11]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.One#11]
        +-property_graph=sample_catalog.aml
        +-input_scan=
        | +-GraphScan
        |   +-column_list=[$path_scan.$head#7, $path_scan.$tail#8, $element_table.e#9, $element_table.n#10]
        |   +-input_scan_list=
        |     +-GraphPathScan
        |       +-column_list=[$path_scan.$head#7, $path_scan.$tail#8, $element_table.e#9, $element_table.n#10]
        |       +-input_scan_list=
        |       | +-GraphPathScan
        |       | | +-column_list=$path_scan.[$head#7, $tail#8]
        |       | | +-input_scan_list=
        |       | | | +-GraphNodeScan
        |       | | | | +-column_list=[$element_table.a#1]
        |       | | | | +-label_expr=
        |       | | | | | +-GraphLabelNaryExpr
        |       | | | | |   +-op=OR
        |       | | | | |   +-operand_list=
        |       | | | | |     +-GraphWildCardLabel
        |       | | | | |     +-GraphLabelNaryExpr
        |       | | | | |       +-op=NOT
        |       | | | | |       +-operand_list=
        |       | | | | |         +-GraphWildCardLabel
        |       | | | | +-target_element_table_list=[sample_catalog.aml.Account,sample_catalog.aml.Person,sample_catalog.aml.Syndicate]
        |       | | | +-GraphEdgeScan
        |       | | | | +-column_list=[$element_table.b#2]
        |       | | | | +-label_expr=
        |       | | | | | +-GraphLabelNaryExpr
        |       | | | | |   +-op=OR
        |       | | | | |   +-operand_list=
        |       | | | | |     +-GraphWildCardLabel
        |       | | | | |     +-GraphLabelNaryExpr
        |       | | | | |       +-op=NOT
        |       | | | | |       +-operand_list=
        |       | | | | |         +-GraphWildCardLabel
        |       | | | | +-target_element_table_list=[sample_catalog.aml.PersonOwnAccount,sample_catalog.aml.Transfer]
        |       | | | | +-orientation=ANY
        |       | | | +-GraphNodeScan
        |       | | |   +-column_list=[$element_table.c#3]
        |       | | |   +-label_expr=
        |       | | |   | +-GraphLabelNaryExpr
        |       | | |   |   +-op=OR
        |       | | |   |   +-operand_list=
        |       | | |   |     +-GraphWildCardLabel
        |       | | |   |     +-GraphLabelNaryExpr
        |       | | |   |       +-op=NOT
        |       | | |   |       +-operand_list=
        |       | | |   |         +-GraphWildCardLabel
        |       | | |   +-target_element_table_list=[sample_catalog.aml.Account,sample_catalog.aml.Person,sample_catalog.aml.Syndicate]
        |       | | +-head=$path_scan.$head#7
        |       | | +-tail=$path_scan.$tail#8
        |       | | +-quantifier=
        |       | | | +-GraphPathPatternQuantifier
        |       | | |   +-lower_bound=
        |       | | |   | +-Literal(type=INT64, value=1)
        |       | | |   +-upper_bound=
        |       | | |     +-Literal(type=INT64, value=3)
        |       | | +-group_variable_list=
        |       | |   +-GraphMakeArrayVariable(element=$element_table.a#1, array=$element_table.a#4)
        |       | |   +-GraphMakeArrayVariable(element=$element_table.b#2, array=$element_table.b#5)
        |       | |   +-GraphMakeArrayVariable(element=$element_table.c#3, array=$element_table.c#6)
        |       | +-GraphEdgeScan
        |       | | +-column_list=[$element_table.e#9]
        |       | | +-label_expr=
        |       | | | +-GraphLabelNaryExpr
        |       | | |   +-op=OR
        |       | | |   +-operand_list=
        |       | | |     +-GraphWildCardLabel
        |       | | |     +-GraphLabelNaryExpr
        |       | | |       +-op=NOT
        |       | | |       +-operand_list=
        |       | | |         +-GraphWildCardLabel
        |       | | +-target_element_table_list=[sample_catalog.aml.PersonOwnAccount,sample_catalog.aml.Transfer]
        |       | | +-orientation=ANY
        |       | +-GraphNodeScan
        |       |   +-column_list=[$element_table.n#10]
        |       |   +-label_expr=
        |       |   | +-GraphLabelNaryExpr
        |       |   |   +-op=OR
        |       |   |   +-operand_list=
        |       |   |     +-GraphWildCardLabel
        |       |   |     +-GraphLabelNaryExpr
        |       |   |       +-op=NOT
        |       |   |       +-operand_list=
        |       |   |         +-GraphWildCardLabel
        |       |   +-target_element_table_list=[sample_catalog.aml.Account,sample_catalog.aml.Person,sample_catalog.aml.Syndicate]
        |       +-head=$path_scan.$head#7
        |       +-tail=$element_table.n#10
        +-shape_expr_list=
          +-One#11 := Literal(type=INT64, value=1)
==

# Undirected edge leading to a quantified path
select gt.* from graph_table(
  aml
  MATCH (x)-[y]-((a)-[b]-(c)){1, 3}
  COLUMNS (1 AS One)
) gt
--
QueryStmt
+-output_column_list=
| +-$graph_table.One#11 AS One [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.One#11]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.One#11]
        +-property_graph=sample_catalog.aml
        +-input_scan=
        | +-GraphScan
        |   +-column_list=[$element_table.x#1, $element_table.y#2, $path_scan.$head#9, $path_scan.$tail#10]
        |   +-input_scan_list=
        |     +-GraphPathScan
        |       +-column_list=[$element_table.x#1, $element_table.y#2, $path_scan.$head#9, $path_scan.$tail#10]
        |       +-input_scan_list=
        |       | +-GraphNodeScan
        |       | | +-column_list=[$element_table.x#1]
        |       | | +-label_expr=
        |       | | | +-GraphLabelNaryExpr
        |       | | |   +-op=OR
        |       | | |   +-operand_list=
        |       | | |     +-GraphWildCardLabel
        |       | | |     +-GraphLabelNaryExpr
        |       | | |       +-op=NOT
        |       | | |       +-operand_list=
        |       | | |         +-GraphWildCardLabel
        |       | | +-target_element_table_list=[sample_catalog.aml.Account,sample_catalog.aml.Person,sample_catalog.aml.Syndicate]
        |       | +-GraphEdgeScan
        |       | | +-column_list=[$element_table.y#2]
        |       | | +-label_expr=
        |       | | | +-GraphLabelNaryExpr
        |       | | |   +-op=OR
        |       | | |   +-operand_list=
        |       | | |     +-GraphWildCardLabel
        |       | | |     +-GraphLabelNaryExpr
        |       | | |       +-op=NOT
        |       | | |       +-operand_list=
        |       | | |         +-GraphWildCardLabel
        |       | | +-target_element_table_list=[sample_catalog.aml.PersonOwnAccount,sample_catalog.aml.Transfer]
        |       | | +-orientation=ANY
        |       | +-GraphPathScan
        |       |   +-column_list=$path_scan.[$head#9, $tail#10]
        |       |   +-input_scan_list=
        |       |   | +-GraphNodeScan
        |       |   | | +-column_list=[$element_table.a#3]
        |       |   | | +-label_expr=
        |       |   | | | +-GraphLabelNaryExpr
        |       |   | | |   +-op=OR
        |       |   | | |   +-operand_list=
        |       |   | | |     +-GraphWildCardLabel
        |       |   | | |     +-GraphLabelNaryExpr
        |       |   | | |       +-op=NOT
        |       |   | | |       +-operand_list=
        |       |   | | |         +-GraphWildCardLabel
        |       |   | | +-target_element_table_list=[sample_catalog.aml.Account,sample_catalog.aml.Person,sample_catalog.aml.Syndicate]
        |       |   | +-GraphEdgeScan
        |       |   | | +-column_list=[$element_table.b#4]
        |       |   | | +-label_expr=
        |       |   | | | +-GraphLabelNaryExpr
        |       |   | | |   +-op=OR
        |       |   | | |   +-operand_list=
        |       |   | | |     +-GraphWildCardLabel
        |       |   | | |     +-GraphLabelNaryExpr
        |       |   | | |       +-op=NOT
        |       |   | | |       +-operand_list=
        |       |   | | |         +-GraphWildCardLabel
        |       |   | | +-target_element_table_list=[sample_catalog.aml.PersonOwnAccount,sample_catalog.aml.Transfer]
        |       |   | | +-orientation=ANY
        |       |   | +-GraphNodeScan
        |       |   |   +-column_list=[$element_table.c#5]
        |       |   |   +-label_expr=
        |       |   |   | +-GraphLabelNaryExpr
        |       |   |   |   +-op=OR
        |       |   |   |   +-operand_list=
        |       |   |   |     +-GraphWildCardLabel
        |       |   |   |     +-GraphLabelNaryExpr
        |       |   |   |       +-op=NOT
        |       |   |   |       +-operand_list=
        |       |   |   |         +-GraphWildCardLabel
        |       |   |   +-target_element_table_list=[sample_catalog.aml.Account,sample_catalog.aml.Person,sample_catalog.aml.Syndicate]
        |       |   +-head=$path_scan.$head#9
        |       |   +-tail=$path_scan.$tail#10
        |       |   +-quantifier=
        |       |   | +-GraphPathPatternQuantifier
        |       |   |   +-lower_bound=
        |       |   |   | +-Literal(type=INT64, value=1)
        |       |   |   +-upper_bound=
        |       |   |     +-Literal(type=INT64, value=3)
        |       |   +-group_variable_list=
        |       |     +-GraphMakeArrayVariable(element=$element_table.a#3, array=$element_table.a#6)
        |       |     +-GraphMakeArrayVariable(element=$element_table.b#4, array=$element_table.b#7)
        |       |     +-GraphMakeArrayVariable(element=$element_table.c#5, array=$element_table.c#8)
        |       +-head=$element_table.x#1
        |       +-tail=$path_scan.$tail#10
        +-shape_expr_list=
          +-One#11 := Literal(type=INT64, value=1)
==

# b/339476610: Quantified paths with labeled edges on their LHS should influence
# the base term of the recursive scan.
# Expected base term: 'Account' TableScan only
select * from graph_table(
  aml
  MATCH (x)-[:Transfer]->((a)-[b]->(c)){1, 3}
  COLUMNS(1 AS One)
)
--

QueryStmt
+-output_column_list=
| +-$graph_table.One#11 AS One [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.One#11]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.One#11]
        +-property_graph=sample_catalog.aml
        +-input_scan=
        | +-GraphScan
        |   +-column_list=[$element_table.x#1, $element_table.$element1#2, $path_scan.$head#9, $path_scan.$tail#10]
        |   +-input_scan_list=
        |     +-GraphPathScan
        |       +-column_list=[$element_table.x#1, $element_table.$element1#2, $path_scan.$head#9, $path_scan.$tail#10]
        |       +-input_scan_list=
        |       | +-GraphNodeScan
        |       | | +-column_list=[$element_table.x#1]
        |       | | +-label_expr=
        |       | | | +-GraphLabelNaryExpr
        |       | | |   +-op=OR
        |       | | |   +-operand_list=
        |       | | |     +-GraphWildCardLabel
        |       | | |     +-GraphLabelNaryExpr
        |       | | |       +-op=NOT
        |       | | |       +-operand_list=
        |       | | |         +-GraphWildCardLabel
        |       | | +-target_element_table_list=[sample_catalog.aml.Account,sample_catalog.aml.Person,sample_catalog.aml.Syndicate]
        |       | +-GraphEdgeScan
        |       | | +-column_list=[$element_table.$element1#2]
        |       | | +-label_expr=
        |       | | | +-GraphLabel(label=sample_catalog.aml.Transfer)
        |       | | +-target_element_table_list=[sample_catalog.aml.Transfer]
        |       | | +-orientation=RIGHT
        |       | +-GraphPathScan
        |       |   +-column_list=$path_scan.[$head#9, $tail#10]
        |       |   +-input_scan_list=
        |       |   | +-GraphNodeScan
        |       |   | | +-column_list=[$element_table.a#3]
        |       |   | | +-label_expr=
        |       |   | | | +-GraphLabelNaryExpr
        |       |   | | |   +-op=OR
        |       |   | | |   +-operand_list=
        |       |   | | |     +-GraphWildCardLabel
        |       |   | | |     +-GraphLabelNaryExpr
        |       |   | | |       +-op=NOT
        |       |   | | |       +-operand_list=
        |       |   | | |         +-GraphWildCardLabel
        |       |   | | +-target_element_table_list=[sample_catalog.aml.Account,sample_catalog.aml.Person,sample_catalog.aml.Syndicate]
        |       |   | +-GraphEdgeScan
        |       |   | | +-column_list=[$element_table.b#4]
        |       |   | | +-label_expr=
        |       |   | | | +-GraphLabelNaryExpr
        |       |   | | |   +-op=OR
        |       |   | | |   +-operand_list=
        |       |   | | |     +-GraphWildCardLabel
        |       |   | | |     +-GraphLabelNaryExpr
        |       |   | | |       +-op=NOT
        |       |   | | |       +-operand_list=
        |       |   | | |         +-GraphWildCardLabel
        |       |   | | +-target_element_table_list=[sample_catalog.aml.PersonOwnAccount,sample_catalog.aml.Transfer]
        |       |   | | +-orientation=RIGHT
        |       |   | +-GraphNodeScan
        |       |   |   +-column_list=[$element_table.c#5]
        |       |   |   +-label_expr=
        |       |   |   | +-GraphLabelNaryExpr
        |       |   |   |   +-op=OR
        |       |   |   |   +-operand_list=
        |       |   |   |     +-GraphWildCardLabel
        |       |   |   |     +-GraphLabelNaryExpr
        |       |   |   |       +-op=NOT
        |       |   |   |       +-operand_list=
        |       |   |   |         +-GraphWildCardLabel
        |       |   |   +-target_element_table_list=[sample_catalog.aml.Account,sample_catalog.aml.Person,sample_catalog.aml.Syndicate]
        |       |   +-head=$path_scan.$head#9
        |       |   +-tail=$path_scan.$tail#10
        |       |   +-quantifier=
        |       |   | +-GraphPathPatternQuantifier
        |       |   |   +-lower_bound=
        |       |   |   | +-Literal(type=INT64, value=1)
        |       |   |   +-upper_bound=
        |       |   |     +-Literal(type=INT64, value=3)
        |       |   +-group_variable_list=
        |       |     +-GraphMakeArrayVariable(element=$element_table.a#3, array=$element_table.a#6)
        |       |     +-GraphMakeArrayVariable(element=$element_table.b#4, array=$element_table.b#7)
        |       |     +-GraphMakeArrayVariable(element=$element_table.c#5, array=$element_table.c#8)
        |       +-head=$element_table.x#1
        |       +-tail=$path_scan.$tail#10
        +-shape_expr_list=
          +-One#11 := Literal(type=INT64, value=1)
==

# b/339476610: Quantified paths with unlabeled edges on their LHS, but have some
# label earlier in the pattern should influence the base term of the recursive
# scan.
# Expected base term: 'Account' TableScan only
select * from graph_table(
  aml
  MATCH (x:Person)->((a)-[b]->(c)){1, 3}
  COLUMNS(1 AS One)
)
--
QueryStmt
+-output_column_list=
| +-$graph_table.One#11 AS One [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.One#11]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.One#11]
        +-property_graph=sample_catalog.aml
        +-input_scan=
        | +-GraphScan
        |   +-column_list=[$element_table.x#1, $element_table.$element1#2, $path_scan.$head#9, $path_scan.$tail#10]
        |   +-input_scan_list=
        |     +-GraphPathScan
        |       +-column_list=[$element_table.x#1, $element_table.$element1#2, $path_scan.$head#9, $path_scan.$tail#10]
        |       +-input_scan_list=
        |       | +-GraphNodeScan
        |       | | +-column_list=[$element_table.x#1]
        |       | | +-label_expr=
        |       | | | +-GraphLabel(label=sample_catalog.aml.Person)
        |       | | +-target_element_table_list=[sample_catalog.aml.Person]
        |       | +-GraphEdgeScan
        |       | | +-column_list=[$element_table.$element1#2]
        |       | | +-label_expr=
        |       | | | +-GraphLabelNaryExpr
        |       | | |   +-op=OR
        |       | | |   +-operand_list=
        |       | | |     +-GraphWildCardLabel
        |       | | |     +-GraphLabelNaryExpr
        |       | | |       +-op=NOT
        |       | | |       +-operand_list=
        |       | | |         +-GraphWildCardLabel
        |       | | +-target_element_table_list=[sample_catalog.aml.PersonOwnAccount,sample_catalog.aml.Transfer]
        |       | | +-orientation=RIGHT
        |       | +-GraphPathScan
        |       |   +-column_list=$path_scan.[$head#9, $tail#10]
        |       |   +-input_scan_list=
        |       |   | +-GraphNodeScan
        |       |   | | +-column_list=[$element_table.a#3]
        |       |   | | +-label_expr=
        |       |   | | | +-GraphLabelNaryExpr
        |       |   | | |   +-op=OR
        |       |   | | |   +-operand_list=
        |       |   | | |     +-GraphWildCardLabel
        |       |   | | |     +-GraphLabelNaryExpr
        |       |   | | |       +-op=NOT
        |       |   | | |       +-operand_list=
        |       |   | | |         +-GraphWildCardLabel
        |       |   | | +-target_element_table_list=[sample_catalog.aml.Account,sample_catalog.aml.Person,sample_catalog.aml.Syndicate]
        |       |   | +-GraphEdgeScan
        |       |   | | +-column_list=[$element_table.b#4]
        |       |   | | +-label_expr=
        |       |   | | | +-GraphLabelNaryExpr
        |       |   | | |   +-op=OR
        |       |   | | |   +-operand_list=
        |       |   | | |     +-GraphWildCardLabel
        |       |   | | |     +-GraphLabelNaryExpr
        |       |   | | |       +-op=NOT
        |       |   | | |       +-operand_list=
        |       |   | | |         +-GraphWildCardLabel
        |       |   | | +-target_element_table_list=[sample_catalog.aml.PersonOwnAccount,sample_catalog.aml.Transfer]
        |       |   | | +-orientation=RIGHT
        |       |   | +-GraphNodeScan
        |       |   |   +-column_list=[$element_table.c#5]
        |       |   |   +-label_expr=
        |       |   |   | +-GraphLabelNaryExpr
        |       |   |   |   +-op=OR
        |       |   |   |   +-operand_list=
        |       |   |   |     +-GraphWildCardLabel
        |       |   |   |     +-GraphLabelNaryExpr
        |       |   |   |       +-op=NOT
        |       |   |   |       +-operand_list=
        |       |   |   |         +-GraphWildCardLabel
        |       |   |   +-target_element_table_list=[sample_catalog.aml.Account,sample_catalog.aml.Person,sample_catalog.aml.Syndicate]
        |       |   +-head=$path_scan.$head#9
        |       |   +-tail=$path_scan.$tail#10
        |       |   +-quantifier=
        |       |   | +-GraphPathPatternQuantifier
        |       |   |   +-lower_bound=
        |       |   |   | +-Literal(type=INT64, value=1)
        |       |   |   +-upper_bound=
        |       |   |     +-Literal(type=INT64, value=3)
        |       |   +-group_variable_list=
        |       |     +-GraphMakeArrayVariable(element=$element_table.a#3, array=$element_table.a#6)
        |       |     +-GraphMakeArrayVariable(element=$element_table.b#4, array=$element_table.b#7)
        |       |     +-GraphMakeArrayVariable(element=$element_table.c#5, array=$element_table.c#8)
        |       +-head=$element_table.x#1
        |       +-tail=$path_scan.$tail#10
        +-shape_expr_list=
          +-One#11 := Literal(type=INT64, value=1)
==

# b/339476610: Quantified paths with labeled edges on their LHS should influence
# the base term of the recursive scan. (Outgoing edge)
# Expected base term: 'Account' and 'Person' TableScans
select * from graph_table(
  aml
  MATCH (x:Account)<-((a)-[b]->(c)){1, 3}
  COLUMNS(1 AS One)
)
--

QueryStmt
+-output_column_list=
| +-$graph_table.One#11 AS One [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.One#11]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.One#11]
        +-property_graph=sample_catalog.aml
        +-input_scan=
        | +-GraphScan
        |   +-column_list=[$element_table.x#1, $element_table.$element1#2, $path_scan.$head#9, $path_scan.$tail#10]
        |   +-input_scan_list=
        |     +-GraphPathScan
        |       +-column_list=[$element_table.x#1, $element_table.$element1#2, $path_scan.$head#9, $path_scan.$tail#10]
        |       +-input_scan_list=
        |       | +-GraphNodeScan
        |       | | +-column_list=[$element_table.x#1]
        |       | | +-label_expr=
        |       | | | +-GraphLabel(label=sample_catalog.aml.Account)
        |       | | +-target_element_table_list=[sample_catalog.aml.Account]
        |       | +-GraphEdgeScan
        |       | | +-column_list=[$element_table.$element1#2]
        |       | | +-label_expr=
        |       | | | +-GraphLabelNaryExpr
        |       | | |   +-op=OR
        |       | | |   +-operand_list=
        |       | | |     +-GraphWildCardLabel
        |       | | |     +-GraphLabelNaryExpr
        |       | | |       +-op=NOT
        |       | | |       +-operand_list=
        |       | | |         +-GraphWildCardLabel
        |       | | +-target_element_table_list=[sample_catalog.aml.PersonOwnAccount,sample_catalog.aml.Transfer]
        |       | | +-orientation=LEFT
        |       | +-GraphPathScan
        |       |   +-column_list=$path_scan.[$head#9, $tail#10]
        |       |   +-input_scan_list=
        |       |   | +-GraphNodeScan
        |       |   | | +-column_list=[$element_table.a#3]
        |       |   | | +-label_expr=
        |       |   | | | +-GraphLabelNaryExpr
        |       |   | | |   +-op=OR
        |       |   | | |   +-operand_list=
        |       |   | | |     +-GraphWildCardLabel
        |       |   | | |     +-GraphLabelNaryExpr
        |       |   | | |       +-op=NOT
        |       |   | | |       +-operand_list=
        |       |   | | |         +-GraphWildCardLabel
        |       |   | | +-target_element_table_list=[sample_catalog.aml.Account,sample_catalog.aml.Person,sample_catalog.aml.Syndicate]
        |       |   | +-GraphEdgeScan
        |       |   | | +-column_list=[$element_table.b#4]
        |       |   | | +-label_expr=
        |       |   | | | +-GraphLabelNaryExpr
        |       |   | | |   +-op=OR
        |       |   | | |   +-operand_list=
        |       |   | | |     +-GraphWildCardLabel
        |       |   | | |     +-GraphLabelNaryExpr
        |       |   | | |       +-op=NOT
        |       |   | | |       +-operand_list=
        |       |   | | |         +-GraphWildCardLabel
        |       |   | | +-target_element_table_list=[sample_catalog.aml.PersonOwnAccount,sample_catalog.aml.Transfer]
        |       |   | | +-orientation=RIGHT
        |       |   | +-GraphNodeScan
        |       |   |   +-column_list=[$element_table.c#5]
        |       |   |   +-label_expr=
        |       |   |   | +-GraphLabelNaryExpr
        |       |   |   |   +-op=OR
        |       |   |   |   +-operand_list=
        |       |   |   |     +-GraphWildCardLabel
        |       |   |   |     +-GraphLabelNaryExpr
        |       |   |   |       +-op=NOT
        |       |   |   |       +-operand_list=
        |       |   |   |         +-GraphWildCardLabel
        |       |   |   +-target_element_table_list=[sample_catalog.aml.Account,sample_catalog.aml.Person,sample_catalog.aml.Syndicate]
        |       |   +-head=$path_scan.$head#9
        |       |   +-tail=$path_scan.$tail#10
        |       |   +-quantifier=
        |       |   | +-GraphPathPatternQuantifier
        |       |   |   +-lower_bound=
        |       |   |   | +-Literal(type=INT64, value=1)
        |       |   |   +-upper_bound=
        |       |   |     +-Literal(type=INT64, value=3)
        |       |   +-group_variable_list=
        |       |     +-GraphMakeArrayVariable(element=$element_table.a#3, array=$element_table.a#6)
        |       |     +-GraphMakeArrayVariable(element=$element_table.b#4, array=$element_table.b#7)
        |       |     +-GraphMakeArrayVariable(element=$element_table.c#5, array=$element_table.c#8)
        |       +-head=$element_table.x#1
        |       +-tail=$path_scan.$tail#10
        +-shape_expr_list=
          +-One#11 := Literal(type=INT64, value=1)
==

# b/339476610: Quantified paths with labeled edges on their LHS should return
# empty scans if there is no possible path from the edge to the quantified path
# and accessing group variables should be allowed (even though they're empty).
select * from graph_table(
  aml
  MATCH (x:Person)->((a:Person)-[b]->(c)){1, 3}
  COLUMNS(ARRAY_LENGTH(b) AS num_hops)
)
--

QueryStmt
+-output_column_list=
| +-$graph_table.num_hops#11 AS num_hops [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.num_hops#11]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.num_hops#11]
        +-property_graph=sample_catalog.aml
        +-input_scan=
        | +-GraphScan
        |   +-column_list=[$element_table.x#1, $element_table.$element1#2, $path_scan.$head#9, $element_table.b#7, $path_scan.$tail#10]
        |   +-input_scan_list=
        |     +-GraphPathScan
        |       +-column_list=[$element_table.x#1, $element_table.$element1#2, $path_scan.$head#9, $element_table.b#7, $path_scan.$tail#10]
        |       +-input_scan_list=
        |       | +-GraphNodeScan
        |       | | +-column_list=[$element_table.x#1]
        |       | | +-label_expr=
        |       | | | +-GraphLabel(label=sample_catalog.aml.Person)
        |       | | +-target_element_table_list=[sample_catalog.aml.Person]
        |       | +-GraphEdgeScan
        |       | | +-column_list=[$element_table.$element1#2]
        |       | | +-label_expr=
        |       | | | +-GraphLabelNaryExpr
        |       | | |   +-op=OR
        |       | | |   +-operand_list=
        |       | | |     +-GraphWildCardLabel
        |       | | |     +-GraphLabelNaryExpr
        |       | | |       +-op=NOT
        |       | | |       +-operand_list=
        |       | | |         +-GraphWildCardLabel
        |       | | +-target_element_table_list=[sample_catalog.aml.PersonOwnAccount,sample_catalog.aml.Transfer]
        |       | | +-orientation=RIGHT
        |       | +-GraphPathScan
        |       |   +-column_list=[$path_scan.$head#9, $element_table.b#7, $path_scan.$tail#10]
        |       |   +-input_scan_list=
        |       |   | +-GraphNodeScan
        |       |   | | +-column_list=[$element_table.a#3]
        |       |   | | +-label_expr=
        |       |   | | | +-GraphLabel(label=sample_catalog.aml.Person)
        |       |   | | +-target_element_table_list=[sample_catalog.aml.Person]
        |       |   | +-GraphEdgeScan
        |       |   | | +-column_list=[$element_table.b#4]
        |       |   | | +-label_expr=
        |       |   | | | +-GraphLabelNaryExpr
        |       |   | | |   +-op=OR
        |       |   | | |   +-operand_list=
        |       |   | | |     +-GraphWildCardLabel
        |       |   | | |     +-GraphLabelNaryExpr
        |       |   | | |       +-op=NOT
        |       |   | | |       +-operand_list=
        |       |   | | |         +-GraphWildCardLabel
        |       |   | | +-target_element_table_list=[sample_catalog.aml.PersonOwnAccount,sample_catalog.aml.Transfer]
        |       |   | | +-orientation=RIGHT
        |       |   | +-GraphNodeScan
        |       |   |   +-column_list=[$element_table.c#5]
        |       |   |   +-label_expr=
        |       |   |   | +-GraphLabelNaryExpr
        |       |   |   |   +-op=OR
        |       |   |   |   +-operand_list=
        |       |   |   |     +-GraphWildCardLabel
        |       |   |   |     +-GraphLabelNaryExpr
        |       |   |   |       +-op=NOT
        |       |   |   |       +-operand_list=
        |       |   |   |         +-GraphWildCardLabel
        |       |   |   +-target_element_table_list=[sample_catalog.aml.Account,sample_catalog.aml.Person,sample_catalog.aml.Syndicate]
        |       |   +-head=$path_scan.$head#9
        |       |   +-tail=$path_scan.$tail#10
        |       |   +-quantifier=
        |       |   | +-GraphPathPatternQuantifier
        |       |   |   +-lower_bound=
        |       |   |   | +-Literal(type=INT64, value=1)
        |       |   |   +-upper_bound=
        |       |   |     +-Literal(type=INT64, value=3)
        |       |   +-group_variable_list=
        |       |     +-GraphMakeArrayVariable(element=$element_table.a#3, array=$element_table.a#6)
        |       |     +-GraphMakeArrayVariable(element=$element_table.b#4, array=$element_table.b#7)
        |       |     +-GraphMakeArrayVariable(element=$element_table.c#5, array=$element_table.c#8)
        |       +-head=$element_table.x#1
        |       +-tail=$path_scan.$tail#10
        +-shape_expr_list=
          +-num_hops#11 :=
            +-FunctionCall(ZetaSQL:array_length(ARRAY<GRAPH_EDGE(aml)<accountId INT64, amount UINT64, personId INT64, targetAccountId INT64>>) -> INT64)
              +-ColumnRef(type=ARRAY<GRAPH_EDGE(aml)<accountId INT64, amount UINT64, personId INT64, targetAccountId INT64>>, column=$element_table.b#7)
==

# b/339476610: Test with trailing path factors on the RHS to ensure correct
# results
select * from graph_table(
  aml
  MATCH (x:Account)->((a)-[b]->(c)){1, 3}(y)->(z)
  COLUMNS(1 AS One)
)
--
QueryStmt
+-output_column_list=
| +-$graph_table.One#14 AS One [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.One#14]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.One#14]
        +-property_graph=sample_catalog.aml
        +-input_scan=
        | +-GraphScan
        |   +-column_list=[$element_table.x#1, $element_table.$element1#2, $path_scan.$head#9, $path_scan.$tail#10, $element_table.y#11, $element_table.$element2#12, $element_table.z#13]
        |   +-input_scan_list=
        |     +-GraphPathScan
        |       +-column_list=[$element_table.x#1, $element_table.$element1#2, $path_scan.$head#9, $path_scan.$tail#10, $element_table.y#11, $element_table.$element2#12, $element_table.z#13]
        |       +-input_scan_list=
        |       | +-GraphNodeScan
        |       | | +-column_list=[$element_table.x#1]
        |       | | +-label_expr=
        |       | | | +-GraphLabel(label=sample_catalog.aml.Account)
        |       | | +-target_element_table_list=[sample_catalog.aml.Account]
        |       | +-GraphEdgeScan
        |       | | +-column_list=[$element_table.$element1#2]
        |       | | +-label_expr=
        |       | | | +-GraphLabelNaryExpr
        |       | | |   +-op=OR
        |       | | |   +-operand_list=
        |       | | |     +-GraphWildCardLabel
        |       | | |     +-GraphLabelNaryExpr
        |       | | |       +-op=NOT
        |       | | |       +-operand_list=
        |       | | |         +-GraphWildCardLabel
        |       | | +-target_element_table_list=[sample_catalog.aml.PersonOwnAccount,sample_catalog.aml.Transfer]
        |       | | +-orientation=RIGHT
        |       | +-GraphPathScan
        |       | | +-column_list=$path_scan.[$head#9, $tail#10]
        |       | | +-input_scan_list=
        |       | | | +-GraphNodeScan
        |       | | | | +-column_list=[$element_table.a#3]
        |       | | | | +-label_expr=
        |       | | | | | +-GraphLabelNaryExpr
        |       | | | | |   +-op=OR
        |       | | | | |   +-operand_list=
        |       | | | | |     +-GraphWildCardLabel
        |       | | | | |     +-GraphLabelNaryExpr
        |       | | | | |       +-op=NOT
        |       | | | | |       +-operand_list=
        |       | | | | |         +-GraphWildCardLabel
        |       | | | | +-target_element_table_list=[sample_catalog.aml.Account,sample_catalog.aml.Person,sample_catalog.aml.Syndicate]
        |       | | | +-GraphEdgeScan
        |       | | | | +-column_list=[$element_table.b#4]
        |       | | | | +-label_expr=
        |       | | | | | +-GraphLabelNaryExpr
        |       | | | | |   +-op=OR
        |       | | | | |   +-operand_list=
        |       | | | | |     +-GraphWildCardLabel
        |       | | | | |     +-GraphLabelNaryExpr
        |       | | | | |       +-op=NOT
        |       | | | | |       +-operand_list=
        |       | | | | |         +-GraphWildCardLabel
        |       | | | | +-target_element_table_list=[sample_catalog.aml.PersonOwnAccount,sample_catalog.aml.Transfer]
        |       | | | | +-orientation=RIGHT
        |       | | | +-GraphNodeScan
        |       | | |   +-column_list=[$element_table.c#5]
        |       | | |   +-label_expr=
        |       | | |   | +-GraphLabelNaryExpr
        |       | | |   |   +-op=OR
        |       | | |   |   +-operand_list=
        |       | | |   |     +-GraphWildCardLabel
        |       | | |   |     +-GraphLabelNaryExpr
        |       | | |   |       +-op=NOT
        |       | | |   |       +-operand_list=
        |       | | |   |         +-GraphWildCardLabel
        |       | | |   +-target_element_table_list=[sample_catalog.aml.Account,sample_catalog.aml.Person,sample_catalog.aml.Syndicate]
        |       | | +-head=$path_scan.$head#9
        |       | | +-tail=$path_scan.$tail#10
        |       | | +-quantifier=
        |       | | | +-GraphPathPatternQuantifier
        |       | | |   +-lower_bound=
        |       | | |   | +-Literal(type=INT64, value=1)
        |       | | |   +-upper_bound=
        |       | | |     +-Literal(type=INT64, value=3)
        |       | | +-group_variable_list=
        |       | |   +-GraphMakeArrayVariable(element=$element_table.a#3, array=$element_table.a#6)
        |       | |   +-GraphMakeArrayVariable(element=$element_table.b#4, array=$element_table.b#7)
        |       | |   +-GraphMakeArrayVariable(element=$element_table.c#5, array=$element_table.c#8)
        |       | +-GraphNodeScan
        |       | | +-column_list=[$element_table.y#11]
        |       | | +-label_expr=
        |       | | | +-GraphLabelNaryExpr
        |       | | |   +-op=OR
        |       | | |   +-operand_list=
        |       | | |     +-GraphWildCardLabel
        |       | | |     +-GraphLabelNaryExpr
        |       | | |       +-op=NOT
        |       | | |       +-operand_list=
        |       | | |         +-GraphWildCardLabel
        |       | | +-target_element_table_list=[sample_catalog.aml.Account,sample_catalog.aml.Person,sample_catalog.aml.Syndicate]
        |       | +-GraphEdgeScan
        |       | | +-column_list=[$element_table.$element2#12]
        |       | | +-label_expr=
        |       | | | +-GraphLabelNaryExpr
        |       | | |   +-op=OR
        |       | | |   +-operand_list=
        |       | | |     +-GraphWildCardLabel
        |       | | |     +-GraphLabelNaryExpr
        |       | | |       +-op=NOT
        |       | | |       +-operand_list=
        |       | | |         +-GraphWildCardLabel
        |       | | +-target_element_table_list=[sample_catalog.aml.PersonOwnAccount,sample_catalog.aml.Transfer]
        |       | | +-orientation=RIGHT
        |       | +-GraphNodeScan
        |       |   +-column_list=[$element_table.z#13]
        |       |   +-label_expr=
        |       |   | +-GraphLabelNaryExpr
        |       |   |   +-op=OR
        |       |   |   +-operand_list=
        |       |   |     +-GraphWildCardLabel
        |       |   |     +-GraphLabelNaryExpr
        |       |   |       +-op=NOT
        |       |   |       +-operand_list=
        |       |   |         +-GraphWildCardLabel
        |       |   +-target_element_table_list=[sample_catalog.aml.Account,sample_catalog.aml.Person,sample_catalog.aml.Syndicate]
        |       +-head=$element_table.x#1
        |       +-tail=$element_table.z#13
        +-shape_expr_list=
          +-One#14 := Literal(type=INT64, value=1)
==

# b/339476610: Test impossible traversal to quantified path still yields a valid
# tree when lower bound is 0, allowing traversability between path factors on
# both sides of the quantifier.
select * from graph_table(
  aml
  MATCH (x:Person)-[:PersonOwnAccount]->((a:Person)-[b]->(c)){0, 3}(d)
  COLUMNS(ARRAY_LENGTH(b) AS num_hops)
)
--
QueryStmt
+-output_column_list=
| +-$graph_table.num_hops#12 AS num_hops [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.num_hops#12]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.num_hops#12]
        +-property_graph=sample_catalog.aml
        +-input_scan=
        | +-GraphScan
        |   +-column_list=[$element_table.x#1, $element_table.$element1#2, $path_scan.$head#9, $element_table.b#7, $path_scan.$tail#10, $element_table.d#11]
        |   +-input_scan_list=
        |     +-GraphPathScan
        |       +-column_list=[$element_table.x#1, $element_table.$element1#2, $path_scan.$head#9, $element_table.b#7, $path_scan.$tail#10, $element_table.d#11]
        |       +-input_scan_list=
        |       | +-GraphNodeScan
        |       | | +-column_list=[$element_table.x#1]
        |       | | +-label_expr=
        |       | | | +-GraphLabel(label=sample_catalog.aml.Person)
        |       | | +-target_element_table_list=[sample_catalog.aml.Person]
        |       | +-GraphEdgeScan
        |       | | +-column_list=[$element_table.$element1#2]
        |       | | +-label_expr=
        |       | | | +-GraphLabel(label=sample_catalog.aml.PersonOwnAccount)
        |       | | +-target_element_table_list=[sample_catalog.aml.PersonOwnAccount]
        |       | | +-orientation=RIGHT
        |       | +-GraphPathScan
        |       | | +-column_list=[$path_scan.$head#9, $element_table.b#7, $path_scan.$tail#10]
        |       | | +-input_scan_list=
        |       | | | +-GraphNodeScan
        |       | | | | +-column_list=[$element_table.a#3]
        |       | | | | +-label_expr=
        |       | | | | | +-GraphLabel(label=sample_catalog.aml.Person)
        |       | | | | +-target_element_table_list=[sample_catalog.aml.Person]
        |       | | | +-GraphEdgeScan
        |       | | | | +-column_list=[$element_table.b#4]
        |       | | | | +-label_expr=
        |       | | | | | +-GraphLabelNaryExpr
        |       | | | | |   +-op=OR
        |       | | | | |   +-operand_list=
        |       | | | | |     +-GraphWildCardLabel
        |       | | | | |     +-GraphLabelNaryExpr
        |       | | | | |       +-op=NOT
        |       | | | | |       +-operand_list=
        |       | | | | |         +-GraphWildCardLabel
        |       | | | | +-target_element_table_list=[sample_catalog.aml.PersonOwnAccount,sample_catalog.aml.Transfer]
        |       | | | | +-orientation=RIGHT
        |       | | | +-GraphNodeScan
        |       | | |   +-column_list=[$element_table.c#5]
        |       | | |   +-label_expr=
        |       | | |   | +-GraphLabelNaryExpr
        |       | | |   |   +-op=OR
        |       | | |   |   +-operand_list=
        |       | | |   |     +-GraphWildCardLabel
        |       | | |   |     +-GraphLabelNaryExpr
        |       | | |   |       +-op=NOT
        |       | | |   |       +-operand_list=
        |       | | |   |         +-GraphWildCardLabel
        |       | | |   +-target_element_table_list=[sample_catalog.aml.Account,sample_catalog.aml.Person,sample_catalog.aml.Syndicate]
        |       | | +-head=$path_scan.$head#9
        |       | | +-tail=$path_scan.$tail#10
        |       | | +-quantifier=
        |       | | | +-GraphPathPatternQuantifier
        |       | | |   +-lower_bound=
        |       | | |   | +-Literal(type=INT64, value=0)
        |       | | |   +-upper_bound=
        |       | | |     +-Literal(type=INT64, value=3)
        |       | | +-group_variable_list=
        |       | |   +-GraphMakeArrayVariable(element=$element_table.a#3, array=$element_table.a#6)
        |       | |   +-GraphMakeArrayVariable(element=$element_table.b#4, array=$element_table.b#7)
        |       | |   +-GraphMakeArrayVariable(element=$element_table.c#5, array=$element_table.c#8)
        |       | +-GraphNodeScan
        |       |   +-column_list=[$element_table.d#11]
        |       |   +-label_expr=
        |       |   | +-GraphLabelNaryExpr
        |       |   |   +-op=OR
        |       |   |   +-operand_list=
        |       |   |     +-GraphWildCardLabel
        |       |   |     +-GraphLabelNaryExpr
        |       |   |       +-op=NOT
        |       |   |       +-operand_list=
        |       |   |         +-GraphWildCardLabel
        |       |   +-target_element_table_list=[sample_catalog.aml.Account,sample_catalog.aml.Person,sample_catalog.aml.Syndicate]
        |       +-head=$element_table.x#1
        |       +-tail=$element_table.d#11
        +-shape_expr_list=
          +-num_hops#12 :=
            +-FunctionCall(ZetaSQL:array_length(ARRAY<GRAPH_EDGE(aml)<accountId INT64, amount UINT64, personId INT64, targetAccountId INT64>>) -> INT64)
              +-ColumnRef(type=ARRAY<GRAPH_EDGE(aml)<accountId INT64, amount UINT64, personId INT64, targetAccountId INT64>>, column=$element_table.b#7)
==

# b/339476610: Quantified paths with labeled edges on their LHS should influence
# the base term of the recursive scan. Test with a longer quantifier path.
# Expected base term: 'Account' only.
# Expected recursive term: {Account-Transfer->Account-Transfer->Account}
select * from graph_table(
  aml
  MATCH (x:Account)->((a)-[b]->(c)-[d]->(e)){0, 3}(f)
  COLUMNS(ARRAY_LENGTH(b) AS num_hops)
)
--
QueryStmt
+-output_column_list=
| +-$graph_table.num_hops#16 AS num_hops [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.num_hops#16]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.num_hops#16]
        +-property_graph=sample_catalog.aml
        +-input_scan=
        | +-GraphScan
        |   +-column_list=[$element_table.x#1, $element_table.$element1#2, $path_scan.$head#13, $element_table.b#9, $path_scan.$tail#14, $element_table.f#15]
        |   +-input_scan_list=
        |     +-GraphPathScan
        |       +-column_list=[$element_table.x#1, $element_table.$element1#2, $path_scan.$head#13, $element_table.b#9, $path_scan.$tail#14, $element_table.f#15]
        |       +-input_scan_list=
        |       | +-GraphNodeScan
        |       | | +-column_list=[$element_table.x#1]
        |       | | +-label_expr=
        |       | | | +-GraphLabel(label=sample_catalog.aml.Account)
        |       | | +-target_element_table_list=[sample_catalog.aml.Account]
        |       | +-GraphEdgeScan
        |       | | +-column_list=[$element_table.$element1#2]
        |       | | +-label_expr=
        |       | | | +-GraphLabelNaryExpr
        |       | | |   +-op=OR
        |       | | |   +-operand_list=
        |       | | |     +-GraphWildCardLabel
        |       | | |     +-GraphLabelNaryExpr
        |       | | |       +-op=NOT
        |       | | |       +-operand_list=
        |       | | |         +-GraphWildCardLabel
        |       | | +-target_element_table_list=[sample_catalog.aml.PersonOwnAccount,sample_catalog.aml.Transfer]
        |       | | +-orientation=RIGHT
        |       | +-GraphPathScan
        |       | | +-column_list=[$path_scan.$head#13, $element_table.b#9, $path_scan.$tail#14]
        |       | | +-input_scan_list=
        |       | | | +-GraphNodeScan
        |       | | | | +-column_list=[$element_table.a#3]
        |       | | | | +-label_expr=
        |       | | | | | +-GraphLabelNaryExpr
        |       | | | | |   +-op=OR
        |       | | | | |   +-operand_list=
        |       | | | | |     +-GraphWildCardLabel
        |       | | | | |     +-GraphLabelNaryExpr
        |       | | | | |       +-op=NOT
        |       | | | | |       +-operand_list=
        |       | | | | |         +-GraphWildCardLabel
        |       | | | | +-target_element_table_list=[sample_catalog.aml.Account,sample_catalog.aml.Person,sample_catalog.aml.Syndicate]
        |       | | | +-GraphEdgeScan
        |       | | | | +-column_list=[$element_table.b#4]
        |       | | | | +-label_expr=
        |       | | | | | +-GraphLabelNaryExpr
        |       | | | | |   +-op=OR
        |       | | | | |   +-operand_list=
        |       | | | | |     +-GraphWildCardLabel
        |       | | | | |     +-GraphLabelNaryExpr
        |       | | | | |       +-op=NOT
        |       | | | | |       +-operand_list=
        |       | | | | |         +-GraphWildCardLabel
        |       | | | | +-target_element_table_list=[sample_catalog.aml.PersonOwnAccount,sample_catalog.aml.Transfer]
        |       | | | | +-orientation=RIGHT
        |       | | | +-GraphNodeScan
        |       | | | | +-column_list=[$element_table.c#5]
        |       | | | | +-label_expr=
        |       | | | | | +-GraphLabelNaryExpr
        |       | | | | |   +-op=OR
        |       | | | | |   +-operand_list=
        |       | | | | |     +-GraphWildCardLabel
        |       | | | | |     +-GraphLabelNaryExpr
        |       | | | | |       +-op=NOT
        |       | | | | |       +-operand_list=
        |       | | | | |         +-GraphWildCardLabel
        |       | | | | +-target_element_table_list=[sample_catalog.aml.Account,sample_catalog.aml.Person,sample_catalog.aml.Syndicate]
        |       | | | +-GraphEdgeScan
        |       | | | | +-column_list=[$element_table.d#6]
        |       | | | | +-label_expr=
        |       | | | | | +-GraphLabelNaryExpr
        |       | | | | |   +-op=OR
        |       | | | | |   +-operand_list=
        |       | | | | |     +-GraphWildCardLabel
        |       | | | | |     +-GraphLabelNaryExpr
        |       | | | | |       +-op=NOT
        |       | | | | |       +-operand_list=
        |       | | | | |         +-GraphWildCardLabel
        |       | | | | +-target_element_table_list=[sample_catalog.aml.PersonOwnAccount,sample_catalog.aml.Transfer]
        |       | | | | +-orientation=RIGHT
        |       | | | +-GraphNodeScan
        |       | | |   +-column_list=[$element_table.e#7]
        |       | | |   +-label_expr=
        |       | | |   | +-GraphLabelNaryExpr
        |       | | |   |   +-op=OR
        |       | | |   |   +-operand_list=
        |       | | |   |     +-GraphWildCardLabel
        |       | | |   |     +-GraphLabelNaryExpr
        |       | | |   |       +-op=NOT
        |       | | |   |       +-operand_list=
        |       | | |   |         +-GraphWildCardLabel
        |       | | |   +-target_element_table_list=[sample_catalog.aml.Account,sample_catalog.aml.Person,sample_catalog.aml.Syndicate]
        |       | | +-head=$path_scan.$head#13
        |       | | +-tail=$path_scan.$tail#14
        |       | | +-quantifier=
        |       | | | +-GraphPathPatternQuantifier
        |       | | |   +-lower_bound=
        |       | | |   | +-Literal(type=INT64, value=0)
        |       | | |   +-upper_bound=
        |       | | |     +-Literal(type=INT64, value=3)
        |       | | +-group_variable_list=
        |       | |   +-GraphMakeArrayVariable(element=$element_table.a#3, array=$element_table.a#8)
        |       | |   +-GraphMakeArrayVariable(element=$element_table.b#4, array=$element_table.b#9)
        |       | |   +-GraphMakeArrayVariable(element=$element_table.c#5, array=$element_table.c#10)
        |       | |   +-GraphMakeArrayVariable(element=$element_table.d#6, array=$element_table.d#11)
        |       | |   +-GraphMakeArrayVariable(element=$element_table.e#7, array=$element_table.e#12)
        |       | +-GraphNodeScan
        |       |   +-column_list=[$element_table.f#15]
        |       |   +-label_expr=
        |       |   | +-GraphLabelNaryExpr
        |       |   |   +-op=OR
        |       |   |   +-operand_list=
        |       |   |     +-GraphWildCardLabel
        |       |   |     +-GraphLabelNaryExpr
        |       |   |       +-op=NOT
        |       |   |       +-operand_list=
        |       |   |         +-GraphWildCardLabel
        |       |   +-target_element_table_list=[sample_catalog.aml.Account,sample_catalog.aml.Person,sample_catalog.aml.Syndicate]
        |       +-head=$element_table.x#1
        |       +-tail=$element_table.f#15
        +-shape_expr_list=
          +-num_hops#16 :=
            +-FunctionCall(ZetaSQL:array_length(ARRAY<GRAPH_EDGE(aml)<accountId INT64, amount UINT64, personId INT64, targetAccountId INT64>>) -> INT64)
              +-ColumnRef(type=ARRAY<GRAPH_EDGE(aml)<accountId INT64, amount UINT64, personId INT64, targetAccountId INT64>>, column=$element_table.b#9)
==

# b/352176731: Unioned path search prefix followed by a quantified path.
select * from graph_table(
  aml
  MATCH ANY (a)(b), ((x)-[y]->(z)){3}
  COLUMNS(1 AS One)
)
--
QueryStmt
+-output_column_list=
| +-$graph_table.One#11 AS One [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.One#11]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.One#11]
        +-property_graph=sample_catalog.aml
        +-input_scan=
        | +-GraphScan
        |   +-column_list=[$element_table.a#1, $element_table.b#2, $path_scan.$head#9, $path_scan.$tail#10]
        |   +-input_scan_list=
        |     +-GraphPathScan
        |     | +-column_list=$element_table.[a#1, b#2]
        |     | +-input_scan_list=
        |     | | +-GraphNodeScan
        |     | | | +-column_list=[$element_table.a#1]
        |     | | | +-label_expr=
        |     | | | | +-GraphLabelNaryExpr
        |     | | | |   +-op=OR
        |     | | | |   +-operand_list=
        |     | | | |     +-GraphWildCardLabel
        |     | | | |     +-GraphLabelNaryExpr
        |     | | | |       +-op=NOT
        |     | | | |       +-operand_list=
        |     | | | |         +-GraphWildCardLabel
        |     | | | +-target_element_table_list=[sample_catalog.aml.Account,sample_catalog.aml.Person,sample_catalog.aml.Syndicate]
        |     | | +-GraphNodeScan
        |     | |   +-column_list=[$element_table.b#2]
        |     | |   +-label_expr=
        |     | |   | +-GraphLabelNaryExpr
        |     | |   |   +-op=OR
        |     | |   |   +-operand_list=
        |     | |   |     +-GraphWildCardLabel
        |     | |   |     +-GraphLabelNaryExpr
        |     | |   |       +-op=NOT
        |     | |   |       +-operand_list=
        |     | |   |         +-GraphWildCardLabel
        |     | |   +-target_element_table_list=[sample_catalog.aml.Account,sample_catalog.aml.Person,sample_catalog.aml.Syndicate]
        |     | +-head=$element_table.a#1
        |     | +-tail=$element_table.b#2
        |     | +-search_prefix=
        |     |   +-GraphPathSearchPrefix(type=ANY)
        |     +-GraphPathScan
        |       +-column_list=$path_scan.[$head#9, $tail#10]
        |       +-input_scan_list=
        |       | +-GraphNodeScan
        |       | | +-column_list=[$element_table.x#3]
        |       | | +-label_expr=
        |       | | | +-GraphLabelNaryExpr
        |       | | |   +-op=OR
        |       | | |   +-operand_list=
        |       | | |     +-GraphWildCardLabel
        |       | | |     +-GraphLabelNaryExpr
        |       | | |       +-op=NOT
        |       | | |       +-operand_list=
        |       | | |         +-GraphWildCardLabel
        |       | | +-target_element_table_list=[sample_catalog.aml.Account,sample_catalog.aml.Person,sample_catalog.aml.Syndicate]
        |       | +-GraphEdgeScan
        |       | | +-column_list=[$element_table.y#4]
        |       | | +-label_expr=
        |       | | | +-GraphLabelNaryExpr
        |       | | |   +-op=OR
        |       | | |   +-operand_list=
        |       | | |     +-GraphWildCardLabel
        |       | | |     +-GraphLabelNaryExpr
        |       | | |       +-op=NOT
        |       | | |       +-operand_list=
        |       | | |         +-GraphWildCardLabel
        |       | | +-target_element_table_list=[sample_catalog.aml.PersonOwnAccount,sample_catalog.aml.Transfer]
        |       | | +-orientation=RIGHT
        |       | +-GraphNodeScan
        |       |   +-column_list=[$element_table.z#5]
        |       |   +-label_expr=
        |       |   | +-GraphLabelNaryExpr
        |       |   |   +-op=OR
        |       |   |   +-operand_list=
        |       |   |     +-GraphWildCardLabel
        |       |   |     +-GraphLabelNaryExpr
        |       |   |       +-op=NOT
        |       |   |       +-operand_list=
        |       |   |         +-GraphWildCardLabel
        |       |   +-target_element_table_list=[sample_catalog.aml.Account,sample_catalog.aml.Person,sample_catalog.aml.Syndicate]
        |       +-head=$path_scan.$head#9
        |       +-tail=$path_scan.$tail#10
        |       +-quantifier=
        |       | +-GraphPathPatternQuantifier
        |       |   +-lower_bound=
        |       |   | +-Literal(type=INT64, value=3)
        |       |   +-upper_bound=
        |       |     +-Literal(type=INT64, value=3)
        |       +-group_variable_list=
        |         +-GraphMakeArrayVariable(element=$element_table.x#3, array=$element_table.x#6)
        |         +-GraphMakeArrayVariable(element=$element_table.y#4, array=$element_table.y#7)
        |         +-GraphMakeArrayVariable(element=$element_table.z#5, array=$element_table.z#8)
        +-shape_expr_list=
          +-One#11 := Literal(type=INT64, value=1)
==

[default language_features=V_1_4_SQL_GRAPH,V_1_4_SQL_GRAPH_BOUNDED_PATH_QUANTIFICATION,V_1_1_WITH_ON_SUBQUERY]

SELECT * FROM GRAPH_TABLE(
  aml
  MATCH (src:Person)
        ((x:Person|Account
          WHERE EXISTS (
            WITH with_scan AS (SELECT 1 as one)
            SELECT * FROM with_scan
          ))
          -[b]->
          (y:Account)
          ){1,3}
        (dst:Account)
  COLUMNS(1 as one)
)

--
QueryStmt
+-output_column_list=
| +-$graph_table.one#13 AS one [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.one#13]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.one#13]
        +-property_graph=sample_catalog.aml
        +-input_scan=
        | +-GraphScan
        |   +-column_list=[$element_table.src#1, $path_scan.$head#10, $path_scan.$tail#11, $element_table.dst#12]
        |   +-input_scan_list=
        |     +-GraphPathScan
        |       +-column_list=[$element_table.src#1, $path_scan.$head#10, $path_scan.$tail#11, $element_table.dst#12]
        |       +-input_scan_list=
        |       | +-GraphNodeScan
        |       | | +-column_list=[$element_table.src#1]
        |       | | +-label_expr=
        |       | | | +-GraphLabel(label=sample_catalog.aml.Person)
        |       | | +-target_element_table_list=[sample_catalog.aml.Person]
        |       | +-GraphPathScan
        |       | | +-column_list=$path_scan.[$head#10, $tail#11]
        |       | | +-input_scan_list=
        |       | | | +-GraphNodeScan
        |       | | | | +-column_list=[$element_table.x#2]
        |       | | | | +-filter_expr=
        |       | | | | | +-SubqueryExpr
        |       | | | | |   +-type=BOOL
        |       | | | | |   +-subquery_type=EXISTS
        |       | | | | |   +-subquery=
        |       | | | | |     +-WithScan
        |       | | | | |       +-column_list=[with_scan.one#4]
        |       | | | | |       +-with_entry_list=
        |       | | | | |       | +-WithEntry
        |       | | | | |       |   +-with_query_name="with_scan"
        |       | | | | |       |   +-with_subquery=
        |       | | | | |       |     +-ProjectScan
        |       | | | | |       |       +-column_list=[with_scan.one#3]
        |       | | | | |       |       +-expr_list=
        |       | | | | |       |       | +-one#3 := Literal(type=INT64, value=1)
        |       | | | | |       |       +-input_scan=
        |       | | | | |       |         +-SingleRowScan
        |       | | | | |       +-query=
        |       | | | | |         +-ProjectScan
        |       | | | | |           +-column_list=[with_scan.one#4]
        |       | | | | |           +-input_scan=
        |       | | | | |             +-WithRefScan(column_list=[with_scan.one#4], with_query_name="with_scan")
        |       | | | | +-label_expr=
        |       | | | | | +-GraphLabelNaryExpr
        |       | | | | |   +-op=OR
        |       | | | | |   +-operand_list=
        |       | | | | |     +-GraphLabel(label=sample_catalog.aml.Person)
        |       | | | | |     +-GraphLabel(label=sample_catalog.aml.Account)
        |       | | | | +-target_element_table_list=[sample_catalog.aml.Account,sample_catalog.aml.Person]
        |       | | | +-GraphEdgeScan
        |       | | | | +-column_list=[$element_table.b#5]
        |       | | | | +-label_expr=
        |       | | | | | +-GraphLabelNaryExpr
        |       | | | | |   +-op=OR
        |       | | | | |   +-operand_list=
        |       | | | | |     +-GraphWildCardLabel
        |       | | | | |     +-GraphLabelNaryExpr
        |       | | | | |       +-op=NOT
        |       | | | | |       +-operand_list=
        |       | | | | |         +-GraphWildCardLabel
        |       | | | | +-target_element_table_list=[sample_catalog.aml.PersonOwnAccount,sample_catalog.aml.Transfer]
        |       | | | | +-orientation=RIGHT
        |       | | | +-GraphNodeScan
        |       | | |   +-column_list=[$element_table.y#6]
        |       | | |   +-label_expr=
        |       | | |   | +-GraphLabel(label=sample_catalog.aml.Account)
        |       | | |   +-target_element_table_list=[sample_catalog.aml.Account]
        |       | | +-head=$path_scan.$head#10
        |       | | +-tail=$path_scan.$tail#11
        |       | | +-quantifier=
        |       | | | +-GraphPathPatternQuantifier
        |       | | |   +-lower_bound=
        |       | | |   | +-Literal(type=INT64, value=1)
        |       | | |   +-upper_bound=
        |       | | |     +-Literal(type=INT64, value=3)
        |       | | +-group_variable_list=
        |       | |   +-GraphMakeArrayVariable(element=$element_table.x#2, array=$element_table.x#7)
        |       | |   +-GraphMakeArrayVariable(element=$element_table.b#5, array=$element_table.b#8)
        |       | |   +-GraphMakeArrayVariable(element=$element_table.y#6, array=$element_table.y#9)
        |       | +-GraphNodeScan
        |       |   +-column_list=[$element_table.dst#12]
        |       |   +-label_expr=
        |       |   | +-GraphLabel(label=sample_catalog.aml.Account)
        |       |   +-target_element_table_list=[sample_catalog.aml.Account]
        |       +-head=$element_table.src#1
        |       +-tail=$element_table.dst#12
        +-shape_expr_list=
          +-one#13 := Literal(type=INT64, value=1)
==

[default language_features=V_1_4_SQL_GRAPH,V_1_4_SQL_GRAPH_BOUNDED_PATH_QUANTIFICATION,V_1_1_WITH_ON_SUBQUERY]
SELECT * FROM GRAPH_TABLE(
  aml
  MATCH ((x:Person|Account)
          -[b]->
          (y:Account
          WHERE EXISTS (
            WITH with_scan AS (SELECT 1 as one)
            SELECT * FROM with_scan
          ))
        )
  COLUMNS(1 as one)
)
--
QueryStmt
+-output_column_list=
| +-$graph_table.one#6 AS one [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.one#6]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.one#6]
        +-property_graph=sample_catalog.aml
        +-input_scan=
        | +-GraphScan
        |   +-column_list=$element_table.[x#1, b#2, y#3]
        |   +-input_scan_list=
        |     +-GraphPathScan
        |       +-column_list=$element_table.[x#1, b#2, y#3]
        |       +-input_scan_list=
        |       | +-GraphNodeScan
        |       | | +-column_list=[$element_table.x#1]
        |       | | +-label_expr=
        |       | | | +-GraphLabelNaryExpr
        |       | | |   +-op=OR
        |       | | |   +-operand_list=
        |       | | |     +-GraphLabel(label=sample_catalog.aml.Person)
        |       | | |     +-GraphLabel(label=sample_catalog.aml.Account)
        |       | | +-target_element_table_list=[sample_catalog.aml.Account,sample_catalog.aml.Person]
        |       | +-GraphEdgeScan
        |       | | +-column_list=[$element_table.b#2]
        |       | | +-label_expr=
        |       | | | +-GraphLabelNaryExpr
        |       | | |   +-op=OR
        |       | | |   +-operand_list=
        |       | | |     +-GraphWildCardLabel
        |       | | |     +-GraphLabelNaryExpr
        |       | | |       +-op=NOT
        |       | | |       +-operand_list=
        |       | | |         +-GraphWildCardLabel
        |       | | +-target_element_table_list=[sample_catalog.aml.PersonOwnAccount,sample_catalog.aml.Transfer]
        |       | | +-orientation=RIGHT
        |       | +-GraphNodeScan
        |       |   +-column_list=[$element_table.y#3]
        |       |   +-filter_expr=
        |       |   | +-SubqueryExpr
        |       |   |   +-type=BOOL
        |       |   |   +-subquery_type=EXISTS
        |       |   |   +-subquery=
        |       |   |     +-WithScan
        |       |   |       +-column_list=[with_scan.one#5]
        |       |   |       +-with_entry_list=
        |       |   |       | +-WithEntry
        |       |   |       |   +-with_query_name="with_scan"
        |       |   |       |   +-with_subquery=
        |       |   |       |     +-ProjectScan
        |       |   |       |       +-column_list=[with_scan.one#4]
        |       |   |       |       +-expr_list=
        |       |   |       |       | +-one#4 := Literal(type=INT64, value=1)
        |       |   |       |       +-input_scan=
        |       |   |       |         +-SingleRowScan
        |       |   |       +-query=
        |       |   |         +-ProjectScan
        |       |   |           +-column_list=[with_scan.one#5]
        |       |   |           +-input_scan=
        |       |   |             +-WithRefScan(column_list=[with_scan.one#5], with_query_name="with_scan")
        |       |   +-label_expr=
        |       |   | +-GraphLabel(label=sample_catalog.aml.Account)
        |       |   +-target_element_table_list=[sample_catalog.aml.Account]
        |       +-head=$element_table.x#1
        |       +-tail=$element_table.y#3
        +-shape_expr_list=
          +-one#6 := Literal(type=INT64, value=1)
==

[default language_features=V_1_4_SQL_GRAPH,V_1_4_SQL_GRAPH_BOUNDED_PATH_QUANTIFICATION,V_1_1_WITH_ON_SUBQUERY]
SELECT * FROM GRAPH_TABLE(
  aml
  MATCH ((x:Person)
          -[b]->
          (y:Account)
          WHERE EXISTS (
            WITH with_scan AS (SELECT 1 as one)
            SELECT * FROM with_scan
          )
        )
        (g:Account)-[h]-(i)
  COLUMNS(1 as one)
)
--
QueryStmt
+-output_column_list=
| +-$graph_table.one#9 AS one [INT64]
+-query=
  +-ProjectScan
    +-column_list=[$graph_table.one#9]
    +-input_scan=
      +-GraphTableScan
        +-column_list=[$graph_table.one#9]
        +-property_graph=sample_catalog.aml
        +-input_scan=
        | +-GraphScan
        |   +-column_list=$element_table.[x#1, b#2, y#3, g#6, h#7, i#8]
        |   +-input_scan_list=
        |     +-GraphPathScan
        |       +-column_list=$element_table.[x#1, b#2, y#3, g#6, h#7, i#8]
        |       +-input_scan_list=
        |       | +-GraphPathScan
        |       | | +-column_list=$element_table.[x#1, b#2, y#3]
        |       | | +-input_scan_list=
        |       | | | +-GraphNodeScan
        |       | | | | +-column_list=[$element_table.x#1]
        |       | | | | +-label_expr=
        |       | | | | | +-GraphLabel(label=sample_catalog.aml.Person)
        |       | | | | +-target_element_table_list=[sample_catalog.aml.Person]
        |       | | | +-GraphEdgeScan
        |       | | | | +-column_list=[$element_table.b#2]
        |       | | | | +-label_expr=
        |       | | | | | +-GraphLabelNaryExpr
        |       | | | | |   +-op=OR
        |       | | | | |   +-operand_list=
        |       | | | | |     +-GraphWildCardLabel
        |       | | | | |     +-GraphLabelNaryExpr
        |       | | | | |       +-op=NOT
        |       | | | | |       +-operand_list=
        |       | | | | |         +-GraphWildCardLabel
        |       | | | | +-target_element_table_list=[sample_catalog.aml.PersonOwnAccount,sample_catalog.aml.Transfer]
        |       | | | | +-orientation=RIGHT
        |       | | | +-GraphNodeScan
        |       | | |   +-column_list=[$element_table.y#3]
        |       | | |   +-label_expr=
        |       | | |   | +-GraphLabel(label=sample_catalog.aml.Account)
        |       | | |   +-target_element_table_list=[sample_catalog.aml.Account]
        |       | | +-filter_expr=
        |       | | | +-SubqueryExpr
        |       | | |   +-type=BOOL
        |       | | |   +-subquery_type=EXISTS
        |       | | |   +-subquery=
        |       | | |     +-WithScan
        |       | | |       +-column_list=[with_scan.one#5]
        |       | | |       +-with_entry_list=
        |       | | |       | +-WithEntry
        |       | | |       |   +-with_query_name="with_scan"
        |       | | |       |   +-with_subquery=
        |       | | |       |     +-ProjectScan
        |       | | |       |       +-column_list=[with_scan.one#4]
        |       | | |       |       +-expr_list=
        |       | | |       |       | +-one#4 := Literal(type=INT64, value=1)
        |       | | |       |       +-input_scan=
        |       | | |       |         +-SingleRowScan
        |       | | |       +-query=
        |       | | |         +-ProjectScan
        |       | | |           +-column_list=[with_scan.one#5]
        |       | | |           +-input_scan=
        |       | | |             +-WithRefScan(column_list=[with_scan.one#5], with_query_name="with_scan")
        |       | | +-head=$element_table.x#1
        |       | | +-tail=$element_table.y#3
        |       | +-GraphNodeScan
        |       | | +-column_list=[$element_table.g#6]
        |       | | +-label_expr=
        |       | | | +-GraphLabel(label=sample_catalog.aml.Account)
        |       | | +-target_element_table_list=[sample_catalog.aml.Account]
        |       | +-GraphEdgeScan
        |       | | +-column_list=[$element_table.h#7]
        |       | | +-label_expr=
        |       | | | +-GraphLabelNaryExpr
        |       | | |   +-op=OR
        |       | | |   +-operand_list=
        |       | | |     +-GraphWildCardLabel
        |       | | |     +-GraphLabelNaryExpr
        |       | | |       +-op=NOT
        |       | | |       +-operand_list=
        |       | | |         +-GraphWildCardLabel
        |       | | +-target_element_table_list=[sample_catalog.aml.PersonOwnAccount,sample_catalog.aml.Transfer]
        |       | | +-orientation=ANY
        |       | +-GraphNodeScan
        |       |   +-column_list=[$element_table.i#8]
        |       |   +-label_expr=
        |       |   | +-GraphLabelNaryExpr
        |       |   |   +-op=OR
        |       |   |   +-operand_list=
        |       |   |     +-GraphWildCardLabel
        |       |   |     +-GraphLabelNaryExpr
        |       |   |       +-op=NOT
        |       |   |       +-operand_list=
        |       |   |         +-GraphWildCardLabel
        |       |   +-target_element_table_list=[sample_catalog.aml.Account,sample_catalog.aml.Person,sample_catalog.aml.Syndicate]
        |       +-head=$element_table.x#1
        |       +-tail=$element_table.i#8
        +-shape_expr_list=
          +-one#9 := Literal(type=INT64, value=1)
